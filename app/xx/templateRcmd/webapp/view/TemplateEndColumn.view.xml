<mvc:View controllerName="xx.templateRcmd.controller.TemplateEndColumn" 
	xmlns:mvc="sap.ui.core.mvc" 
	xmlns="sap.m" 
	xmlns:uxap="sap.uxap" 
	xmlns:layout="sap.ui.layout" 
    xmlns:form="sap.ui.layout.form"
	xmlns:core="sap.ui.core"
    xmlns:lib-m="ext.lib.control.m"
	height="100%">

	<uxap:ObjectPageLayout id="page"
            toggleHeaderOnTitleClick="true"
            alwaysShowContentHeader = "true"
            preserveHeaderStateOnScroll="false"
            headerContentPinnable="true"
            isChildPage="true"
            upperCaseAnchorBar="false"
            showTitleInHeaderContent="true"
            showEditHeaderButton="true" 
            showFooter="true">
		<uxap:headerTitle>
			<uxap:ObjectPageDynamicHeaderTitle>
				<uxap:expandedHeading>
					<Title text="{department_name}" wrapping="true" />
				</uxap:expandedHeading>
				<uxap:snappedHeading>
					<Title text="{department_name}" wrapping="true" />
				</uxap:snappedHeading>
				<uxap:expandedContent>
				</uxap:expandedContent>
				<uxap:snappedContent>
				</uxap:snappedContent>
				<uxap:snappedTitleOnMobile>
					<Title text="{department_name}" />
				</uxap:snappedTitleOnMobile>
                <uxap:navigationActions>
					<OverflowToolbarButton id="pageEnterFullScreenButton" type="Transparent" icon="sap-icon://full-screen" press="onPageEnterFullScreenButtonPress" tooltip="Enter Full Screen Mode" visible="{= ${/actionButtonsInfo/midColumn/fullScreen} !== null }"/>
					<OverflowToolbarButton id="pageExitFullScreenButton" type="Transparent" icon="sap-icon://exit-full-screen" press="onPageExitFullScreenButtonPress" tooltip="Exit Full Screen Mode" visible="{= ${/actionButtonsInfo/midColumn/exitFullScreen} !== null }"/>
					<OverflowToolbarButton id="pageNavBackButton" type="Transparent" icon="sap-icon://decline" text="back" tooltip="back to the list" press=".onPageNavBackButtonPress" visible="{= ${/actionButtonsInfo/midColumn/closeColumn} !== null }"/>
                </uxap:navigationActions>
			</uxap:ObjectPageDynamicHeaderTitle>
		</uxap:headerTitle>

		<uxap:headerContent>
            <FlexBox
                    alignItems="Start"
                    justifyContent="SpaceBetween">
                <items>
                    <Panel backgroundDesign="Transparent" class="sapUiNoContentPadding">
                        <content>
                            <layout:HorizontalLayout allowWrapping="true">
                                <layout:VerticalLayout class="sapUiLargeMarginEnd">
                                    <ObjectAttribute title="Korean" text="{department_korean_name}"/>
                                    <ObjectAttribute title="English" text="{department_english_name}"/>
                                </layout:VerticalLayout>
                                <layout:VerticalLayout class="sapUiLargeMarginEnd">
                                    <ObjectAttribute title="Leader" text="{department_leader_empno}"/>
                                </layout:VerticalLayout>
                                <layout:VerticalLayout class="sapUiLargeMarginEnd">
                                    <ObjectAttribute title="Full Path"/>
                                    <ObjectStatus text="{= ${use_flag} === true ? 'Used' : 'Dropped' }" state="Success" />
                                </layout:VerticalLayout>
                            </layout:HorizontalLayout>
                        </content>
                    </Panel>
                </items>
            </FlexBox>
		</uxap:headerContent>

		<uxap:sections>
			<uxap:ObjectPageSection titleUppercase="false" title="Path">
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
						<form:SimpleForm editable="false" >
						    <ObjectAttribute title="Full Path" text="{full_path_desc}"/>
                        </form:SimpleForm>
					</uxap:ObjectPageSubSection>
				</uxap:subSections>
			</uxap:ObjectPageSection>

			<uxap:ObjectPageSection id="pageSectionMain" titleUppercase="false" title="Department">
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
                        <form:SimpleForm editable="false">

                            <core:Title text="Normal" />
                            <Label text="{I18N>/CODE}" required="true"/>
                            <lib-m:EditModeVBox editMode="{endPageViewModel>/isEditMode}" editable="{endPageViewModel>/isAddedMode}">
                                <Text text="{department_code}"/>
                                <Input value="{department_code}" required="true"/>
                            </lib-m:EditModeVBox>
                            <Label text="Name" required="true"/>
                            <lib-m:EditModeVBox editMode="{endPageViewModel>/isEditMode}">
                                <Text text="{department_name}"/>
                                <Input value="{department_name}" required="true"/>
                            </lib-m:EditModeVBox>
                            <Label text="Korean Name" required="true"/>
                            <lib-m:EditModeVBox editMode="{endPageViewModel>/isEditMode}">
                                <Text text="{department_korean_name}"/>
                                <Input value="{department_korean_name}"/>
                            </lib-m:EditModeVBox>
                            <Label text="English Name"/>
                            <lib-m:EditModeVBox editMode="{endPageViewModel>/isEditMode}">
                                <Text text="{department_english_name}"/>
                                <Input value="{department_english_name}"/>
                            </lib-m:EditModeVBox>

                            <core:Title text="Settings" />
                            <Label text="Department Type"/>
                            <lib-m:EditModeVBox editMode="{endPageViewModel>/isEditMode}">
                                <Text text="{department_type_code}" />
                                <lib-m:CodeComboBox width="100%" showSecondaryValues="true" 
                                    useEmpty="true" selectedKey="{department_type_code}"
                                    items="{
                                        path: '/',
                                        filters: [
                                            {path: 'tenant_id', operator: 'EQ', value1: 'L2100'},
                                            {path: 'group_code', operator: 'EQ', value1: 'CM_CHAIN_CD'}
                                        ],
                                        serviceName: 'cm.util.CommonService',
                                        entityName: 'Code'
                                    }">
                                </lib-m:CodeComboBox>
                            </lib-m:EditModeVBox>
                            <Label text="Leader Employee No."/>
                            <lib-m:EditModeVBox editMode="{endPageViewModel>/isEditMode}">
                                <Text text="{department_leader_empno}" />
                                <Input value="{department_leader_empno}" required="true"
                                    showValueHelp="true" valueHelpRequest=".onDepartmentLeaderEmployeeValueHelpPress"/>
                            </lib-m:EditModeVBox>
                            <Label text="Used"/>
                            <lib-m:EditModeVBox editMode="{endPageViewModel>/isEditMode}">
                                <Text text="{
                                        path: 'use_flag',
                                        formatter: '.viewFormatter.toYesNo'
                                    }"/>
                                <SegmentedButton selectedKey="{
                                        path: 'use_flag',
                                        type: 'sap.ui.model.type.Boolean'
                                    }">
                                    <items>
                                        <SegmentedButtonItem text="Yes" key="true"/>
                                        <SegmentedButtonItem text="No" key="false"/>
                                    </items>
                                </SegmentedButton>
                            </lib-m:EditModeVBox>
                        </form:SimpleForm>
					</uxap:ObjectPageSubSection>
				</uxap:subSections>
			</uxap:ObjectPageSection>

			<uxap:ObjectPageSection titleUppercase="false" title="History" visible="{= !${endPageViewModel>/isAddedMode}}">
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
						<form:SimpleForm editable="false" >
		                    <core:Title text="Created" />
							<Label text="By"/>
							<Text text="{create_user_id}"/>
							<Label text="At"/>
							<Text text="{
									path: 'system_create_dtm',
									formatter: '.dateFormatter.toUTCDateTimeString'
								}"/>
		                    <core:Title text="Updates" />
							<Label text="By"/>
							<Text text="{update_user_id}"/>
							<Label text="At"/>
							<Text text="{
									path: 'system_update_dtm',
									formatter: '.dateFormatter.toUTCDateTimeString'
								}"/>
						</form:SimpleForm>
					</uxap:ObjectPageSubSection>
				</uxap:subSections>
			</uxap:ObjectPageSection>

			<uxap:ObjectPageSection titleUppercase="false" title="Members">
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
						<lib-m:Table id="employeeList"
								sticky="HeaderToolbar,ColumnHeaders" 
								inset="false" 
                                items="{
                                    path: '/Employee',
                                    parameters: {
                                        expand: 'department'
                                    },
                                    sorter: [{
                                        path: 'user_local_name'
                                    },{
                                        path: 'job_title'
                                    }]
                                }"
                                growing="true"
                                growingThreshold="10"
								class="sapUiSizeCompact sapFDynamicPageAlignContent" 
                                mode="None" 
                                selectionChange=".onEmployeeListSelectionChange"
                                updateFinished="onEmployeeListUpdateFinished"
                                itemPress=".onEmployeeListItemPress"
                                delete=".onEmployeeListDeleteButtonPress"
								width="auto">
							<lib-m:headerToolbar>
								<OverflowToolbar class="sapUiSizeCompact">
                                    <Title text="Employees" level="H2"/>
                                    <ToolbarSpacer/>
                                    <SearchField placeholder="Name" width="10rem" search=".onEmployeeListSearch" />
                                    <Button id="employeeListAddButton" text="Add" type="Transparent" press=".onEmployeeListAddButtonPress" />
                                    <Button id="employeeListDeleteButton" text="Delete" type="Transparent" press=".onEmployeeListDeleteButtonPress" />
								</OverflowToolbar>
							</lib-m:headerToolbar>
							<lib-m:columns>
								<Column minScreenWidth="Tablet" width="2rem">
                                    <ObjectStatus icon="sap-icon://document" text="State" visible="false" />
								</Column>
								<Column minScreenWidth="Tablet" hAlign="Left" demandPopin="true" importance="High" popinDisplay="WithoutHeader">
									<Label text="{I18N>/NAME}" />
								</Column>
								<Column minScreenWidth="Tablet" hAlign="Left" width="8rem" demandPopin="true" popinDisplay="WithoutHeader" >
									<Label text="Job Title" />
								</Column>
								<Column minScreenWidth="Tablet" hAlign="Center" width="8rem">
									<Label text="Gender" />
								</Column>
								<Column minScreenWidth="Tablet" hAlign="Left" width="10rem" >
									<Label text="Emp No." />
								</Column>
							</lib-m:columns>
                            <lib-m:items>
                                <ColumnListItem type="Active">
                                    <cells>
                                        <ObjectStatus icon="{
                                            path: '__metadata/_row_state_',
                                            formatter: '.formatter.toModelStateColumnIcon'
                                        }" />
                                        <lib-m:EditModeVBox editMode="{= ${endPageViewModel>/isEditMode} === true &amp;&amp; ${__metadata/_row_state_} !== 'D' }">
                                            <Text text="{user_local_name}"/>
                                            <Input value="{user_local_name}" required="true"/>
                                        </lib-m:EditModeVBox>
                                        <lib-m:EditModeVBox editMode="{= ${endPageViewModel>/isEditMode} === true &amp;&amp; ${__metadata/_row_state_} !== 'D' }">
                                            <Text text="{job_title}"/>
                                            <Input value="{job_title}" required="true"/>
                                        </lib-m:EditModeVBox>
                                        <Text text="{gender_code}"/>
                                        <Text text="{employee_number}"/>
                                    </cells>
                                </ColumnListItem>
                            </lib-m:items>
						</lib-m:Table>
					</uxap:ObjectPageSubSection>
				</uxap:subSections>
			</uxap:ObjectPageSection>

		</uxap:sections>
		
		<uxap:footer>
			<OverflowToolbar>
                <!-- <Button
                    icon="sap-icon://alert"
                    type="Emphasized"
                    text="{= ${message>/}.length }"
                    visible="{= ${message>/}.length > 0 }"
                    ariaHasPopup="Dialog"
                    press=".onMessagePopoverPress" /> -->
				<ToolbarSpacer />
				<lib-m:EditModeButton type="Transparent" id="pageEditModeButton" press=".onPageEditModeButtonPress" />
				<Button type="Transparent" id="pageDeleteButton" text="Delete 부서" press=".onPageDeleteButtonPress" />
				<Button type="Emphasized" id="pageSaveButton" text="Save" press=".onPageSaveButtonPress" />
			</OverflowToolbar>
		</uxap:footer>
    </uxap:ObjectPageLayout>
    

    <Dialog id="dialogCreateEmployee" title="Create a Employee" contentWidth="35%">
        <content>
            <VBox>
                <form:SimpleForm 
                        maxContainerCols="2"
                        editable="true"
                        layout="ResponsiveGridLayout"
                        adjustLabelSpan="false"
                        labelSpanL="4"
                        labelSpanM="4"
                        emptySpanL="0"
                        emptySpanM="0"
                        columnsL="2"
                        columnsM="2">
                    <form:content>
                        <VBox>
                            <Label text="Emp No." required="true"/>
                            <Input id="dialogCreateEmployeeNo" required="true" />
                        </VBox>
                        <VBox>
                            <Label text="{I18N>/NAME}" required="true"/>
                            <Input id="dialogCreateEmployeeLocalName" value="No Name" required="true" />
                        </VBox>
                        <VBox>
                            <Label text="Job Title"/>
                            <Input id="dialogCreateEmployeeJobTitle" value="책임" />
                        </VBox>
                        <VBox>
                            <Label text="Gender"/>
                            <Input id="dialogCreateEmployeeGenderCode" value="M" />
                        </VBox>
                    </form:content>
                </form:SimpleForm>
            </VBox>
        </content>
        <beginButton>
            <Button text="Cancel" type="Transparent" press=".onDialogCreateEmployeeCancelButtonPress"/>
        </beginButton>
        <endButton>
            <Button text="Create" type="Emphasized" press=".onDialogCreateEmployeeCreateButtonPress"/>
        </endButton>
    </Dialog>

</mvc:View>
