<mvc:View controllerName="op.pu.prMgt.controller.MidCreateObject" 
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:uxap="sap.uxap"
    xmlns:form="sap.ui.layout.form" 
    xmlns:core="sap.ui.core" 
    xmlns:layout="sap.ui.layout"
    xmlns:tnt="sap.tnt"
    xmlns:co="sap.suite.ui.commons"
    xmlns:si="sap.suite.ui.commons.statusindicator"
    xmlns:u="sap.ui.unified" 
    xmlns:table="sap.ui.table" 
    xmlns:richtexteditor="sap.ui.richtexteditor"
    xmlns="sap.m"
	height="100%">

	<uxap:ObjectPageLayout 
        id="page"
		showTitleInHeaderContent="true"
		showEditHeaderButton="true" 
        upperCaseAnchorBar="false"
		showFooter="true"
		editHeaderButtonPress="handleEditBtnPress" >

		<uxap:headerTitle>
			<uxap:ObjectPageDynamicHeaderTitle>
				<uxap:expandedHeading>
					<Title text="{I18N>/PURCHASING} {I18N>/REQUEST} {I18N>/CREATE}" wrapping="true" />
				</uxap:expandedHeading>

                <uxap:navigationActions>
					<OverflowToolbarButton id="pageNavigationBackButton" icon="sap-icon://decline" text="back" tooltip="back to the list" press=".onNavigationBackPress" />
                </uxap:navigationActions>
			</uxap:ObjectPageDynamicHeaderTitle>
		</uxap:headerTitle>

		<uxap:headerContent>
			<FlexBox wrap="Wrap" >
				<layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                    <Label text="구매요청 번호 :"/>
                    <ObjectStatus
                        text="{viewModel>/PrMst/pr_number}"/>
                    <Label text="구매요청 생성일자 :"/>
                    <ObjectStatus
                        text="{ path: 'viewModel>/PrMst/request_date',
                                type: 'sap.ui.model.type.Date',
                                formatOptions: {
                                pattern: 'yyyy-MM-dd'
                                }
                            }"/>
				</layout:VerticalLayout>

				<layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                    <Label text="구매요청 템플릿 :"/>
                    <ObjectStatus
                        text="{viewModel>/PrMst/pr_template_name}"/>
                    <Label text="구매요청 생성자 :"/>
                    <ObjectStatus
                        text="{viewModel>/PrMst/requestor_name}"/>
				</layout:VerticalLayout>

                <layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
					<Label text="구매요청 진행상태 :"/>
                    <ObjectStatus
                        class="sapMObjectStatusLarge"
                        text="New"
                        state="Error" />
				</layout:VerticalLayout>
                
                <!-- Process 시작 -->
                <layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                      <HBox>
                        <Title text="Process"/>
                    </HBox>
                    <HBox>
                        <co:MicroProcessFlow>
                            <co:content>
                                <co:MicroProcessFlowItem state="Error" width="2em" stepWidth="5em" icon="sap-icon://circle-task" />
                                <co:MicroProcessFlowItem state="None" width="2em" stepWidth="5em" />
                                <co:MicroProcessFlowItem state="None" width="2em" stepWidth="5em" />
                                <co:MicroProcessFlowItem state="None" width="2em" stepWidth="5em" />
                            </co:content>
                        </co:MicroProcessFlow>
                    </HBox>
                    <HBox>
                        <Text text="구매요청" width="5em" textAlign="Left" renderWhitespace="true" />
                        <Text text="견적" width="7em" textAlign="Center" />
                        <Text text="입찰" width="7em" textAlign="Center" />
                        <Text text="구매오더" width="5em" textAlign="Center" />
                    </HBox>
                </layout:VerticalLayout>
			</FlexBox>
		</uxap:headerContent>

		<uxap:sections id="pss">

			<uxap:ObjectPageSection  id="pageSectionMain" titleUppercase="true" title="기본 정보">
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
                        <layout:VerticalLayout class="sapUiSmallMarginBeginEnd"> 
                            <HBox alignItems="Center">
                                <Label text="{I18N>/APPROVAL_TITLE}" class="sapUiTinyMarginEnd" width="5em" textAlign="Left" required="{contModel>/DisplayFlag/OP_PU_PR_MST/PR_HEADER_TEXT/mandatory_column_flag}"/>
                                <Input width="50em" placeholder="필수" 
                                    value="{
                                        path: 'viewModel>/PrMst/pr_header_text',
                                        type: 'sap.ui.model.type.String',
                                        constraints: {
                                            maxLength: 200
                                        }
                                    }"
                                    required="{contModel>/DisplayFlag/OP_PU_PR_MST/PR_HEADER_TEXT/mandatory_column_flag}"/>
                            </HBox>
                            <HBox alignItems="Center">
                                <Label text="{I18N>/APPROVAL_CONTENTS}" class="sapUiTinyMarginEnd" width="5em" textAlign="Left" />
                                <richtexteditor:RichTextEditor
                                    editorType="TinyMCE4"
                                    width="100%"
                                    height="200px"
                                    editable="true"
                                    customToolbar="true"
                                    showGroupFont="true"
                                    showGroupLink="true"
                                    showGroupInsert="true"
                                    value="{viewModel>/PrMst/approval_contents}">
                                </richtexteditor:RichTextEditor>
                            </HBox>                            
                        </layout:VerticalLayout> 
                        <!-- <layout:VerticalLayout id="approvalContentsTextEditor" class="sapUiContentPadding" width="100%"></layout:VerticalLayout> -->						
					</uxap:ObjectPageSubSection>
				</uxap:subSections>
			</uxap:ObjectPageSection>

            <!-- 품목 정보 시작 -->
            <uxap:ObjectPageSection titleUppercase="false" title="품목 정보">
				<uxap:subSections>
                    <uxap:ObjectPageSubSection>
                        <!-- Participating Supplier Table -->
                        <table:Table id="pritemTable"
                                selectionMode="MultiToggle"
                                fixedColumnCount="1"
                                visibleRowCountMode="Auto"
                                rows="{viewModel>/Pr_Dtl}"
                                >
                             <table:extension>
                                <OverflowToolbar>
                                    <Title text="{I18N>/ITEM} ({= (${viewModel>/Pr_Dtl})?${viewModel>/Pr_Dtl}.length:0})" level="H2"/>
                                    <ToolbarSpacer/>
                                    <!-- Add the Personalization button -->
                                    <Button id="btnPsAdd" type="Transparent" text="Add Item" press=".onItemAddRow" />
                                    <Button id="btnItemCopy"   type="Transparent" text="Copy"  press=".onItemCopyRow" />
                                    <!-- <Button id="btnItemEditMulti"   type="Transparent" text="Edit Multiple"  press=".onItemEditMultiRow" /> -->
                                    <Button id="btnItemDelete"   type="Transparent" text="Delete"  press=".onItemDeleteRow" />
                                </OverflowToolbar>
                            </table:extension>          

                            <table:columns>
                                <table:Column width="5em" hAlign="Center">
                                    <Label text="품목번호"/>
                                    <table:template>
                                        <Text text="{viewModel>pr_item_number}"/>
                                    </table:template>
                                </table:Column>
                                <table:Column width="10em" hAlign="Center">
                                    <Label text="{I18N>/ORG_CODE}" required="{contModel>/DisplayFlag/OP_PU_PR_DTL/ORG_CODE/mandatory_column_flag}"/>           
                                    <table:template>
                                        <Input
                                            value="{viewModel>org_code}"
                                            showValueHelp="true"
                                            valueHelpRequest=".onOpenOrgcodeDialog" 
                                            required="{contModel>/DisplayFlag/OP_PU_PR_DTL/ORG_CODE/mandatory_column_flag}"/>
                                    </table:template>
                                </table:Column>
                                <table:Column width="10em" hAlign="Center" visible="{contModel>/DisplayFlag/OP_PU_PR_DTL/MATERIAL_CODE/display_column_flag}" >
                                    <Label text="자재코드" required="{contModel>/DisplayFlag/OP_PU_PR_DTL/MATERIAL_CODE/mandatory_column_flag}"/>           
                                    <table:template>
                                        <Input id="i_material_code"
                                            value="{viewModel>material_code}"
                                            showValueHelp="true"
                                            valueHelpRequest=".onOpenMaterialDialog" 
                                            required="{contModel>/DisplayFlag/OP_PU_PR_DTL/MATERIAL_CODE/mandatory_column_flag}"/>
                                    </table:template>
                                </table:Column>
                                <table:Column width="15em" hAlign="Center">
                                    <Label text="구매요청 품명" required="true"/>           
                                    <table:template>
                                        <Input textAlign="Begin" value="{viewModel>pr_desc}" required="true"/>
                                    </table:template>
                                </table:Column>       
                                <table:Column width="10em" hAlign="Center">
                                    <Label text="요청수량" required="{contModel>/DisplayFlag/OP_PU_PR_DTL/PR_QUANTITY/mandatory_column_flag}"/>
                                    <table:template>
                                        <Input textAlign="End" value="{viewModel>pr_quantity}" required="{contModel>/DisplayFlag/OP_PU_PR_DTL/PR_QUANTITY/mandatory_column_flag}"/>
                                    </table:template>
                                </table:Column>                                     
                                <table:Column width="10em" hAlign="Center">
                                    <Label text="단위" required="{contModel>/DisplayFlag/OP_PU_PR_DTL/PR_UNIT/mandatory_column_flag}"/>           
                                    <table:template>
                                        <Input maxLength="3" 
                                            value="{viewModel>pr_unit}"
                                            showValueHelp="true" 
                                            valueHelpRequest=".onOpenUomDialog" 
                                            required="{contModel>/DisplayFlag/OP_PU_PR_DTL/PR_UNIT/mandatory_column_flag}"/>
                                    </table:template>
                                </table:Column>   
                                <table:Column id="c_delivery_request_date" width="10em" hAlign="Center">
                                    <Label text="납품일"/>    
                                    <table:template>
                                        <DatePicker id="i_delivery_request_date"
                                                visible="true"
                                                value="{
                                                    path:'viewModel>delivery_request_date',
                                                    type:'sap.ui.model.odata.type.DateTime',
                                                    formatOptions: {
                                                        UTC: true,
                                                        pattern: 'yyyy-MM-dd'
                                                    }
                                                }"/>
                                    </table:template>
                                </table:Column>                                  
                                <table:Column width="10em" hAlign="Center">
                                    <Label text="가격" required="true"/>           
                                    <table:template>
                                        <Input
                                            value="{
                                                    path:'viewModel>estimated_price',
                                                    type:'sap.ui.model.type.Currency'
                                                    }"
                                            textAlign="End"/>
                                    </table:template>
                                </table:Column>                               
                                <table:Column  width="10em" hAlign="Center">
                                    <Label text="통화" required="true" labelFor="i_currency"/>           
                                    <table:template>
                                        <Input id="i_currency" value="{viewModel>currency_code}"/>
                                    </table:template>
                                </table:Column>                                 
                                <table:Column width="10em" hAlign="Center">
                                    <Label text="가격단위" required="true" labelFor="i_price_unit"/>           
                                    <table:template>
                                        <Input textAlign="End" value="{viewModel>price_unit}"/>
                                    </table:template>
                                </table:Column>                                   
                                <table:Column width="10em" hAlign="Center">
                                    <Label text="구매담당자"/>           
                                    <table:template>
                                        <Input
                                            value="{viewModel>buyer_empno}"
                                            showValueHelp="true"
                                            valueHelpRequest=".onOpenSearchEmpDialog" />
                                    </table:template>
                                </table:Column>
                                <table:Column width="10em" hAlign="Center">
                                    <Label text="구매그룹"/>
                                    <table:template>
                                        <Input value="{viewModel>purchasing_group_code}"/>
                                    </table:template>
                                </table:Column>
                                <table:Column width="10em" hAlign="Center" visible="{contModel>/DisplayFlag/OP_PU_PR_DTL/MATERIAL_GROUP_CODE/display_column_flag}">
                                    <Label text="자재그룹" required="true" />           
                                    <table:template>
                                        <Input value="{viewModel>material_group_code}"/>
                                    </table:template>
                                </table:Column>
                                <table:Column width="10em" hAlign="Center" visible="{contModel>/DisplayFlag/OP_PU_PR_DTL/SLOC_CODE/display_column_flag}">
                                    <Label text="저장위치"/>
                                    <table:template>
                                        <Input value="{viewModel>sloc_code}" />
                                    </table:template>
                                </table:Column>
                                <table:Column width="10em" hAlign="Center">
                                    <Label text="비고"/>
                                    <table:template>
                                        <Input maxLength="2000" value="{viewModel>remark}" />
                                    </table:template>
                                </table:Column>
                                <table:Column width="10em" hAlign="Center" visible="{contModel>/DisplayFlag/OP_PU_PR_ACCOUNT/ACCOUNT_CODE/display_column_flag}">
                                    <Label text="계정코드"/>
                                    <table:template>
                                        <Input value="{viewModel>account_code}" />
                                    </table:template>
                                </table:Column>
                                <table:Column width="10em" hAlign="Center" visible="{contModel>/DisplayFlag/OP_PU_PR_ACCOUNT/CCTR_CODE/display_column_flag}">
                                    <Label text="비용부서코드"/>
                                    <table:template>
                                        <Input value="{viewModel>cctr_code}" />
                                    </table:template>
                                </table:Column>                                                                 
                                <table:Column width="13em" hAlign="Center" visible="{contModel>/DisplayFlag/OP_PU_PR_ACCOUNT/WBS_CODE/display_column_flag}">
                                    <Label text="{I18N>/WBS_CODE}"/>           
                                    <table:template>
                                        <Input value="{viewModel>wbs_code}"
                                            textAlign="Begin"
                                            showValueHelp="true"
                                            valueHelpRequest=".onOpenSearchWbsDialog"
                                            required="{contModel>/DisplayFlag/OP_PU_PR_ACCOUNT/WBS_CODE/mandatory_column_flag}"/>
                                    </table:template>
                                </table:Column>
                                <table:Column width="10em" hAlign="Center" visible="{contModel>/DisplayFlag/OP_PU_PR_ACCOUNT/ASSET_NUMBER/display_column_flag}">
                                    <Label text="자산번호"/>
                                    <table:template>
                                        <Input value="{viewModel>asset_number}" />
                                    </table:template>
                                </table:Column>
                                <table:Column width="10em" hAlign="Center" visible="{contModel>/DisplayFlag/OP_PU_PR_ACCOUNT/ORDER_NUMBER/display_column_flag}">
                                    <Label text="오더번호"/>
                                    <table:template>
                                        <Input value="{viewModel>order_number}" />
                                    </table:template>
                                </table:Column>
                            </table:columns>
                          </table:Table>

                        <!-- // -->
					</uxap:ObjectPageSubSection>
				</uxap:subSections>
			</uxap:ObjectPageSection>
            <!-- 품목 정보 끝 -->

            <!-- 첨부파일 시작 -->
			<uxap:ObjectPageSection titleUppercase="false" title="Attachment">
				<uxap:subSections>
                    <uxap:ObjectPageSubSection title="외부용" level="H2">
                        <layout:VerticalLayout class="sapUiSmallMarginBeginEnd" width="100%">                    
                            <UploadCollection
                                id="UploadCollectionOuter"
                                maximumFilenameLength="55"
                                maximumFileSize="10"
                                multiple="true"
                                sameFilenameAllowed="false"
                                instantUpload="false"
                                noDataDescription="Drop files or use the &quot;Add&quot; button to keep files ready for upload"
                                change="onChange"
                                fileDeleted="onFileDeleted"
                                filenameLengthExceed="onFilenameLengthExceed"
                                fileSizeExceed="onFileSizeExceed"
                                typeMissmatch="onTypeMissmatch"
                                uploadComplete="onUploadComplete"
                                beforeUploadStarts="onBeforeUploadStarts" />
                            <Button id="ButtonUploadOuter" text="Upload Now" press="onStartUpload" />
                        </layout:VerticalLayout>
					</uxap:ObjectPageSubSection>

                    <uxap:ObjectPageSubSection title="내부용" level="H2">
                        <layout:VerticalLayout class="sapUiSmallMarginBeginEnd" width="100%">                    
                            <UploadCollection
                                id="UploadCollectionInner"
                                maximumFilenameLength="55"
                                maximumFileSize="10"
                                multiple="true"
                                sameFilenameAllowed="false"
                                instantUpload="false"
                                noDataDescription="Drop files or use the &quot;Add&quot; button to keep files ready for upload"
                                change="onChange"
                                fileDeleted="onFileDeleted"
                                filenameLengthExceed="onFilenameLengthExceed"
                                fileSizeExceed="onFileSizeExceed"
                                typeMissmatch="onTypeMissmatch"
                                uploadComplete="onUploadComplete"
                                beforeUploadStarts="onBeforeUploadStarts" />
                            <Button id="ButtonUploadInner" text="Upload Now" press="onStartUpload" />
                        </layout:VerticalLayout>
					</uxap:ObjectPageSubSection>
				</uxap:subSections>
			</uxap:ObjectPageSection>
            <!-- 첨부파일 끝 -->

			<uxap:ObjectPageSection titleUppercase="false" title="Report Line">
				<uxap:subSections>
					<uxap:ObjectPageSubSection titleUppercase="false">
						<uxap:blocks>
                            <Table  id="reportLineTable"
                                    sticky="HeaderToolbar,ColumnHeaders"
                                    inset="false"
                                    class="sapFDynamicPageAlignContent"
                                    width="auto">
                                <headerToolbar>
                                    <Toolbar>
                                        <Title id="title" text="Approval Line"/>
                                        <ToolbarSpacer/>
                                    </Toolbar>
                                </headerToolbar>
                                <columns>
                                    <Column width="8em">
                                        <Text text="No." />
                                    </Column>
                                    <Column>
                                        <Text text="Type" />
                                    </Column>
                                    <Column>
                                        <Text text="Name / Dept." />
                                    </Column>
                                    <Column>
                                        <Text text="Comment" />
                                    </Column>
                                    <Column>
                                        <Text text="Status" />
                                    </Column>
                                    <Column>
                                        <Text text="Add / Delete" />
                                    </Column>
                                </columns>
                                <items>
                                    <ColumnListItem>
                                        <cells>
                                            <ObjectIdentifier title="{Name}" text="{ProductId}"/>
                                            <Text text="{SupplierName}" />
                                            <Text text="" />
                                            <Text text="" />
                                            <Text text="" />
                                            <Text text="" />
                                        </cells>
                                    </ColumnListItem>
                                </items>
                            </Table>
						</uxap:blocks>
					</uxap:ObjectPageSubSection>

					<uxap:ObjectPageSubSection>
						<uxap:blocks>
                            <Table  id="referrerTable"
                                    sticky="HeaderToolbar"
                                    inset="false"
                                    class="sapFDynamicPageAlignContent"
                                    width="auto">
                                <headerToolbar>
                                    <Toolbar>
                                        <Title id="referrerTitle" text="Referrer"/>
                                        <ToolbarSpacer/>
                                    </Toolbar>
                                </headerToolbar>
                                <columns>
                                    <Column width="auto">
                                        <Text text="Referrer" />
                                    </Column>
                                </columns>
                                <items>
                                    <ColumnListItem>
                                        <cells>
                                            <SearchField search="onDialogReferrer"/>
                                        </cells>
                                    </ColumnListItem>
                                </items>
                            </Table>
						</uxap:blocks>
					</uxap:ObjectPageSubSection>
				</uxap:subSections>
			</uxap:ObjectPageSection>

		</uxap:sections>
		<uxap:footer>
			<OverflowToolbar>
				<ToolbarSpacer />
				<Button type="Transparent" text="Draft" press=".onDraftButtonPress" />
				<Button type="Transparent" text="Cancel" press=".onCancelButtonPress" />
				<Button type="Emphasized"  text="Save" press=".onSaveButtonPress"/>
			</OverflowToolbar>
		</uxap:footer>
	</uxap:ObjectPageLayout>
</mvc:View>