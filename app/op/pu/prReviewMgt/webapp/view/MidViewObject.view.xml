<mvc:View controllerName="op.pu.prReviewMgt.controller.MidViewObject"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:uxap="sap.uxap"
    xmlns:form="sap.ui.layout.form"
    xmlns:f="sap.ui.layout.form"
    xmlns:core="sap.ui.core"
    xmlns:layout="sap.ui.layout"
    xmlns:tnt="sap.tnt"
    xmlns:co="sap.suite.ui.commons"
    xmlns:si="sap.suite.ui.commons.statusindicator"
    xmlns:u="sap.ui.unified"
    xmlns:table="sap.ui.table"
    xmlns="sap.m"
    height="100%"
>
  <uxap:ObjectPageLayout
    id="page"
    showTitleInHeaderContent="true"
    showEditHeaderButton="true"
    upperCaseAnchorBar="false"
    showFooter="true"
    editHeaderButtonPress="handleEditBtnPress" >

    <uxap:headerTitle>
        <uxap:ObjectPageDynamicHeaderTitle>
            <uxap:expandedHeading>
                <Title text="{I18N>/PR_REVIEW}" wrapping="true" />
            </uxap:expandedHeading>
            <uxap:navigationActions>
                <!-- 전체화면 -->
                <OverflowToolbarButton
                    icon="sap-icon://full-screen"
                    type="Transparent"
                    tooltip="{I18N>/NCM03002}"
                    visible="{= ${fcl>/layout} !== 'MidColumnFullScreen'}"
                    press=".onOverflowToolbarButtonPress($event, 'navigation', { action: 'Full', column: 'two' })"
                />
                <!-- 전체화면해제 -->
                <OverflowToolbarButton
                    icon="sap-icon://exit-full-screen"
                    type="Transparent"
                    tooltip="{I18N>/NCM03003}"
                    visible="{= ${fcl>/layout} === 'MidColumnFullScreen'}"
                    press=".onOverflowToolbarButtonPress($event, 'navigation', { action: 'Exit', column: 'two' })"
                />
                <!-- 뒤로가기 -->
                <OverflowToolbarButton
                    icon="sap-icon://decline"
                    type="Transparent"
                    text="back"
                    tooltip="{I18N>/NCM03001}"
                    press=".onOverflowToolbarButtonPress($event, 'navigation', { action: 'NavBack', column: 'two' })"
                />
            </uxap:navigationActions>
        </uxap:ObjectPageDynamicHeaderTitle>
    </uxap:headerTitle>

    <uxap:headerContent>
      <FlexBox wrap="Wrap" >
        <!-- 구매요청번호 -->
        <layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
            <Label text="{I18N>/PR_NUMBER} :"/>
            <ObjectStatus
                text="{detail>/Pr_ReviewDtlView/pr_number}"
            />
        </layout:VerticalLayout>
        <!-- 생성일자 -->
        <layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
            <Label text="{I18N>/PR_REQUEST_DATE} :"/>
            <ObjectStatus
                text="{
                    path: 'detail>/Pr_ReviewDtlView/request_date',
                    type: 'sap.ui.model.type.Date',
                    formatOptions: {
                        pattern: 'yyyy-MM-dd'
                    }
                }"
            />
        </layout:VerticalLayout>
        <!-- 요청자 -->
        <layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
            <Label text="{I18N>/REQUESTOR_NAME} :"/>
            <ObjectStatus
                text="{detail>/Pr_ReviewDtlView/requestor_name}"
            />
        </layout:VerticalLayout>
        <!-- 생성상태 -->
        <layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
            <Label text="{I18N>/PR_CREATE_STATUS_CODE} :"/>
            <ObjectStatus
                class="sapMObjectStatusLarge"
                text="{detail>/Pr_ReviewDtlView/pr_create_status_name}"
                state="Error"
            />
        </layout:VerticalLayout>
      </FlexBox>
    </uxap:headerContent>

    <uxap:sections id="pss">
    <!-- 기본정보 -->
    <uxap:ObjectPageSection titleUppercase="true" title="{I18N>/BASIC_INFO}">
        <uxap:subSections>
            <uxap:ObjectPageSubSection>
                <uxap:blocks>
                    <form:SimpleForm editable="false">
                        <core:Title text="{I18N>/BASIC_INFO}" />
                        <Label text="{I18N>/PR_NUMBER}"/>
                        <Text text="{detail>/Pr_ReviewDtlView/pr_number}" width="20em" textAlign="Left" />
                        <Label text="{I18N>/ITEM_NUMBER}"/>
                        <Text text="{detail>/Pr_ReviewDtlView/pr_item_number}" width="20em" textAlign="Left" />
                        <Label text="{I18N>/ERP_PR_NUMBER}"/>
                        <Text text="{detail>/Pr_ReviewDtlView/erp_pr_number}" width="20em" textAlign="Left" />
                        <Label text="{I18N>/PROGRESS_STATUS}"/>
                        <Text text="{detail>/Pr_ReviewDtlView/pr_progress_status_name}" width="20em" textAlign="Left" />

                        <core:Title text="" />
                        <Label text="{I18N>/PR_TYPE_CODE}"/>
                        <Text text="{detail>/Pr_ReviewDtlView/pr_type_name}" width="20em" textAlign="Left" />
                        <Label text="{I18N>/PR_TYPE_CODE_2}"/>
                        <Text text="{detail>/Pr_ReviewDtlView/pr_type_name_2}" width="20em" textAlign="Left" />
                        <Label text="{I18N>/ITEM}"/>
                        <Text text="{detail>/Pr_ReviewDtlView/pr_type_name_3}" width="20em" textAlign="Left" />
                        <Label text="{I18N>/PR_TEMPLATE_NUMBER}"/>
                        <Text text="{detail>/Pr_ReviewDtlView/pr_template_name}" width="20em" textAlign="Left" />
                    </form:SimpleForm>
                </uxap:blocks>
            </uxap:ObjectPageSubSection>
        </uxap:subSections>
    </uxap:ObjectPageSection>

    <!-- 품목/담당자 정보 -->
    <uxap:ObjectPageSection titleUppercase="true" title="{I18N>/ITEM_PERSON_INFO}">
        <uxap:subSections>
            <uxap:ObjectPageSubSection>
                <uxap:blocks>
                    <form:SimpleForm editable="false">
                        <core:Title text="{I18N>/ITEM_INFO}" />
                        <Label text="{I18N>/ORG_CODE}"/>
                        <Text text="[{detail>/Pr_ReviewDtlView/org_code}] {detail>/Pr_ReviewDtlView/org_name}"
                            visible="{= !!${detail>/Pr_ReviewDtlView/org_code}}"
                        />
                        <Label text="{I18N>/MATERIAL_CODE}"/>
                        <Text text="{detail>/Pr_ReviewDtlView/material_code}" width="20em" textAlign="Left"
                            visible="{= !!${detail>/Pr_ReviewDtlView/material_code}}"
                        />
                        <Label text="{I18N>/ITEM_NAME}"/>
                        <Text text="{detail>/Pr_ReviewDtlView/pr_desc}" width="20em" textAlign="Left" />
                        <Label text="{I18N>/REMARK}"/>
                        <Text text="{detail>/Pr_ReviewDtlView/remark}" width="20em" textAlign="Left" />

                        <Label text="{I18N>/MATERIAL_GROUP_CODE}"/>
                        <Text text="[{detail>/Pr_ReviewDtlView/material_group_code}] {detail>/Pr_ReviewDtlView/material_group_name}"
                            visible="{= !!${detail>/Pr_ReviewDtlView/material_group_code}}"
                        />
                        <Label text="{I18N>/ITEM_CATEGORY}"/>
                        <Text text="[{detail>/Pr_ReviewDtlView/item_category_code}] {detail>/Pr_ReviewDtlView/item_category_name}" width="20em" textAlign="Left"
                            visible="{= !!${detail>/Pr_ReviewDtlView/item_category_code}}"
                        />
                        <Label text="{I18N>/STORAGE_LOCATION}"/>
                        <Text text="[{detail>/Pr_ReviewDtlView/slot_code}] {detail>/Pr_ReviewDtlView/slot_name}" width="20em" textAlign="Left"
                            visible="{= !!${detail>/Pr_ReviewDtlView/slot_code}}"
                        />

                        <core:Title text="{I18N>/PERSON_INFO}"/>
                        <Label text="{I18N>/PR_REQUESTOR}"/>
                        <Text text="{detail>/Pr_ReviewDtlView/requestor_name} / {detail>/Pr_ReviewDtlView/requestor_department_name}" width="20em" textAlign="Left"
                            visible="{= !!${detail>/Pr_ReviewDtlView/requestor_name}}"
                        />
                        <Label text="{I18N>/BUYER}"/>
                        <Text text="{detail>/Pr_ReviewDtlView/buyer_name} / {detail>/Pr_ReviewDtlView/buyer_department_name}" width="20em" textAlign="Left"
                            visible="{= !!${detail>/Pr_ReviewDtlView/buyer_name}}"
                        />

                        <Label text="{I18N>/REQUESTOR_NAME}"/>
                        <Text text="{detail>/Pr_ReviewDtlView/erp_requestor_name}" width="20em" textAlign="Left" />
                        <Label text="{I18N>/PURCHASING_GROUP_CODE}"/>
                        <Text text="[{detail>/Pr_ReviewDtlView/purchasing_group_code}] {detail>/Pr_ReviewDtlView/purchasing_group_name}" width="20em" textAlign="Left"
                            visible="{= !!${detail>/Pr_ReviewDtlView/purchasing_group_code}}"
                        />
                        <Label text="{I18N>/MATERIAL_PURCHASING_GROUP_CODE}"/>
                        <Text text="[{detail>/Pr_ReviewDtlView/material_purchasing_group_code}] {detail>/Pr_ReviewDtlView/material_purchasing_group_name}" width="20em" textAlign="Left"
                            visible="{= !!${detail>/Pr_ReviewDtlView/material_purchasing_group_code}}"
                        />
                    </form:SimpleForm>
                </uxap:blocks>
            </uxap:ObjectPageSubSection>
        </uxap:subSections>
    </uxap:ObjectPageSection>

    <!-- 수량/금액/일자/공급업체 정보 -->
    <uxap:ObjectPageSection titleUppercase="true" title="{I18N>/QTY_AMT_DATE_INFO}">
        <uxap:subSections>
            <uxap:ObjectPageSubSection>
                <uxap:blocks>
                    <form:SimpleForm editable="false">
                        <core:Title text="{I18N>/QTY_AMT_INFO}"/>
                        <!-- 요청수량 -->
                        <Label text="{I18N>/REQUEST_QUANTITY}"/>
                        <Text
                            text="{
                                parts: [
                                    { path: 'detail>/Pr_ReviewDtlView/pr_quantity', formatter: '.numberFormatter.toNumberString' },
                                    { path: 'detail>/Pr_ReviewDtlView/pr_unit' }
                                ]
                            }"
                            width="20em"
                            textAlign="Left"
                        />
                        <!-- 잔여수량 -->
                        <Label text="{I18N>/REMAIN_QUANTITY}"/>
                        <Text
                            text="{
                                parts: [
                                    { path: 'detail>/Pr_ReviewDtlView/remain_quantity', formatter: '.numberFormatter.toNumberString' },
                                    { path: 'detail>/Pr_ReviewDtlView/pr_unit' }
                                ]
                            }"
                            width="20em"
                            textAlign="Left"
                        />
                        <!-- 마감수량 -->
                        <Label text="{I18N>/CLOSING_QUANTITY}"/>
                        <Text
                            text="{
                                parts: [
                                    { path: 'detail>/Pr_ReviewDtlView/closing_quantity', formatter: '.numberFormatter.toNumberString' },
                                    { path: 'detail>/Pr_ReviewDtlView/pr_unit' }
                                ]
                            }"
                            width="20em"
                            textAlign="Left"
                        />
                        <!-- 단가예산 -->
                        <Label text="{I18N>/NET_PRICE_BUDGET}"/>
                        <Text
                            text="{
                                parts: [
                                    { path: 'detail>/Pr_ReviewDtlView/estimated_price', formatter: '.numberFormatter.toNumberString' },
                                    { path: 'detail>/Pr_ReviewDtlView/currency_code' }
                                ]
                            }"
                            width="20em"
                            textAlign="Left"
                        />
                        <!-- Per -->
                        <Label text="{I18N>/PER}"/>
                        <Text text="{detail>/Pr_ReviewDtlView/price_unit}" width="20em" textAlign="Left" />
                        <!-- 금액 -->
                        <Label text="{I18N>/AMOUNT}"/>
                        <Text
                            text="{
                                parts: [
                                    { path: 'detail>/Pr_ReviewDtlView/pr_amount', formatter: '.numberFormatter.toNumberString' },
                                    { path: 'detail>/Pr_ReviewDtlView/currency_code' }
                                ]
                            }"
                            width="20em"
                            textAlign="Left"
                        />

                        <core:Title text="{I18N>/DATE_INFO}" />
                        <!-- 생성일자 -->
                        <Label text="{I18N>/PR_REQUEST_DATE}"/>
                        <Text
                            text="{
                                path: 'detail>/Pr_ReviewDtlView/request_date',
                                formatter: '.dateFormatter.toUTCDateString'
                            }"
                            width="20em"
                            textAlign="Left"
                        />
                        <!-- 납품요청일 -->
                        <Label text="{I18N>/DELIVERY_REQUEST_DATE}"/>
                        <Text
                            text="{
                                path: 'detail>/Pr_ReviewDtlView/delivery_request_date',
                                formatter: '.dateFormatter.toUTCDateString'
                            }"
                            width="20em"
                            textAlign="Left"
                        />
                        <!-- 확정일자 -->
                        <Label text="{I18N>/CONFIRMED_DATE}"/>
                        <Text
                            text="{
                                path: 'detail>/Pr_ReviewDtlView/confirmed_date',
                                formatter: '.dateFormatter.toUTCDateString'
                            }"
                            width="20em"
                            textAlign="Left"
                        />
                        <!-- 변경일자 -->
                        <Label text="{I18N>/CHANGE_DATE}"/>
                        <Text
                            text="{
                                path: 'detail>/Pr_ReviewDtlView/local_update_dtm',
                                formatter: '.dateFormatter.toUTCDateString'
                            }"
                            width="20em"
                            textAlign="Left"
                        />
                    </form:SimpleForm>
                </uxap:blocks>
            </uxap:ObjectPageSubSection>
        </uxap:subSections>
    </uxap:ObjectPageSection>

    <!-- 계정지정 정보 -->
    <uxap:ObjectPageSection titleUppercase="true" title="{I18N>/SUPPLIER_INFO}" visible="{= !!${detail>/Pr_ReviewDtlView/supplier_code}}">
        <uxap:subSections>
            <uxap:ObjectPageSubSection>
                <uxap:blocks>
                    <form:SimpleForm>
                        <core:Title text="{I18N>/SUPPLIER_INFO}" />
                        <Label text="{I18N>/SUPPLIER}"/>
                        <Text text="[{detail>/Pr_ReviewDtlView/supplier_code}] {detail>/Pr_ReviewDtlView/supplier_name}" width="20em" textAlign="Left" />

                        <core:Title text="" />
                    </form:SimpleForm>
                </uxap:blocks>
            </uxap:ObjectPageSubSection>
        </uxap:subSections>
    </uxap:ObjectPageSection>

    <!-- 계정지정 정보 -->
    <uxap:ObjectPageSection titleUppercase="true" title="{I18N>/ACCOUNT_ASSIGNMENT_INFO}" visible="{= ${accounts>/Pr_ReviewDtlAcctView}.length > 0}">
        <uxap:subSections>
            <uxap:ObjectPageSubSection>
                <uxap:blocks>
                    <VBox class="sapUiSmallMargin">
                        <Table
                            id="accountsTable"
                            visible="true"
                            sticky="HeaderToolbar,ColumnHeaders"
                            inset="false"
                            growing="true"
                            mode="None"
                            growingThreshold="10"
                            class="sapFDynamicPageAlignContent"
                            items="{
                                path : 'accounts>/Pr_ReviewDtlAcctView',
                                sorter: {
                                    path: 'pr_number',
                                    descending: true
                                }
                            }"
                            width="auto"
                        >
                            <headerToolbar>
                                <OverflowToolbar>
                                    <!-- <Title text="{I18N>/ACCOUNT_ASSIGNMENT_INFO} ({= ${accounts>/Pr_ReviewDtlAcctView}.length || 0})" level="H2"/> -->
                                    <!-- <Title text="{I18N>/ACCOUNT_ASSIGNMENT_INFO}" level="H2"/> -->
                                    <ToolbarSpacer/>
                                    <Button
                                        icon="sap-icon://excel-attachment"
                                        press="onExcel($event, 'Download', ${accounts>/Pr_ReviewDtlAcctView}, {
                                            fileName: 'Account List',
                                            tId: 'accountsTable'
                                        })"
                                    >
                                        <layoutData>
                                            <OverflowToolbarLayoutData priority="NeverOverflow" />
                                        </layoutData>
                                    </Button>
                                    <!-- <Button icon="sap-icon://action-settings" press=".onButtonPress($event, 'personalize', {})">
                                        <layoutData>
                                            <OverflowToolbarLayoutData priority="NeverOverflow" />
                                        </layoutData>
                                    </Button>  -->
                                </OverflowToolbar>
                            </headerToolbar>
                            <columns>
                                <!-- 구매요청 번호 -->
                                <Column hAlign="Center" width="auto">
                                    <Text text="{I18N>/CCTR_NAME}" />
                                </Column>
                                <!-- 구매요청 유형 -->
                                <Column hAlign="Center" width="auto">
                                    <Text text="{I18N>/ACCOUNT_CODE}" />
                                </Column>
                                <!-- 품목 번호 -->
                                <Column hAlign="Center" width="auto">
                                    <Text text="{I18N>/WBS_CODE}" />
                                </Column>
                                <!-- 조직코드 -->
                                <Column hAlign="Center" width="auto">
                                    <Text text="{I18N>/ASSET_NUMBER}" />
                                </Column>
                                <!-- 자재코드 -->
                                <Column demandPopin="true" minScreenWidth="Desktop" popinDisplay="Inline" hAlign="Center" width="auto">
                                    <Text text="{I18N>/ACCOUNT_ASSIGNMENT_CATEGORY}" />
                                </Column>
                            </columns>
                            <items>
                                <ColumnListItem type="Navigation">
                                    <cells>
                                        <!-- 코스트센터 -->
                                        <Text text="[{accounts>cctr_code}] {accounts>cctr_name}"
                                            visible="{=!!${accounts>cctr_code}}"
                                        />
                                        <!-- 계정코드 -->
                                        <Text text="[{accounts>account_code}] {accounts>account_name}"
                                            visible="{=!!${accounts>account_code}}"
                                        />
                                        <!-- WBS코드 -->
                                        <Text text="[{accounts>wbs_code}] {accounts>wbs_name}"
                                            visible="{=!!${accounts>wbs_code}}"
                                        />
                                        <!-- 오더번호 -->
                                        <Text text="[{accounts>order_number}] {accounts>order_name}"
                                            visible="{=!!${accounts>order_number}}"
                                        />
                                        <!-- 자산번호 -->
                                        <Text text="[{accounts>asset_number}] {accounts>asset_name}"
                                            visible="{=!!${accounts>asset_number}}"
                                        />
                                        <!-- 계정지정범주 -->
                                        <Text text="[{accounts>account_assignment_category_code}] {accounts>account_assignment_category_name}"
                                            visible="{=!!${accounts>account_assignment_category_code}}"
                                        />
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                    </VBox>
                </uxap:blocks>
            </uxap:ObjectPageSubSection>
        </uxap:subSections>
    </uxap:ObjectPageSection>
    </uxap:sections>

    <uxap:footer>
        <OverflowToolbar>
            <ToolbarSpacer/>
            <Button
                text="{I18N>/PR_REVIEW_CLOSING_CANCEL}"
                type="Emphasized"
                press=".onButtonPress($event, 'service', ${detail>/Pr_ReviewDtlView}, {
                    action: 'CLOSING_CANCEL',
                    service: 'op.prReviewMgtV4Service',
                    entry: 'CallPrReviewSaveProc'
                })"
                visible="{detail>/Pr_ReviewDtlView/closing_flag}"
            />
            <Button
                text="{I18N>/COST_BM}"
                type="Transparent"
                press=".onButtonPress($event, 'service', ${detail>/Pr_ReviewDtlView}, {
                    action: 'undefined',
                    service: 'op.prReviewMgtV4Service',
                    entry: 'CallPrReviewSaveProc'
                })"
                visible="true"
            />
            <Button
                text="{I18N>/CHANGE_HISTORY}"
                type="Transparent"
                press=".onButtonPress($event, 'service', ${detail>/Pr_ReviewDtlView}, {
                    action: 'CHANGE_HISTORY',
                    service: 'op.prReviewMgtV4Service',
                    entry: 'CallPrReviewSaveProc'
                })"
                visible="true"
            />
            <Button
                text="{I18N>/ORDER_HISTORY}"
                type="Transparent"
                press=".onButtonPress($event, 'service', ${detail>/Pr_ReviewDtlView}, {
                    action: 'undefined',
                    service: 'op.prReviewMgtV4Service',
                    entry: 'CallPrReviewSaveProc'
                })"
                visible="true"
            />
            <Button
                text="{I18N>/USE_ACTUAL}"
                type="Transparent"
                press=".onButtonPress($event, 'service', ${detail>/Pr_ReviewDtlView}, {
                    action: 'undefined',
                    service: 'op.prReviewMgtV4Service',
                    entry: 'CallPrReviewSaveProc'
                })"
                visible="true"
            />
            <Button text="{I18N>/CLOSE}" type="Transparent"  press=".onButtonPress($event, 'navigation', { action: 'NavBack' })" />
        </OverflowToolbar>
    </uxap:footer>
  </uxap:ObjectPageLayout>
</mvc:View>