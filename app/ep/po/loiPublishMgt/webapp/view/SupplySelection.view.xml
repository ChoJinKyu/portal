<mvc:View controllerName="ep.po.loiPublishMgt.controller.SupplySelection" 
	xmlns:mvc="sap.ui.core.mvc" 
	xmlns="sap.m" 
	xmlns:uxap="sap.uxap" 
	xmlns:layout="sap.ui.layout" 
    xmlns:form="sap.ui.layout.form"
    xmlns:t="sap.ui.table"
    xmlns:sc="sap.suite.ui.commons"
	xmlns:core="sap.ui.core"
    xmlns:richtexteditor="sap.ui.richtexteditor"
    xmlns:sp-ui="sp.util.control.ui"
	height="100%">

	<uxap:ObjectPageLayout id="page"
		toggleHeaderOnTitleClick="true"
		alwaysShowContentHeader = "true"
		preserveHeaderStateOnScroll="false"
		headerContentPinnable="true"
		isChildPage="true"
		upperCaseAnchorBar="false"
		showTitleInHeaderContent="true"
		showEditHeaderButton="true" 
		showFooter="false">
     
		<uxap:headerTitle>
			<uxap:ObjectPageDynamicHeaderTitle>
                <uxap:heading>
                    <HBox alignItems="End">
                        <OverflowToolbarButton type="Transparent" icon="sap-icon://nav-back" press=".onPageNavBackButtonPress"  tooltip="Close column" visible="{= ${/actionButtonsInfo/midColumn/closeColumn} !== null }"/>
                        <Title text="LOI 업체선정 품의" wrapping="true" class="" />
                    </HBox>
                </uxap:heading>            
				<!-- <uxap:expandedHeading>
					<Title text="LOI 업체선정 품의" wrapping="true" />
				</uxap:expandedHeading>
				<uxap:snappedHeading>
					<Title text="LOI 업체선정 품의" wrapping="true" />
				</uxap:snappedHeading> -->
                <uxap:navigationActions>
					<!-- <OverflowToolbarButton id="pageNavBackButton" type="Transparent" icon="sap-icon://decline" text="back" tooltip="back to the list" press=".onPageNavBackButtonPress" visible="{= ${/actionButtonsInfo/midColumn/closeColumn} !== null }"/> -->
                </uxap:navigationActions>
			</uxap:ObjectPageDynamicHeaderTitle>
		</uxap:headerTitle>

		<uxap:headerContent>
			<FlexBox wrap="Wrap" visible="true">
				<layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                    <ObjectStatus
                        title="LOI 번호: "
                        text="{midObjectViewModel>/viewLoiNumber}"/>
                    <ObjectStatus
                        id="createUser"         
                        title="작성자"
                        text="{master>/buyer_name}"/>
				</layout:VerticalLayout>

                <layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                    <ObjectStatus 
                        id="createDate"
                        title="작성일자"
                        text="{
                                path: 'master>/supplier_selection_date',
                                formatter: '.dateFormatter.toUTCDateString'
                            }" />

                    <ObjectStatus
                        id="createDepartment"
                        title="작성부서"
                        text="{master>/purchasing_department_name}"/>
                    </layout:VerticalLayout>

                    <layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                        <Label text="Status :"/>
                    <ObjectStatus
                        class="sapMObjectStatusLarge"
                        text="{master>/loi_selection_status_name}"
                        state="Error" />
                </layout:VerticalLayout>

                <!-- <layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                    <Label text="Process : "/>
                    <HBox>
                        <sc:MicroProcessFlow>
                            <sc:content>
                                <sc:MicroProcessFlowItem state="None" stepWidth="3rem" />
                                <sc:MicroProcessFlowItem state="Error" stepWidth="3rem" icon="sap-icon://circle-task" />
                                <sc:MicroProcessFlowItem state="None" stepWidth="3rem" />
                                <sc:MicroProcessFlowItem state="None" stepWidth="3rem" />
                            </sc:content>
                        </sc:MicroProcessFlow>
                    </HBox>
                    <HBox>
                        <Text text="LOI요청"  width="4em" renderWhitespace="true" />
                        <Text text=" LOI업체&#10; 선정"  width="4em" renderWhitespace="true" />
                        <Text text="LOI발행" width="6em" textAlign="Center" />
                        <Text text=" LOI발행&#10; 통보" renderWhitespace="true" />
                    </HBox>
                </layout:VerticalLayout>   -->

			</FlexBox>
		</uxap:headerContent>

		<uxap:sections>
			<uxap:ObjectPageSection id="pageSectionMain" titleUppercase="false" title="품의정보">
				<uxap:subSections>
					<uxap:ObjectPageSubSection id="pageSubSection1">
                    <form:SimpleForm id="midObjectForm" editable="{midObjectViewModel>/isEditMode}">                    
                        <VBox alignContent="Center" alignItems="Stretch" class="sapUiSmallMarginBegin"> 
                            <!-- <Label  text="* 품의명" 
                                    required="{midObjectViewModel>/isEditMode}"
                                    design="Bold" 
                                    class="sapUiSmallMarginBottom" />
                            <Input value="{
                                path: 'master>/loi_selection_title',
                                type: 'sap.ui.model.type.String',
                                constraints: {
                                    maxLength: 50
                                }
                            }" class="sapMLabelNoText" required="{midObjectViewModel>/isEditMode}" width="98%" editable="{midObjectViewModel>/isEditMode}"/> -->
                   
                            <Label  text="* 품의명" 
                                    required="true"
                                    design="Bold" 
                                    class="sapUiSmallMarginBottom" visible="{midObjectViewModel>/isEditMode}"/>
                            <Input value="{
                                path: 'master>/loi_selection_title',
                                type: 'sap.ui.model.type.String',
                                constraints: {
                                    maxLength: 50
                                }
                            }" class="sapMLabelNoText" required="true" width="70%" visible="{midObjectViewModel>/isEditMode}"/>
                            <Label  text="* 품의명" 
                                    design="Bold" 
                                    class="sapUiSmallMarginBottom" visible="{= ${midObjectViewModel>/isEditMode} === true ? false : true }"/>                            
                            <Text text="{master>/loi_selection_title}" class="sapMLabelNoText" width="98%" visible="{= ${midObjectViewModel>/isEditMode} === true ? false : true }"/>

                            <Label  text="* 업체선정결과" 
                                    design="Bold" 
                                    class="sapUiSmallMarginTop"/>
                            <t:Table id="mainTable"
                            selectionMode="None"
                            rows="{
                                path: 'details>/',
                                sorter: { 
                                    path: 'system_create_dtm',
                                    descending: true 
                                }                   
                            }"
                            cellClick=".onCellClick"
                            rowSelectionChange=".onCheck"
                            visibleRowCount="5"
                            columnResize="onColumnResize">
                            <!-- <t:extension>
                                <OverflowToolbar class="sapFDynamicPageAlignContent">
                                <Title text="업체선정결과 {= ${details>/}.length > 0 ? '(' + ${details>/}.length + ')' : ''}" level="H2"/>
                                <ToolbarSpacer/>
                                <Button text="{I18N>/RFQ_CREATE}" id="RfqButton" press=".onRfqButtonPress" type="Transparent"/>
                                <Button text="{I18N>/SUPPLIER_SELECTION_APPROVAL}" id="supplierSelectionButton" press=".onSupplierSelectionButtonPress" type="Transparent"/>
                                <Button text="{I18N>/PUBLISH_APPROVAL}" id="publishButton" press=".onPublishButtonPress"   type="Transparent"/>
                                <Button text="{I18N>/ORDER_MAPPING}" id="poMappingButton" press=".onSave('mainTable', 'list')"   type="Transparent"/>
                                <Button text="{I18N>/ORDER_MAPPING_CANCEL}" id="poMappingCansel" press=".onSave('mainTable', 'list')"   type="Transparent"/>
                                <ToolbarSeparator/>
                                <Button icon="sap-icon://action-settings" press=".onMainTablePersoButtonPressed" >
                                    <layoutData>
                                    <OverflowToolbarLayoutData priority="NeverOverflow"/>
                                    </layoutData>
                                </Button>
                                </OverflowToolbar>
                            </t:extension> -->
                            <t:columns>
                                <t:Column id="mainLoiNumber" width="6rem" hAlign="Center">
                                <Label text="Line No." textAlign="Center" width="100%"/>
                                <t:template>
                                    <Text text="{details>item_sequence}" textAlign="Center"/>
                                </t:template>
                                </t:Column>
                                <t:Column id="mainItemSequence" width="5rem">
                                <Label text="플랜트" textAlign="Center" width="100%"/>
                                <t:template>
                                    <Text text="{details>plant_name}"/>
                                </t:template>
                                </t:Column>
                                <t:Column id="mainLoiRequestTitle" width="12rem">
                                <Label text="품명" textAlign="Center" width="100%"/>
                                <t:template>
                                    <Text text="{details>item_desc}" />
                                </t:template>
                                </t:Column> 
                                <t:Column id="mainItemDesc" width="7rem">
                                <Label text="규격" textAlign="Center" width="100%"/>
                                <t:template>
                                    <Text text="{details>spec_desc}"/>
                                </t:template>
                                </t:Column>
                                <t:Column id="mainSupplierName" width="4rem" hAlign="Center">
                                <Label text="단위" textAlign="Center" width="100%"/>
                                <t:template>
                                    <Text text="{details>unit}" textAlign="Center"/>
                                </t:template>
                                </t:Column>
                                <t:Column id="mainPublishDate" width="6rem" hAlign="Right">
                                <Label text="수량" textAlign="Center" width="100%" />
                                <t:template>
                                    <Text text="{details>request_quantity}" textAlign="Right"/>
                                </t:template>
                                </t:Column>  
                                <t:Column id="mainDeliveryRequestDate" width="4rem" hAlign="Center">
                                <Label text="통화" textAlign="Center" width="100%"/>
                                <t:template>
                                    <Text text="{details>currency_code}" textAlign="Center"/>
                                </t:template>
                                </t:Column>
                                <t:Column id="mainRequestQuantity" width="6rem" hAlign="Right">
                                <Label text="요청금액" textAlign="Center" width="100%"/>
                                <t:template>
                                    <Text text="{details>request_amount}" textAlign="Right"/>
                                </t:template>
                                </t:Column>
                                <t:Column id="mainCurrencyCode" width="6rem" hAlign="Left">
                                <Label text="선정결과" textAlign="Center" width="100%"/>
                                <t:template>
                                    <Text text="{details>selection_result}"/>
                                </t:template>
                                </t:Column> 
                                <t:Column id="mainRequestAmount" width="14rem" hAlign="Left">
                                <Label text="참여업체" textAlign="Center" width="100%"/>
                                <t:template>
                                    <HBox justifyContent="Center">
                                        <Text text="{details>supplier_name}" visible="{= ${details>offline_flag} === true ? false : true }"/>
                                        <!-- <Input value="{
                                                            path: 'details>offline_selection_supplier_name',
                                                            type: 'sap.ui.model.type.String',
                                                            constraints: {
                                                                maxLength: 50
                                                            }
                                                        }" visible="{details>offline_flag}"/>   -->
                                        <Input value="{details>offline_selection_supplier_name}" 
                                            placeholder="참여업체" width="13rem"
                                            showValueHelp="true" valueHelpRequest=".openSupplierPopupInTable"
                                            visible="{= ${details>offline_flag} === true &amp;&amp; ${midObjectViewModel>/isEditMode} === true ? true : false }" />
                                        <Text text="{details>offline_selection_supplier_name}" visible="{= ${details>offline_flag} === true &amp;&amp; ${midObjectViewModel>/isEditMode} === false ? true : false }" />     
                                        <Text text="{details>offline_selection_supplier_code}" visible="false" /> 
                                    </HBox>                                                  
                                </t:template>
                                </t:Column>
                                <t:Column id="mainLoiSelectionStatusCode" width="8rem" hAlign="Right">
                                <Label text="환산견적금액" textAlign="Center" width="100%" tooltip="환산견적금액"/>
                                <t:template>
                                    <HBox justifyContent="End">
                                        <Text text="{details>quotation_amount}" textAlign="Right" visible="{= ${details>offline_flag} === true ? false : true }"/>
                                        <Input value="{
                                                            path: 'details>offline_quotation_amount',
                                                            type: 'sap.ui.model.type.Integer',
                                                            constraints: {
                                                                minimum: '0',
                                                                maximum: '1000000000000'
                                                            }
                                                        }" 
                                                        textAlign="Right" 
                                                        visible="{= ${details>offline_flag} === true &amp;&amp; ${midObjectViewModel>/isEditMode} === true ? true : false }" />
                                        <Text text="{
                                                    path: 'details>offline_quotation_amount',
                                                    formatter: '.numberFormatter.toNumberString'
                                                }" textAlign="Right" visible="{= ${details>offline_flag} === true &amp;&amp; ${midObjectViewModel>/isEditMode} === false ? true : false }" />                     
                                    </HBox>                      
                                </t:template>
                                </t:Column>
                                <t:Column id="mainLoiPublishStatusCode" width="7rem" hAlign="Center">
                                <Label text="요청납기일자" textAlign="Center" width="100%" tooltip="요청납기일자"/>
                                <t:template>
                                    <Text text="{details>delivery_request_date}" textAlign="Center"/>
                                </t:template>
                                </t:Column> 
                                <t:Column id="mainPoStatusCode" width="10rem" hAlign="Center">
                                <Label text="견적납기일자" textAlign="Center" width="100%" tooltip="발주상태"/>
                                <t:template>
                                    <HBox justifyContent="Center">
                                        <Text text="{details>quotation_due_date}" visible="{= ${details>offline_flag} === true ? false : true }"/>
                                        <DatePicker value="{ 
                                            path: 'details>offline_quotation_due_date', 
                                            formatOptions: { UTC: true, format: 'yMd' } }" 
                                            displayFormat="yyyy-MM-dd" valueFormat="yyyy-MM-dd" 
                                            placeholder="Date" 
                                            visible="{= ${details>offline_flag} === true &amp;&amp; ${midObjectViewModel>/isEditMode} === true ? true : false }" />
                                        <Text text="{details>offline_quotation_due_date}" visible="{= ${details>offline_flag} === true &amp;&amp; ${midObjectViewModel>/isEditMode} === false ? true : false }" />                             
                                    </HBox>  
                                </t:template>
                                </t:Column>
                                <t:Column id="mainRequestDepartmentName" width="12rem">
                                <Label text="견적비고" textAlign="Center" width="100%"/>
                                <t:template>
                                    <HBox>
                                        <Text text="{details>quotation_remark}" visible="{= ${details>offline_flag} === true ? false : true }"/>
                                        <Input value="{
                                                            path: 'details>offline_quotation_remark',
                                                            type: 'sap.ui.model.type.String',
                                                            constraints: {
                                                                maxLength: 50
                                                            }
                                                        }" 
                                                        visible="{= ${details>offline_flag} === true &amp;&amp; ${midObjectViewModel>/isEditMode} === true ? true : false }" />
                                        <Text text="{details>offline_quotation_remark}" visible="{= ${details>offline_flag} === true &amp;&amp; ${midObjectViewModel>/isEditMode} === false ? true : false }" />                
                                    </HBox>                 
                                </t:template>
                                </t:Column>
                                <t:Column id="mainRequestorName" width="7rem">
                                <Label text="견적번호" textAlign="Center" width="100%"/>
                                <t:template>
                                    <Text text="{= ${details>offline_flag} === true ? '' : '12345678' }"/>
                                </t:template>
                                </t:Column>  
                            </t:columns>
                            </t:Table>

                            <!-- <Table id="tableAttachments" 
                                sticky="HeaderToolbar,ColumnHeaders" 
                                inset="false" 
                                visible="{midObjectViewModel>/existRfq}"
                                class="sapFDynamicPageAlignContent" 
                                items="{
                                    path: 'list>/LOIPublishItemView' 
                                }"                                  
                                mode="None"
                                width="98%">
                                <columns>
                                     <Column minScreenWidth="Tablet" hAlign="Center"  >
                                        <Text text="Line No." />
                                    </Column>
                                     <Column minScreenWidth="Tablet" hAlign="Center"  >
                                        <Text text="플랜트" />
                                    </Column>
                                     <Column minScreenWidth="Tablet" hAlign="Center"  >
                                        <Text text="품명" />
                                    </Column>
                                     <Column minScreenWidth="Tablet" hAlign="Center"  >
                                        <Text text="단위" />
                                    </Column>
                                     <Column minScreenWidth="Tablet" hAlign="Center"  >
                                        <Text text="수량" />
                                    </Column>
                                     <Column minScreenWidth="Tablet" hAlign="Center"  >
                                        <Text text="통화" />
                                    </Column>  
                                     <Column minScreenWidth="Tablet" hAlign="Center"  >
                                        <Text text="요청금액" />
                                    </Column> 
                                     <Column minScreenWidth="Tablet" hAlign="Center"  >
                                        <Text text="선정업체" />
                                    </Column>
                                     <Column minScreenWidth="Tablet" hAlign="Center" width="8rem">
                                        <Text text="환산견적금액" />
                                    </Column>
                                     <Column minScreenWidth="Tablet" hAlign="Center" width="8rem">
                                        <Text text="요청납기일자" />
                                    </Column>
                                     <Column minScreenWidth="Tablet" hAlign="Center" width="8rem">
                                        <Text text="견적납기일자" />
                                    </Column>
                                     <Column minScreenWidth="Tablet" hAlign="Center"  >
                                        <Text text="견적비고" />
                                    </Column>  
                                </columns>
                                <items>
                                    <ColumnListItem type="Inactive" visible="{midObjectViewModel>/existRfq}">
                                        <cells>
                                            <Text text="{details/item_sequence}"/>
                                            <Text text="{details/plant_name}"/>
                                            <Text text="{details/item_desc}"/>
                                            <Text text="{details/spec_desc}"/>
                                            <Text text="{details/unit}"/>
                                            <Text text="{details/request_quantity}"/>
                                            <Text text="{details/currency_code}"/>
                                            <Text text="{details/request_amount}"/>
                                            <Text text="{details/offline_selection_supplier_code}"/>
                                            <Text text="{details/offline_quotation_amount}"/>
                                            <Text text="{details/delivery_request_date}"/>
                                            <Text text="{details/offline_quotation_due_date}"/>
                                            <Text text="{details/offline_quotation_remark}"/>
                                        </cells>
                                    </ColumnListItem>
                                </items>                                
                            </Table> -->

                            <Label  text="* 특기사항" 
                                        design="Bold" 
                                        class="sapUiMediumMarginTop sapUiSmallMarginBottom"/>
                            <richtexteditor:RichTextEditor
                                editorType="TinyMCE4"
                                width="98%"
                                height="200px"
                                editable="{midObjectViewModel>/isEditMode}"
                                customToolbar="true"
                                showGroupFont="true"
                                showGroupLink="true"
                                showGroupInsert="true"
                                value="{master>/special_note}">
                            </richtexteditor:RichTextEditor>                            
                        </VBox>
                        </form:SimpleForm>                    
					</uxap:ObjectPageSubSection>
				</uxap:subSections>
			</uxap:ObjectPageSection>

            <!-- 첨부파일 시작 -->
			<uxap:ObjectPageSection titleUppercase="false" title="첨부파일">
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
						<uxap:blocks>
                            <!-- File Upload 시작-->
                            <UploadCollection
                                id="UploadCollection"
                                maximumFilenameLength="55"
                                maximumFileSize="10"
                                multiple="true"
                                sameFilenameAllowed="true"
                                instantUpload="false"
                                noDataDescription="Drop files or use the &quot;Add&quot; button to keep files ready for upload"
                                change="onChange"
                                fileDeleted="onFileDeleted"
                                filenameLengthExceed="onFilenameLengthExceed"
                                fileSizeExceed="onFileSizeExceed"
                                typeMissmatch="onTypeMissmatch"
                                uploadComplete="onUploadComplete"
                                beforeUploadStarts="onBeforeUploadStarts" />
                            <!-- File Upload 끝-->
						</uxap:blocks>
					</uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>
            <!-- 첨부파일 끝 -->

            <!-- 결재라인 시작 -->
			<uxap:ObjectPageSection titleUppercase="false" title="결재라인">
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
						<uxap:blocks>
                            <!-- Approval & Reference 시작 -->
                            <HBox>
        
                            </HBox>
                            <!-- Approval & Reference 끝 -->
						</uxap:blocks>
					</uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>
            <!-- 결재라인 끝 -->

		</uxap:sections>
		
		<uxap:footer>
			<OverflowToolbar>
                <Button
                    icon="sap-icon://alert"
                    type="Emphasized"
                    text="{= ${message>/}.length }"
                    visible="{= ${message>/}.length > 0 }"
                    ariaHasPopup="Dialog"
                    press=".onMessagePopoverPress" />
				<ToolbarSpacer />
                <Button id="pageEditButton" type="Transparent" text="Edit" press=".onPageEditButtonPress" />
                <Button id="pageSaveButton" type="Emphasized" text="Draft" press=".onPageSaveButtonPress('D')" />
                <Button id="pageCancelButton" type="Transparent" text="Cancel" press=".onPageCancelEditButtonPress"/>
                <Button id="pageDeleteButton" type="Transparent" text="Delete" press=".onPageDeleteButtonPress" visible="{= ${editMode>/newcheck} === 'new' ? false : true}"/>                
                <Button id="pageRequestButton" type="Emphasized" text="Request" press=".onPageSaveButtonPress('R')" />
                <Button id="pageByPassButton" type="Emphasized" text="ByPass" press=".onPageSaveButtonPress('B')" />
				
			</OverflowToolbar>
		</uxap:footer>
    </uxap:ObjectPageLayout>

    <sp-ui:SupplierWithOrgDialog id="supplierWithOrgDialog" 
        title="협력사 검색"
        items="{
            filters: [
                {path: 'tenant_id', operator: 'EQ', value1: 'L2100'}
            ]
        }"
        apply=".onSupplierDialogApplyPress"
    />      

</mvc:View>