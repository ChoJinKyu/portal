<mvc:View controllerName="ep.po.loiRequestMgt.controller.MidObject" 
	xmlns:mvc="sap.ui.core.mvc" 
	xmlns="sap.m" 
	xmlns:uxap="sap.uxap" 
	xmlns:layout="sap.ui.layout"
    xmlns:form="sap.ui.layout.form"
    xmlns:co="sap.suite.ui.commons"
	xmlns:core="sap.ui.core"
    xmlns:sc="sap.suite.ui.commons" 
    xmlns:microchart="sap.suite.ui.microchart" 
    xmlns:lib-m="ext.lib.control.m"
    xmlns:t="sap.ui.table"
    xmlns:cm-ui="cm.util.control.ui"
    xmlns:sp-ui="sp.util.control.ui"
    xmlns:html="http://www.w3.org/1999/xhtml"
	height="100%">

	<uxap:ObjectPageLayout id="page"
		toggleHeaderOnTitleClick="false"
		alwaysShowContentHeader = "true"
		preserveHeaderStateOnScroll="false"
		headerContentPinnable="false"
		isChildPage="true"
		upperCaseAnchorBar="false"
		showTitleInHeaderContent="true"
		showEditHeaderButton="true" 
		showFooter="true">
       
        <uxap:headerTitle>
			<uxap:ObjectPageDynamicHeaderTitle>
                <uxap:heading>
                    <HBox alignItems="End">
                        <OverflowToolbarButton type="Transparent" icon="sap-icon://nav-back" press=".onPageNavBackButtonPress"  tooltip="Close column" visible="{= ${/actionButtonsInfo/midColumn/closeColumn} !== null }"/>
                        <Title text="LOI 발행요청 상세" wrapping="true" class="" />
                    </HBox>
                </uxap:heading>            
                <uxap:navigationActions>
					<!-- <OverflowToolbarButton id="pageNavBackButton" type="Transparent" icon="sap-icon://decline" text="back" tooltip="back to the list" press=".onPageNavBackButtonPress" visible="{= ${/actionButtonsInfo/midColumn/closeColumn} !== null }"/> -->
                </uxap:navigationActions>
			</uxap:ObjectPageDynamicHeaderTitle>
        </uxap:headerTitle>
        

		<uxap:headerContent>
			<FlexBox wrap="Wrap" visible="true">
				<layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                    <ObjectStatus
                        title="{I18N>/LOI_NUMBER}: "
                        text="{master>/loi_number}"/>
                    <ObjectStatus
                    title="{I18N>/REQUESTOR}"
                    text="{master>/requestor_name}"/>
				</layout:VerticalLayout>

                <layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                    <ObjectStatus
                        title="{I18N>/REQUEST_DATE}"
                        text="{
                                path: 'master>/request_date',
                                type: 'sap.ui.model.type.Date',
                                formatter: {
                                pattern: 'yyyy/MM/dd'
                                }
                            }" />

                    <ObjectStatus
                        title="{I18N>/REQUEST_DEPARTMENT}"
                        text="{master>/request_department_name}"/>
                    </layout:VerticalLayout>

                    <layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                        <Label text="Status :"/>
                    <ObjectStatus
                        class="sapMObjectStatusLarge"
                        text="{master>/loi_request_status_name}"
                        state="Error" />
                            </layout:VerticalLayout>

                            <layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                    <!-- <Label text="Process 2 : "/>
                        <HBox>
                            <sc:MicroProcessFlow>
                                <sc:content>
                                    <sc:MicroProcessFlowItem state="Error" stepWidth="3rem" icon="sap-icon://circle-task" />
                                    <sc:MicroProcessFlowItem state="None" stepWidth="3rem" />
                                    <sc:MicroProcessFlowItem state="None" stepWidth="3rem" />
                                    <sc:MicroProcessFlowItem state="None" stepWidth="3rem" />
                                </sc:content>
                            </sc:MicroProcessFlow>
                        </HBox>
                        <HBox>
                            <Text text="LOI요청"  width="4em" renderWhitespace="true" />
                            <Text text=" LOI업체&#10; 선정"  width="4em" renderWhitespace="true" />
                            <Text text="LOI발행" width="6em" textAlign="Center" />
                            <Text text=" LOI발행&#10; 통보" renderWhitespace="true" />
                        </HBox> -->
                </layout:VerticalLayout>  

			</FlexBox>
		</uxap:headerContent>

		<uxap:sections>
			<!-- Master 에 관한 정보 -->
            <uxap:ObjectPageSection id="pageSectionMain" titleUppercase="false" title="{I18N>/APPROVAL_INFO}">
				<uxap:subSections>
					<uxap:ObjectPageSubSection id="pageSubSection1" >
					</uxap:ObjectPageSubSection>
				</uxap:subSections>
			</uxap:ObjectPageSection>

            <!-- 첨부파일 시작 -->
			<!-- <uxap:ObjectPageSection titleUppercase="false" title="첨부파일">
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
						<uxap:blocks>
                            
                            <UploadCollection
                                id="UploadCollection"
                                maximumFilenameLength="55"
                                maximumFileSize="10"
                                multiple="true"
                                sameFilenameAllowed="true"
                                instantUpload="false"
                                noDataDescription="Drop files or use the &quot;Add&quot; button to keep files ready for upload"
                                change="onChange"
                                fileDeleted="onFileDeleted"
                                filenameLengthExceed="onFilenameLengthExceed"
                                fileSizeExceed="onFileSizeExceed"
                                typeMissmatch="onTypeMissmatch"
                                uploadComplete="onUploadComplete"
                                beforeUploadStarts="onBeforeUploadStarts" />
               
						</uxap:blocks>
					</uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection> -->
            <!-- 첨부파일 끝 -->

            <uxap:ObjectPageSection titleUppercase="false" title="{I18N>/Attachments}">
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
						<uxap:blocks>
                            <!-- Approval & Reference 시작 -->
                            <HBox>
        
                            </HBox>
                            <!-- Approval & Reference 끝 -->
						</uxap:blocks>
					</uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>

            <!-- <uxap:ObjectPageSection id="pageSectionDetail" titleUppercase="false" title="상세">
				<uxap:subSections>
					<uxap:ObjectPageSubSection id="pageSubSection2" >
					</uxap:ObjectPageSubSection>
				</uxap:subSections>
			</uxap:ObjectPageSection> -->

			<!-- Detail 에 관한 정보 -->
			<uxap:ObjectPageSection titleUppercase="false" title="{I18N>/TARGET_ITEM_LIST}">
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
                        
                        <form:SimpleForm id="midObjectForm" editable="{midObjectViewModel>/isEditMode}">                    
                        <VBox alignContent="Center" alignItems="Stretch" class="sapUiSmallMarginBegin"> 
                            
                            <t:Table id="midTable"
                            selectionMode="MultiToggle"
                            rows="{
                                path: 'details>/LOIRequestDetailView',
                                sorter: { 
                                    path: 'item_sequence',
                                    descending: false 
                                }                   
                            }"
                            cellClick=".onCellClick"
                            rowSelectionChange=".onCheck"
                            visibleRowCountMode="Auto">

                            <t:extension>

                                <OverflowToolbar>
                                    <Title text="Items ({= ${details>/LOIRequestDetailView}.length || 0})" level="H2"/>
									<ToolbarSpacer/>
                                    <Button id="midTableAddButton" text="{I18N>/ROW_ADD}" type="Transparent" press=".onMidTableAddButtonPress" />
									<Button id="midTableDeleteButton" text="{I18N>/ROW_DELETE}" type="Transparent" press=".onMidTableDeleteButtonPress('midTable', 'details', 'LOIRequestDetailView')" />
								</OverflowToolbar>
                            </t:extension>
                            
                            <t:columns>
                                <t:Column id="midStateColumn" hAlign="Center" width="2rem">
                                    <ObjectStatus icon="sap-icon://document" text="State" visible="false" />
                                    <t:template>
                                        <ObjectStatus icon="{
                                            path: 'details>_row_state_',
                                            formatter: '.formatter.toModelStateColumnIcon'
                                        }" 
                                        visible="{=!${midObjectViewModel>/isShowMode}}"/>
                                    </t:template>
                                </t:Column>
                                <t:Column hAlign="Center" width="5rem" >
                                    <Label  id="midLineNoColumn"  text="{I18N>/LINE_NO}" textAlign="Right" width="100%"/>
                                    <t:template>
                                        <Text text="{details>item_sequence}" textAlign="Center" />
                                    </t:template>
                                </t:Column>
                                <t:Column id="midPlantColumn" width="8rem" hAlign="Center">
                                <Label text="{I18N>/PLANT}" textAlign="Center" width="100%"  required="true"/>
                                <t:template>
                                    <HBox>  
                                        <Input value="{details>plant_code}"
                                            visible="{=!${midObjectView>/isShowMode}}"
                                            required="{=!${midObjectView>/isShowMode}}"
                                            showValueHelp="true" valueHelpRequest=".onCmInputWithCodeValuePress($event)">
                                        </Input>
                                        <Text text="{details>plant_code}" visible="{midObjectView>/isShowMode}"/>    
                                    </HBox>    
                                </t:template>
                                </t:Column>
                                <t:Column id="midItemCodeColumn" width="10rem"  hAlign="Left">
                                <Label text="{I18N>/ITEM_CODE}" textAlign="Left" width="100%"/>
                                <t:template>
                                    <HBox>  
                                        <Input value="{details>ep_item_code}" 
                                            visible="{=!${midObjectView>/isShowMode}}"
                                           width="9rem"/> 
                                        <Text   text="{details>ep_item_code}"
                                                visible="{midObjectView>/isShowMode}"/>                                                          

                                    </HBox>
                                </t:template>
                                </t:Column> 


                                <t:Column id="midItemDescColumn" width="20rem"  hAlign="Left">
                                <Label text="{I18N>/ITEM_NAME}" textAlign="Left" width="100%"  required="true"/>
                                <t:template>
                                    <HBox>  
                                        <Input value="{details>item_desc}" 
                                            visible="{=!${midObjectView>/isShowMode}}"
                                            required="{=!${midObjectView>/isShowMode}}"
                                            width="19rem"/>  
                                        <Text   text="{details>item_desc}"
                                                visible="{midObjectView>/isShowMode}"/>                                                          

                                    </HBox> 
                                </t:template>
                                </t:Column>


                                <t:Column id="midSpecDesc" width="4rem" hAlign="Center">
                                <Label text="{I18N>/SPECIFICATION}" textAlign="Center" width="100%"/>
                                <t:template>
                                    <HBox justifyContent="Center">  
                                            <Input value="{details>spec_desc}" 
                                                visible="{=!${midObjectView>/isShowMode}}"
                                                width="100%"/>  
                                            <Text   text="{details>spec_desc}"
                                                    visible="{midObjectView>/isShowMode}"/>                                                          

                                        </HBox> 
                                </t:template>
                                </t:Column>




                                
                                <t:Column id="midUnitColumn" width="8rem" hAlign="Center">
                                <Label text="{I18N>/UNIT}" textAlign="Center" width="100%" required="true"/>
                                <t:template>
                                    <!-- <core:Item key="{uom_code}" text="{uom_code} : {uom_name}" /> -->
                                    <HBox justifyContent="Center">  
                                            <ComboBox
                                                id="comboBox_unit"                                                     
                                                items ="{
                                                    path : '/UnitOfMeasureView',
                                                    filters : [
                                                            {   path : 'tenant_id', 
                                                                operator : 'EQ', 
                                                                value1 : 'L2100'
                                                            },
                                                            {   path : 'language_code', 
                                                                operator : 'EQ', 
                                                                value1 : 'KO'
                                                            }
                                                    ]
                                                }"
                                                selectedKey="{details>unit}"                                       
                                                
                                                visible="{=!${midObjectView>/isShowMode}}"
 
                                            >
                                            <core:Item key="{uom_code}" text="{uom_code}" />
                                            </ComboBox>
                                            <Text   text="{details>unit}"
                                                    visible="{midObjectView>/isShowMode}"/>                                                          

                                        </HBox>  
                                </t:template>
                                </t:Column>


                                <t:Column id="midRequestQuantityColumn" width="4rem" hAlign="Center">
                                <Label text="{I18N>/QUANTITY}" textAlign="Center" width="100%"  required="true"/>
                                <t:template>
                                    <HBox justifyContent="Center"> 
                                        <Input value="{details>request_quantity}" 
                                        visible="{=!${midObjectView>/isShowMode}}"
                                        required="{=!${midObjectView>/isShowMode}}"
                                        liveChange=".onLiveChange"
                                        textAlign="Right" 
                                        width="100%"/> 
                                        <Text  text="{
                                                    parts: [
                                                        {path: 'details>request_quantity'},
                                                        {value: 'ko-KR'}
                                                    ],
                                                    formatter: '.numberFormatter.toNumberString'
                                                }"
                                                visible="{midObjectView>/isShowMode}"
                                                textAlign="Right"/>                                                          

                                    </HBox>  
                                </t:template>
                                </t:Column>


 <!-- selectedKey="{details>currency_code}"   -->
                                <t:Column hAlign="Center" width="11rem" >
                                <Label text="{I18N>/CURRENCY}" />
                                <t:template>
                                    <HBox justifyContent="Center">
                                            <ComboBox id="GenderBox"
                                                    selectedKey = "{details>currency_code}"
                                                    items="{
                                                            path: 'common>/Currency',
                                                            filters: [
                                                                {path: 'tenant_id', operator: 'EQ', value1: 'L2100'}
                                                            ],
                                                            sorter: { path: 'currency_code'}
                                                        }"
                                                    visible="{=!${midObjectView>/isShowMode}}">
                                                <core:Item key="{common>currency_code}" text="{common>currency_code}" />
                                            </ComboBox>   
                                            
                                            <Text text="{details>currency_code}" visible="{midObjectView>/isShowMode}" />    
                                        </HBox>    
                                            
                                
                                <!-- <HBox> 
                                        <ComboBox
                                                id="comboBox_currency_code"                                                     
                                                items ="{
                                                    path : '/CurrencyUnitView',
                                                    filters : [
                                                            {   path : 'tenant_id', 
                                                                operator : 'EQ', 
                                                                value1 : 'L2100'
                                                            },
                                                            {   path : 'language_code', 
                                                                operator : 'EQ', 
                                                                value1 : 'KO'
                                                            }
                                                    ]
                                                }"
                                                selectedKey="{details>currency_code}"                                       
                                                placeholder="{I18N>/OPTION}"
                                                visible="{=!${midObjectView>/isShowMode}}"
                                            >
                                           
                                            <core:Item key= "{currency_code}" text="{currency_code}" />
                                            </ComboBox>
                                        <Text   text="{details>currency_code}"
                                                visible="{midObjectView>/isShowMode}"/>                                                          
                                    </HBox>   -->
                                </t:template>
                                </t:Column>  

                                <t:Column id="midRequestNetPrice" width="8rem" hAlign="Right">
                                <Label text="{I18N>/NET_PRICE}" textAlign="Center" width="100%"/>
                                <t:template>
                                    <HBox justifyContent="End"> 
                                        <Input value="{details>request_net_price}" 
                                            visible="{=!${midObjectView>/isShowMode}}"
                                            liveChange="._onLiveChange"
                                            type="Number"
                                            textAlign="Right" 
                                            width="100%"/> 

                                        <!-- <Input value="{viewModel>material_net_price}" type="Number" textAlign="Right" editable="{= ${viewModel>material_apply_flag} !== 'Y' ? false : true }" visible="{viewSet>/isEditMode}" width="7em" />
                                             -->
                                        <Text  text="{
                                                        parts: [
                                                            {path: 'details>request_net_price'},
                                                            {value: 'ko-KR'}
                                                        ],
                                                        formatter: '.numberFormatter.toNumberString'
                                                    }"
                                                visible="{midObjectView>/isShowMode}" 
                                                textAlign="Right"/>                                                          
                                    </HBox>  
                                </t:template>
                                </t:Column>  


                                <t:Column id="midRequestAmountColumn" width="8rem" hAlign="Right">
                                <Label text="{I18N>/AMOUNT}" textAlign="Center" width="100%"/>
                                <t:template>
                                    <HBox justifyContent="End"> 
                                        <Input value="{details>request_amount}" 
                                            visible="{=!${midObjectView>/isShowMode}}"
                                            editable="false"
                                            textAlign="Right" 
                                            width="100%"/> 
                                        <Text  text="{
                                                    path: 'details>request_amount',
                                                    formatter: '.numberFormatter.toNumberString'
                                                }"
                                                visible="{midObjectView>/isShowMode}"
                                                vAlign="Right"/> 
                                    </HBox>   
                                </t:template>
                                </t:Column>
                                <t:Column id="midDeliveryRequestDate" width="8rem" hAlign="Right">
                                <Label text="{I18N>/DELIVERY_DUE_DATE}" textAlign="Center" width="100%"/>
                                <t:template>
                                    <HBox justifyContent="Center">   
                                         <DatePicker value="{ path: 'details>delivery_request_date', type: 'sap.ui.model.odata.type.DateTime', formatOptions: { UTC: true, format: 'yMd' } }" 
                                         visible="{=!${midObjectView>/isShowMode}}"
                                         />
                                        <Text text="{
                                            path: 'details>delivery_request_date',
                                            type: 'sap.ui.model.type.Date',
                                            formatOptions: {
                                                pattern: 'yyyy/MM/dd'
                                            }                                        
                                        }"  
                                        class="sapUiTinyMarginBegin"  
                                        visible="{midObjectView>/isShowMode}"/> 
                                    </HBox> 
                                </t:template>
                                </t:Column>  



                                <t:Column id="midSupplierCodeColumn" width="25rem" hAlign="Right">
                                <Label text="{I18N>/PERFORM_SUPPLIER}" textAlign="Center" width="100%"/>
                                <t:template>
                                    <HBox justifyContent="Left">   
                                        <MultiInput value="{details>supplier_name}" 
                                            id="multiinput_supplierwithorg_code" placeholder="{I18N>/SUPPLIER}"
                                            showValueHelp="true" valueHelpRequest=".onMultiInputSupplierWithOrgValuePress"
                                            visible="{=!${midObjectView>/isShowMode}}" width="24rem">
                                        </MultiInput>
                                        <Text text="{details>supplier_code}" visible="false" />  
                                        <Text text="{details>supplier_name}" visible="{midObjectView>/isShowMode}"/>                                                          
                                    </HBox>  
                                </t:template>
                                </t:Column>  
                                <t:Column id="midBuyerEmpnoColumn" width="10rem" hAlign="Left">
                                <Label text="{I18N>/BUYER}" textAlign="Center" width="100%"  required="true"/>
                                <t:template>
                                    <HBox justifyContent="Center"> 
                                        <Input value="{details>buyer_name}"
                                            visible="{=!${midObjectView>/isShowMode}}"
                                            required="{=!${midObjectView>/isShowMode}}"
                                            
                                            showValueHelp="true" valueHelpRequest=".onInputWithEmployeeValuePress($event)">
                                        </Input>
                                        <Text   text="{details>buyer_name}"
                                                visible="{midObjectView>/isShowMode}"/>                                                          
                                    </HBox>           
                                </t:template>
                                </t:Column> 
                                <t:Column id="midRemarkColumn" width="10rem" hAlign="Left">
                                <Label text="{I18N>/REMARK}" textAlign="Center" width="100%"/>
                                <t:template>
                                    <HBox> 
                                        <Input id = "remark_" value="{details>remark}" 
                                            visible="{=!${midObjectView>/isShowMode}}"
                                            width="100%"/> 
                                        <Text   text="{details>remark}"
                                                visible="{midObjectView>/isShowMode}"
                                                textAlign="Right" />                                                          

                                    </HBox>      
                                </t:template>
                                </t:Column> 
                            </t:columns>
                            </t:Table>

                                            
                        </VBox>
                        </form:SimpleForm>     

					</uxap:ObjectPageSubSection>
				</uxap:subSections>
			</uxap:ObjectPageSection>

            <!-- 결재라인 시작 -->
			<uxap:ObjectPageSection titleUppercase="false" title="{I18N>/APPROVAL_LINE}">
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
						<uxap:blocks>
                            <!-- Approval & Reference 시작 -->
                            <HBox>
        
                            </HBox>
                            <!-- Approval & Reference 끝 -->
						</uxap:blocks>
					</uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>
            <!-- 결재라인 끝 -->
		</uxap:sections>

		<!-- 하단 버튼 처리 툴바 -->
		<uxap:footer>
			<OverflowToolbar>
        <Button
            icon="sap-icon://alert"
            type="Emphasized"
            text="{= ${message>/}.length }"
            visible="{= ${message>/}.length > 0 }"
            ariaHasPopup="Dialog"
            press=".onMessagePopoverPress" />
				<ToolbarSpacer />
                <Button id="pageEditButton" text="{I18N>/EDIT}" type="Transparent" press=".onPageEditButtonPress" />
                <Button id="pageSaveButton" text="{I18N>/TEMP_SAVE}" type="Emphasized" press=".onPageSaveButtonPress('S')" />
                <Button id="pageCancelButton" text="{I18N>/CANCEL}" type="Transparent" press=".onPageCancelEditButtonPress"/>
                <Button id="pageDeleteButton" text="{I18N>/DELETE}" type="Transparent" press=".onPageDeleteButtonPress" visible="{= ${editMode>/newcheck} === 'new' ? false : true}"/>
                <Button id="pageRequestButton" text="{I18N>/REQUEST}" type="Emphasized" press=".onPageSaveButtonPress('R')" />
                <Button id="pageByPassButton" text="{I18N>/BYPASS}" type="Emphasized" press=".onPageSaveButtonPress('B')" />
				
			</OverflowToolbar>
		</uxap:footer>
	</uxap:ObjectPageLayout>


    <cm-ui:EmployeeDialog id="employeeDialog" 
                            title="직원 검색"
                            items="{
                                filters: [
                                    {path: 'tenant_id', operator: 'EQ', value1: 'L2100'}
                                ]
                            }"
                            apply=".onEmployeeDialogApplyPress"
                        />

    <cm-ui:PlantDialog id="plantDialog" 
                            title="플랜트 검색"
                            items="{
                                filters: [
                                    {path: 'tenant_id', operator: 'EQ', value1: 'L2100'}
                                ]
                            }"
                            apply=".onPlantDialogApplyPress"
                        />

    <sp-ui:SupplierWithOrgDialog id="supplierWithOrgDialog" 
                            title="공급업체 검색"
                            items="{
                                filters: [
                                    {path: 'tenant_id', operator: 'EQ', value1: 'L2100'}
                                ]
                            }"
                            apply=".onSupplierDialogApplyPress"
                        />

</mvc:View>