<mvc:View controllerName="ep.ne.ucQuotationMgt.controller.UcQuotation" 
	xmlns:mvc="sap.ui.core.mvc" 
	xmlns="sap.m" 
	xmlns:uxap="sap.uxap" 
	xmlns:layout="sap.ui.layout" 
    xmlns:form="sap.ui.layout.form"
    xmlns:t="sap.ui.table"
    xmlns:sc="sap.suite.ui.commons"
    xmlns:core="sap.ui.core"
    xmlns:lib-m="ext.lib.control.m"
    xmlns:richtexteditor="sap.ui.richtexteditor"
	height="100%">

	<uxap:ObjectPageLayout id="page"
		toggleHeaderOnTitleClick="true"
		alwaysShowContentHeader = "true"
		preserveHeaderStateOnScroll="false"
		headerContentPinnable="true"
		isChildPage="true"
		upperCaseAnchorBar="false"
		showTitleInHeaderContent="true"
		showEditHeaderButton="true" 
		showFooter="false">
     
		<uxap:headerTitle>
			<uxap:ObjectPageDynamicHeaderTitle>
                <uxap:heading>
                    <HBox alignItems="End">
                        <OverflowToolbarButton type="Transparent" icon="sap-icon://nav-back" press=".onPageNavBackButtonPress"  tooltip="Close column" visible="{= ${/actionButtonsInfo/midColumn/closeColumn} !== null }"/>
                        <Title text="공사단가계약 견적 상세" wrapping="true" class="" />
                    </HBox>
                </uxap:heading>            
                <uxap:navigationActions>
					<!-- <OverflowToolbarButton id="pageNavBackButton" type="Transparent" icon="sap-icon://decline" text="back" tooltip="back to the list" press=".onPageNavBackButtonPress" visible="{= ${/actionButtonsInfo/midColumn/closeColumn} !== null }"/> -->
                </uxap:navigationActions>
			</uxap:ObjectPageDynamicHeaderTitle>
		</uxap:headerTitle>

		<uxap:headerContent>
			<FlexBox wrap="Wrap" visible="true">
				<layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                    <ObjectStatus
                        title="{I18N>/CONST_QUOTATION_NUMBER} "
                        text="{midObjectViewModel>/viewConstQuotationNumber}"/>
                    <ObjectStatus
                        id="createUser"         
                        title="{I18N>/SUPPLIER_NAME} " 
                        text="{viewModel>/ucmaster/supplier_name} {viewModel>/ucmaster/supplier_person_id}"/>
				</layout:VerticalLayout>

                <layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                    <ObjectStatus 
                        id="createDate"
                        title="{I18N>/WRITE_DATE} "
                        text="{
                                path: 'viewModel>/ucmaster/quotation_write_date',
                                formatter: '.dateFormatter.toUTCDateString'
                            }" />

                    <ObjectStatus
                        id="createDepartment"
                        title="{I18N>/OPERATION_UNIT} "
                        text="{viewModel>/ucmaster/org_name}"/>
                    </layout:VerticalLayout>

                    <layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                        <Label text="{I18N>/PROGRESS_STATUS} :"/>
                    <ObjectStatus
                        class="sapMObjectStatusLarge"
                        text="{viewModel>/ucmaster/quotation_status_name}"
                        state="Error" />
                </layout:VerticalLayout>
			</FlexBox>
		</uxap:headerContent>

		<uxap:sections>
            <uxap:ObjectPageSection id="pageSectionMain" titleUppercase="false" title="{I18N>/BASIC_INFO}">
                <uxap:subSections>
                    <uxap:ObjectPageSubSection>
                        <form:SimpleForm id="pageSearchForm" maxContainerCols="2" editable="true" layout="ResponsiveGridLayout" adjustLabelSpan="false" labelSpanL="4" labelSpanM="4" emptySpanL="0" emptySpanM="0" columnsL="2" columnsM="2">
                            <form:content>
                                <!-- 기본정보 영역 -->
                                <core:Title text="{I18N>/BASIC_INFO}" />    

                                <VBox alignContent="Center"> 
                                    <Label text="{I18N>/CONST_NAME}" design="Bold" class="sapMLabelNoText"/>
                                    <Text text="{viewModel>/ucmaster/const_name}" width="70%"/>
                                    <layoutData>
                                        <layout:GridData span="XL12 L12 M12 S12" />
                                    </layoutData> 
                                </VBox>

                                <VBox alignContent="Center">
                                    <Label text="{I18N>/LARGE_CLASS}" textAlign="left" design="Bold" class="sapMLabelNoText" />
                                    <Text text="{viewModel>/ucmaster/ep_item_name}" />
                                    <layoutData>
                                        <layout:GridData span="XL4 L4 M4 S12" />
                                    </layoutData>    
                                </VBox>      

                                <VBox alignContent="Center">
                                    <Label text="{I18N>/CONST_PERIOD}" design="Bold" class="sapUiTinyMarginEnd"/>
                                    <HBox>
                                        <Text text="{
                                                                path: 'viewModel>/ucmaster/const_start_date',
                                                                type: 'sap.ui.model.type.Date',
                                                                formatOptions: {
                                                                    pattern: 'yyyy/MM/dd'
                                                                }                                        
                                                            }"  
                                                            class="sapUiTinyMarginBegin"/> 

                                        <Text text="~" class="sapUiTinyMarginBegin sapUiTinyMarginEnd" />
                                        <Text text="{
                                                                    path: 'viewModel>/ucmaster/const_end_date',
                                                                    type: 'sap.ui.model.type.Date',
                                                                    formatOptions: {
                                                                        pattern: 'yyyy/MM/dd'
                                                                    }                                        
                                                                }"  
                                                                class="sapUiTinyMarginBegin"/> 
                                    </HBox>
                                    <layoutData>
                                        <layout:GridData span="XL4 L4 M4 S12" />
                                    </layoutData>     
                                </VBox> 
                                <VBox alignContent="Center">
                                    <Label text="{I18N>/CONST_QUOTATION_CURRENCY}" design="Bold" class="sapMLabelNoText"/>
                                    <Text text="{viewModel>/ucmaster/const_person_name}" />  
                                    <layoutData>
                                        <layout:GridData span="XL4 L4 M4 S12" />
                                    </layoutData>     
                                </VBox>

                                <VBox alignContent="Center">
                                    <Label text="{I18N>/CONST_REVIEW_PERSON}" design="Bold" class="sapMLabelNoText"/>
                                    <Text text="{viewModel>/ucmaster/const_person_name}" />  
                                    <layoutData>
                                        <layout:GridData span="XL4 L4 M4 S12" />
                                    </layoutData>     
                                </VBox>
                                
                                <VBox alignContent="Center">
                                    <Label text="{I18N>/BUYER}" design="Bold" class="sapMLabelNoText"/>
                                    <Text text="{viewModel>/ucmaster/buyer_name}" />  
                                    <layoutData>
                                        <layout:GridData span="XL8 L8 M8 S12" />
                                    </layoutData>     
                                </VBox>

                                <!-- 구매정보 영역 -->
                                <!-- <core:Title text="구매정보" />     -->

                                <VBox alignContent="Center">
                                    <Label text="{I18N>/PR_NUMBER}" design="Bold" class="sapMLabelNoText"/>
                                    <Text text="{viewModel>/ucmaster/pr_number}" />  
                                    <layoutData>
                                        <layout:GridData span="XL4 L4 M4 S12" />
                                    </layoutData>     
                                </VBox>
                                
                                <VBox alignContent="Center">
                                    <Label text="{I18N>/DELIVERY_REQUEST_DATE}" design="Bold" class="sapMLabelNoText"/>
                                    <Text text="{viewModel>/ucmaster/delivery_request_date}" />  
                                    <layoutData>
                                        <layout:GridData span="XL8 L8 M8 S12" />
                                    </layoutData>     
                                </VBox>


                            </form:content>
                        </form:SimpleForm>
                        </uxap:ObjectPageSubSection>
                    </uxap:subSections>
                </uxap:ObjectPageSection>

                <!-- 첨부파일 시작 -->
                <!-- <uxap:ObjectPageSection titleUppercase="false" title="첨부파일">
                    <uxap:subSections>
                        <uxap:ObjectPageSubSection>
                            <uxap:blocks>

                                <UploadCollection
                                    id="UploadCollection"
                                    maximumFilenameLength="55"
                                    maximumFileSize="10"
                                    multiple="true"
                                    sameFilenameAllowed="true"
                                    instantUpload="false"
                                    noDataDescription="Drop files or use the &quot;Add&quot; button to keep files ready for upload"
                                    change="onChange"
                                    fileDeleted="onFileDeleted"
                                    filenameLengthExceed="onFilenameLengthExceed"
                                    fileSizeExceed="onFileSizeExceed"
                                    typeMissmatch="onTypeMissmatch"
                                    uploadComplete="onUploadComplete"
                                    beforeUploadStarts="onBeforeUploadStarts" />

                            </uxap:blocks>
                        </uxap:ObjectPageSubSection>
                    </uxap:subSections>
                </uxap:ObjectPageSection> -->
                <!-- 첨부파일 끝 -->

                <uxap:ObjectPageSection titleUppercase="false" title="{I18N>/Attachments}">
                    <uxap:subSections>
                        <uxap:ObjectPageSubSection>
                            <uxap:blocks>
                                <!-- Approval & Reference 시작 -->
                                <HBox>
            
                                </HBox>
                                <!-- Approval & Reference 끝 -->
                            </uxap:blocks>
                        </uxap:ObjectPageSubSection>
                    </uxap:subSections>
                </uxap:ObjectPageSection>
                    
                <uxap:ObjectPageSection id="pageSectionMain2" titleUppercase="false" title="{I18N>/ITEM_INFO}">
				    <uxap:subSections>
                        <uxap:ObjectPageSubSection id="pageSubSection2">
                            <form:SimpleForm id="midObjectForm" editable="false">                    
                                <VBox alignContent="Center" alignItems="Stretch" class="sapUiSmallMarginBegin"> 
                                    <t:Table id="mainTable"
                                    selectionMode="None"
                                    rows="{
                                        path: 'viewModel>/ucdetails/',
                                        sorter: { 
                                            path: 'item_sequence',
                                            descending: false 
                                        }                   
                                    }"
                                    cellClick=".onCellClick"
                                    rowSelectionChange=".onCheck"
                                    visibleRowCountMode="Auto"
                                    columnResize="onColumnResize">

                                    <t:columns>
                                        <!-- <t:Column id="dtlColumnState" hAlign="Center" width="2em" >
                                            <ObjectStatus icon="sap-icon://document" text="State" visible="false" />
                                            <t:template>
                                                <ObjectStatus icon="{
                                                    path: 'viewModel>row_state',
                                                    formatter: '.formatter.toModelStateColumnIcon'
                                                }" />
                                            </t:template>
                                        </t:Column> -->
                                        <t:Column id="mainItemSequence" width="6rem" hAlign="Center">
                                        <Label text="{I18N>/LINE_NO}" textAlign="Center" width="100%"/>
                                        <t:template>
                                            <Text text="{viewModel>item_sequence}"/>
                                        </t:template>
                                        </t:Column>
                                        <t:Column id="mainEpItemCode" width="8rem" hAlign="Center">
                                        <Label text="{I18N>/ITEM_CODE}" textAlign="Center" width="100%"/>
                                        <t:template>
                                            <Text text="{viewModel>ep_item_code}"/>
                                        </t:template>
                                        </t:Column>
                                        <t:Column id="mainItemDesc" width="20rem"  hAlign="Left">
                                        <Label text="{I18N>/ITEM_NAME}" textAlign="Left" width="100%"/>
                                        <t:template>
                                            <Text text="{viewModel>item_desc}" />
                                        </t:template>
                                        </t:Column> 
                                        <t:Column id="mainSpecDesc" width="20rem"  hAlign="Left">
                                        <Label text="{I18N>/SPECIFICATION}" textAlign="Left" width="100%"/>
                                        <t:template>
                                            <Text text="{viewModel>spec_desc}"/>
                                        </t:template>
                                        </t:Column>
                                        <t:Column id="mainUnit" width="4rem" hAlign="Center">
                                        <Label text="{I18N>/UNIT}" textAlign="Center" width="100%"/>
                                        <t:template>
                                            <Text text="{viewModel>unit}"/>
                                        </t:template>
                                        </t:Column>
                                        
                                        <t:Column id="mainQuotationQuantity" width="4rem" hAlign="Center">
                                        <Label text="{I18N>/QUANTITY}" textAlign="Center" width="100%"/>
                                        <t:template>
                                            <Text  text="{
                                                            path: 'viewModel>quotation_quantity',
                                                            formatter: '.numberFormatter.toNumberString'
                                                        }"
                                                        vAlign="Right"
                                                        visible="{midObjectViewModel>/isShowMode}"/>
                                        </t:template>
                                        </t:Column>
                                        <t:Column id="mainExtraRate" width="4rem" hAlign="Center">
                                        <Label text="{I18N>/EXTRA_RATE}" textAlign="Center" width="100%"/>
                                        <t:template>
                                            <Link text="{viewModel>extra_rate}" press=".onTableExtraRatePress($event)" enabled="{= ${viewModel>extra_rate_count} > 0 ? true : false }" />                
                                        </t:template>
                                        </t:Column>
                                        <t:Column id="mainCurrencyName" width="4rem" hAlign="Center">
                                        <Label text="{I18N>/CURRENCY}" textAlign="Center" width="100%"/>
                                        <t:template>
                                            <Text text="{viewModel>currency_name}"/>
                                        </t:template>
                                        </t:Column>
                                        <t:Column id="mainMaterialNetPrice" width="8rem" hAlign="Right">
                                        <Label text="{I18N>/MATERIAL_NET_PRICE}" textAlign="Center" width="100%"/>
                                        <t:template>
                                            <Text  text="{
                                                            path: 'viewModel>material_net_price',
                                                            formatter: '.numberFormatter.toNumberString'
                                                        }"
                                                        vAlign="Right"
                                                        visible="{midObjectViewModel>/isShowMode}"/>
                                        </t:template>
                                        </t:Column>  
                                        <t:Column id="mainMaterialAmount" width="8rem" hAlign="Right">
                                        <Label text="{I18N>/MATERIAL_NET_AMOUNT}" textAlign="Center" width="100%"/>
                                        <t:template>
                                            <Text  text="{
                                                            path: 'viewModel>material_amount',
                                                            formatter: '.numberFormatter.toNumberString'
                                                        }"
                                                        vAlign="Right"/> 
                                        </t:template>
                                        </t:Column>  
                                        <t:Column id="mainLaborNetPrice" width="8rem" hAlign="Right">
                                        <Label text="{I18N>/LABOR_NET_PRICE}" textAlign="Center" width="100%"/>
                                        <t:template>
                                            <Text  text="{
                                                            path: 'viewModel>labor_net_price',
                                                            formatter: '.numberFormatter.toNumberString'
                                                        }"
                                                        vAlign="Right"
                                                        visible="{midObjectViewModel>/isShowMode}"/> 
                                        </t:template>
                                        </t:Column>
                                        <t:Column id="mainLaborAmount" width="8rem" hAlign="Right">
                                        <Label text="{I18N>/LABOR_NET_AMOUNT}" textAlign="Center" width="100%"/>
                                        <t:template>
                                            <Text  text="{
                                                            path: 'viewModel>labor_amount',
                                                            formatter: '.numberFormatter.toNumberString'
                                                        }"
                                                        vAlign="Right"/> 
                                            
                                        </t:template>
                                        </t:Column>  
                                        <t:Column id="mainSumAmount" width="8rem" hAlign="Right">
                                        <Label text="{I18N>/SUM}" textAlign="Center" width="100%"/>
                                        <t:template>
                                            <Text  text="{
                                                            path: 'viewModel>sum_amount',
                                                            formatter: '.numberFormatter.toNumberString'
                                                        }"
                                                        vAlign="Right"/> 
                                        </t:template>
                                        </t:Column>  
                                        <t:Column id="mainRemark" width="10rem" hAlign="Left">
                                        <Label text="{I18N>/REMARK}" textAlign="Center" width="100%"/>
                                        <t:template>
                                            <Text text="{viewModel>remark}"/>          
                                        </t:template>
                                        </t:Column> 
                                        
                                        <t:Column id="mainLoiPublishStatusCode" width="10rem" hAlign="Center">
                                        <Label text="{I18N>/NET_PRICE_CONTRACT_DOCUMENT_NO}" textAlign="Center" width="100%"/>
                                        <t:template>
                                            <Text text="{viewModel>net_price_contract_document_no}"/>
                                        </t:template>
                                        </t:Column> 

                                        <t:Column id="mainNetPriceContractTitle" width="20rem" hAlign="Left">
                                        <Label text="{I18N>/CONTRACT_NAME}" textAlign="Center" width="100%"/>
                                        <t:template>
                                            <Text text="{viewModel>net_price_contract_title}"/>
                                        </t:template>
                                        </t:Column> 

                                        <!-- <t:Column id="mainNetPriceContractPeriod" width="15rem" hAlign="Center">
                                        <Label text="계약기간" textAlign="Center" width="100%"/>
                                        <t:template>
                                            <Text text="{viewModel>net_price_contract_period}"/>
                                        </t:template>
                                        </t:Column> -->
                                    </t:columns>
                                    </t:Table>          
                                </VBox>
                            </form:SimpleForm>                    
                        </uxap:ObjectPageSubSection>
                    </uxap:subSections>
                </uxap:ObjectPageSection>


                <!-- 원가내역 시작 -->
                <!-- <uxap:ObjectPageSection titleUppercase="false" title="원가내역">
                    <uxap:subSections>
                        <uxap:ObjectPageSubSection>
                            <uxap:blocks>

                                <HBox>
            
                                </HBox>

                            </uxap:blocks>
                        </uxap:ObjectPageSubSection>
                    </uxap:subSections>
                </uxap:ObjectPageSection> -->
                <!-- 원가내역 끝 -->

            <!-- 준공정보 시작 -->
			<uxap:ObjectPageSection titleUppercase="false" title="{I18N>/COMPLETION_INFO}">
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
						<uxap:blocks>
                            <VBox id="midCompletionForm">
    
                                    <form:SimpleForm id="completionForm1Show" editable="false"> 
                                        <VBox alignContent="Center" alignItems="Stretch"> 
                                            <Label  text="{I18N>/COMPLETION_DATE}" 
                                                        design="Bold" 
                                                        class="sapUiSmallMarginBottom"/>
                                            <HBox>
                                                
                                                <!-- <DatePicker placeholder="Date" id="completionDatePicker" value="{path: 'viewModel>/ucmaster/completion_date',type: 'sap.ui.model.odata.type.DateTime', formatOptions: { UTC: true, format: 'yMd' }}" valueFormat="yyyy-MM-dd" displayFormat="yyyy-MM-dd"
                                                    visible="{=!${midObjectViewModel>/isShowMode}}"
                                                    /> -->
                                                <DatePicker id="completionDate" placeholder="Date" visible="{=!${midObjectViewModel>/isShowMode}}"/>

                                                <Text text="{
                                                    path: 'viewModel>/ucmaster/completion_date',
                                                    type: 'sap.ui.model.type.Date',
                                                    formatOptions: {
                                                        pattern: 'yyyy/MM/dd'
                                                    }                                        
                                                }"  
                                                class="sapUiTinyMarginBegin" visible="{midObjectViewModel>/isShowMode}"/>          
                                            </HBox> 
                                        </VBox>
                                        <VBox alignContent="Center" alignItems="Stretch"> 
                                            <Label  text="{I18N>/FACILITY_PERSON}" 
                                                        design="Bold" 
                                                        class="sapUiSmallMarginBottom"/>
                                            <HBox>

                                            <lib-m:CodePicker id="searchRequestorS"
                                                placeholder="Employee name"
                                                keyField="employee_number"
                                                textField="user_local_name"
                                                suggestionItems="{
                                                    path: 'viewModel>/ucmaster/facility_person_name',
                                                    filters: [
                                                        {path: 'tenant_id', operator: 'EQ', value1: 'L2100'}
                                                    ],
                                                    serviceUrl: 'srv-api/odata/v2/cm.util.HrService/',
                                                    entityName: 'Employee'
                                                }"
                                                visible="{=!${midObjectViewModel>/isShowMode}}"
                                                >
                                                <lib-m:CodePickerValueHelp contentWidth="500px" title="Choose a Employee"
                                                    keyFieldHeaderText="Employee ID" textFieldHeaderText="Employee" 
                                                    />
                                            </lib-m:CodePicker>    
                                            <Text text="{viewModel>/ucmaster/facility_person_name}" 
                                                visible="{midObjectViewModel>/isShowMode}"/> 
                                            </HBox>          
                                        </VBox>
                                    </form:SimpleForm>   

                                    <form:SimpleForm id="completionForm2Show" editable="false"  visible="false"> 
                                        <UploadCollection
                                            id="UploadCollection2"
                                            maximumFilenameLength="55"
                                            maximumFileSize="10"
                                            multiple="true"
                                            sameFilenameAllowed="true"
                                            instantUpload="false"
                                            noDataDescription="Drop files or use the &quot;Add&quot; button to keep files ready for upload"
                                            change="onChange"
                                            fileDeleted="onFileDeleted"
                                            filenameLengthExceed="onFilenameLengthExceed"
                                            fileSizeExceed="onFileSizeExceed"
                                            typeMissmatch="onTypeMissmatch"
                                            uploadComplete="onUploadComplete"
                                            beforeUploadStarts="onBeforeUploadStarts" 
                                           />
                                    </form:SimpleForm>   

                                </VBox>      
                            </uxap:blocks>
                        </uxap:ObjectPageSubSection>
                    </uxap:subSections>
                </uxap:ObjectPageSection>
                <!-- 준공정보 끝 -->

                <!-- 결재라인 시작 -->
                <!-- <uxap:ObjectPageSection titleUppercase="false" title="결재라인">
                    <uxap:subSections>
                        <uxap:ObjectPageSubSection>
                            <uxap:blocks>
                                <HBox>
            
                                </HBox>
                            </uxap:blocks>
                        </uxap:ObjectPageSubSection>
                    </uxap:subSections>
                </uxap:ObjectPageSection> -->
                <!-- 결재라인 끝 -->
		</uxap:sections>
		
		<uxap:footer>
			<OverflowToolbar>
                <Button
                    icon="sap-icon://alert"
                    type="Emphasized"
                    text="{= ${message>/}.length }"
                    visible="{= ${message>/}.length > 0 }"
                    ariaHasPopup="Dialog"
                    press=".onMessagePopoverPress" />
				<ToolbarSpacer />
                <!-- <Button id="pageEditButton" type="Transparent" text="물량수정요청" press=".onPageEditButtonPress" /> -->
                <Button id="pageSaveButton" type="Transparent" text="{I18N>/BM_UPDATE_REQUEST}" press=".onPageSaveButtonPress('D')" />
                <!-- <Button id="pageCancelButton" type="Transparent" text="Cancel" press=".onPageCancelEditButtonPress"/> -->
                <!-- <Button id="pageDeleteButton" type="Transparent" text="Delete" press=".onPageDeleteButtonPress" visible="{= ${editMode>/newcheck} === 'new' ? false : true}"/>                 -->
                <Button id="pageRequestButton" type="Emphasized" text="{I18N>/BM_CONFIRMED}" press=".onPageSaveButtonPress('R')" />
			</OverflowToolbar>
		</uxap:footer>
	</uxap:ObjectPageLayout>
</mvc:View>