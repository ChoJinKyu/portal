<mvc:View controllerName="ep.ne.ucQuotationMgtSup.controller.UcQuotationSup" 
	xmlns:mvc="sap.ui.core.mvc" 
	xmlns="sap.m" 
	xmlns:uxap="sap.uxap" 
	xmlns:layout="sap.ui.layout" 
    xmlns:form="sap.ui.layout.form"
    xmlns:t="sap.ui.table"
    xmlns:sc="sap.suite.ui.commons"
    xmlns:core="sap.ui.core"
    xmlns:lib-m="ext.lib.control.m"
    xmlns:richtexteditor="sap.ui.richtexteditor"
	height="100%">

	<uxap:ObjectPageLayout id="page"
		toggleHeaderOnTitleClick="true"
		alwaysShowContentHeader = "true"
		preserveHeaderStateOnScroll="false"
		headerContentPinnable="true"
		isChildPage="true"
		upperCaseAnchorBar="false"
		showTitleInHeaderContent="true"
		showEditHeaderButton="true" 
		showFooter="false">
     
		<uxap:headerTitle>
			<uxap:ObjectPageDynamicHeaderTitle>
                <uxap:heading>
                    <HBox alignItems="End">
                        <OverflowToolbarButton type="Transparent" icon="sap-icon://nav-back" press=".onPageNavBackButtonPress"  tooltip="Close column" visible="{= ${/actionButtonsInfo/midColumn/closeColumn} !== null }"/>
                        <Title text="[협력사]공사물량상세" wrapping="true" class="" />
                    </HBox>
                </uxap:heading>            
				<!-- <uxap:expandedHeading>
					<Title text="LOI 업체선정 품의" wrapping="true" />
				</uxap:expandedHeading>
				<uxap:snappedHeading>
					<Title text="LOI 업체선정 품의" wrapping="true" />
				</uxap:snappedHeading> -->
                <uxap:navigationActions>
					<!-- <OverflowToolbarButton id="pageNavBackButton" type="Transparent" icon="sap-icon://decline" text="back" tooltip="back to the list" press=".onPageNavBackButtonPress" visible="{= ${/actionButtonsInfo/midColumn/closeColumn} !== null }"/> -->
                </uxap:navigationActions>
			</uxap:ObjectPageDynamicHeaderTitle>
		</uxap:headerTitle>

		<uxap:headerContent>
			<FlexBox wrap="Wrap" visible="true">
				<layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                    <ObjectStatus
                        title="견적서번호 "
                        text="{midObjectViewModel>/viewConstQuotationNumber}"/>
                    <ObjectStatus
                        id="createUser"         
                        title="작성자 "
                        text="{viewModel>/ucmaster/buyer_name}"/>
				</layout:VerticalLayout>

                <layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                    <ObjectStatus 
                        id="createDate"
                        title="작성일자 "
                        text="{
                                path: 'viewModel>/ucmaster/quotation_write_date',
                                formatter: '.dateFormatter.toDateString'
                            }" />

                    <ObjectStatus
                        id="createDepartment"
                        title="단가운영단위(플랜트) "
                        text="{viewModel>/ucmaster/org_name}"/>
                    </layout:VerticalLayout>

                    <layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                        <Label text="Status :"/>
                    <ObjectStatus
                        class="sapMObjectStatusLarge"
                        text="{viewModel>/ucmaster/quotation_status_name}"
                        state="Error" />
                </layout:VerticalLayout>

                <!-- <layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                    <Label text="Process : "/>
                    <HBox>
                        <sc:MicroProcessFlow>
                            <sc:content>
                                <sc:MicroProcessFlowItem state="None" stepWidth="3rem" />
                                <sc:MicroProcessFlowItem state="Error" stepWidth="3rem" icon="sap-icon://circle-task" />
                                <sc:MicroProcessFlowItem state="None" stepWidth="3rem" />
                                <sc:MicroProcessFlowItem state="None" stepWidth="3rem" />
                            </sc:content>
                        </sc:MicroProcessFlow>
                    </HBox>
                    <HBox>
                        <Text text="LOI요청"  width="4em" renderWhitespace="true" />
                        <Text text=" LOI업체&#10; 선정"  width="4em" renderWhitespace="true" />
                        <Text text="LOI발행" width="6em" textAlign="Center" />
                        <Text text=" LOI발행&#10; 통보" renderWhitespace="true" />
                    </HBox>
                </layout:VerticalLayout>   -->

			</FlexBox>
		</uxap:headerContent>

		<uxap:sections>
			
					
                    <uxap:ObjectPageSection id="pageSectionMain" titleUppercase="false" title="기본정보">
                        <uxap:subSections>
                            <uxap:ObjectPageSubSection id="pageUcSubSection1">
                            </uxap:ObjectPageSubSection>
                        </uxap:subSections>
                    </uxap:ObjectPageSection>

                    <!-- 첨부파일 시작 -->
                    <uxap:ObjectPageSection titleUppercase="false" title="첨부파일">
                        <uxap:subSections>
                            <uxap:ObjectPageSubSection>
                                <uxap:blocks>
                                    <!-- File Upload 시작-->
                                    <UploadCollection
                                        id="UploadCollection"
                                        maximumFilenameLength="55"
                                        maximumFileSize="10"
                                        multiple="true"
                                        sameFilenameAllowed="true"
                                        instantUpload="false"
                                        noDataDescription="Drop files or use the &quot;Add&quot; button to keep files ready for upload"
                                        change="onChange"
                                        fileDeleted="onFileDeleted"
                                        filenameLengthExceed="onFilenameLengthExceed"
                                        fileSizeExceed="onFileSizeExceed"
                                        typeMissmatch="onTypeMissmatch"
                                        uploadComplete="onUploadComplete"
                                        beforeUploadStarts="onBeforeUploadStarts" />
                                    <!-- File Upload 끝-->
                                </uxap:blocks>
                            </uxap:ObjectPageSubSection>
                        </uxap:subSections>
                    </uxap:ObjectPageSection>
                    <!-- 첨부파일 끝 -->
                    
                    <uxap:ObjectPageSection id="pageSectionMain2" titleUppercase="false" title="품목정보">
				        <uxap:subSections>
                    <uxap:ObjectPageSubSection id="pageSubSection2">
                    <form:SimpleForm id="midObjectForm" editable="{midObjectViewModel>/isEditMode}">                    
                        <VBox alignContent="Center" alignItems="Stretch" class="sapUiSmallMarginBegin"> 
                            
                            <t:Table id="mainTable"
                            selectionMode="MultiToggle"
                            rows="{
                                path: 'viewModel>/ucdetails/',
                                sorter: { 
                                    path: 'item_sequence',
                                    descending: false 
                                }                   
                            }"
                            cellClick=".onCellClick"
                            rowSelectionChange=".onCheck"
                            visibleRowCountMode="Auto"
                            columnResize="onColumnResize">
                            <t:extension>
                                <OverflowToolbar class="sapFDynamicPageAlignContent">
                                
                                <ToolbarSpacer/>
                                <Button id="midTableAddButton" text="Add" type="Transparent" press=".onMidTableAddButtonPress()" />
                                <!-- <Button text="exam"  press=".onVosButtonPress" /> -->
								<Button id="midTableDeleteButton" text="Delete" type="Transparent" press=".onItemInfoDeleteButtonPress" />
                                </OverflowToolbar>
                            </t:extension>
                            
                            <t:columns>
                                <t:Column id="dtlColumnState" hAlign="Center" width="2em" >
                                    <ObjectStatus icon="sap-icon://document" text="State" visible="false" />
                                    <t:template>
                                        <ObjectStatus icon="{
                                            path: 'viewModel>row_state',
                                            formatter: '.formatter.toModelStateColumnIcon'
                                        }" />
                                    </t:template>
                                </t:Column>
                                <t:Column id="mainItemSequence" width="6rem" hAlign="Center">
                                <Label text="품목순번" textAlign="Center" width="100%"/>
                                <t:template>
                                    <Text text="{viewModel>item_sequence}"/>
                                </t:template>
                                </t:Column>
                                <t:Column id="mainEpItemCode" width="8rem" hAlign="Center">
                                <Label text="품목코드" textAlign="Center" width="100%"/>
                                <t:template>
                                    <Text text="{viewModel>ep_item_code}"/>
                                </t:template>
                                </t:Column>
                                <t:Column id="mainItemDesc" width="20rem"  hAlign="Left">
                                <Label text="품목명" textAlign="Left" width="100%"/>
                                <t:template>
                                    <Text text="{viewModel>item_desc}" />
                                </t:template>
                                </t:Column> 
                                <t:Column id="mainSpecDesc" width="20rem"  hAlign="Left">
                                <Label text="규격" textAlign="Left" width="100%"/>
                                <t:template>
                                    <Text text="{viewModel>spec_desc}"/>
                                </t:template>
                                </t:Column>
                                <t:Column id="mainUnit" width="4rem" hAlign="Center">
                                <Label text="단위" textAlign="Center" width="100%"/>
                                <t:template>
                                    <Text text="{viewModel>unit}"/>
                                </t:template>
                                </t:Column>
                                
                                <t:Column id="mainQuotationQuantity" width="4rem" hAlign="Center">
                                <Label text="수량" textAlign="Center" width="100%" required="true"/>
                                <t:template>
                                    <HBox justifyContent="End">
                                    <Text  text="{
                                                    path: 'viewModel>quotation_quantity',
                                                    formatter: '.numberFormatter.toNumberString'
                                                }"
                                                vAlign="Right"
                                                visible="{midObjectViewModel>/isShowMode}"/>
                                    <Input value="{
                                                        path: 'viewModel>quotation_quantity',
                                                        type: 'sap.ui.model.type.Integer',
                                                        constraints: {
                                                            minimum: '0',
                                                            maximum: '1000000000000'
                                                        }
                                                    }" textAlign="Right" 
                                            change=".onQuantityChange"
                                            visible="{=!${midObjectViewModel>/isShowMode}}"/>  
                                    </HBox>
                                </t:template>
                                </t:Column>
                                <t:Column id="mainExtraRate" width="4rem" hAlign="Center">
                                <Label text="할증" textAlign="Center" width="100%"/>
                                <t:template>
                                    <!-- <Text text="{viewModel>extra_rate}"/> -->
                                    <Link text="{viewModel>extra_rate}" press=".onTableExtraRatePress($event)" enabled="{= ${viewModel>labor_net_price} > 0 ? true : false }" />                
               
                                </t:template>
                                </t:Column>
                                <t:Column id="mainMaterialNetPrice" width="8rem" hAlign="Right">
                                <Label text="자재단가" textAlign="Center" width="100%"/>
                                <t:template>
                                    <HBox justifyContent="End"> 
                                        <Text  text="{
                                                    path: 'viewModel>material_net_price',
                                                    formatter: '.numberFormatter.toNumberString'
                                                }"
                                                vAlign="Right"
                                                visible="{midObjectViewModel>/isShowMode}"/>
                                        <Input value="{
                                                        path: 'viewModel>material_net_price',
                                                        type: 'sap.ui.model.type.Integer',
                                                        constraints: {
                                                            minimum: '0',
                                                            maximum: '1000000000000'
                                                        }
                                                    }" textAlign="Right" 
                                            change=".onMaterialChange"
                                            visible="{=!${midObjectViewModel>/isShowMode}}"/>   
                                    </HBox>
                                </t:template>
                                </t:Column>  
                                <t:Column id="mainMaterialAmount" width="8rem" hAlign="Right">
                                <Label text="자재금액" textAlign="Center" width="100%"/>
                                <t:template>
                                    <Text  text="{
                                                    path: 'viewModel>material_amount',
                                                    formatter: '.numberFormatter.toNumberString'
                                                }"
                                                vAlign="Right"/> 
                                </t:template>
                                </t:Column>  
                                <t:Column id="mainLaborNetPrice" width="8rem" hAlign="Right">
                                <Label text="노무단가" textAlign="Center" width="100%"/>
                                <t:template>
                                    <HBox justifyContent="End">    
                                        <Text  text="{
                                                    path: 'viewModel>labor_net_price',
                                                    formatter: '.numberFormatter.toNumberString'
                                                }"
                                                vAlign="Right"
                                                visible="{midObjectViewModel>/isShowMode}"/>
                                        <Input value="{
                                                        path: 'viewModel>labor_net_price',
                                                        type: 'sap.ui.model.type.Integer',
                                                        constraints: {
                                                            minimum: '0',
                                                            maximum: '1000000000000'
                                                        }
                                                    }" textAlign="Right" 
                                            change=".onLaborChange"
                                            visible="{=!${midObjectViewModel>/isShowMode}}"/> 
                                    </HBox>  
                                </t:template>
                                </t:Column>
                                <t:Column id="mainLaborAmount" width="8rem" hAlign="Right">
                                <Label text="노무금액" textAlign="Center" width="100%"/>
                                <t:template>
                                    <Text  text="{
                                                    path: 'viewModel>labor_amount',
                                                    formatter: '.numberFormatter.toNumberString'
                                                }"
                                                vAlign="Right"/> 
                                     
                                </t:template>
                                </t:Column>  
                                <t:Column id="mainSumAmount" width="8rem" hAlign="Right">
                                <Label text="합계금액" textAlign="Center" width="100%"/>
                                <t:template>
                                    <Text  text="{
                                                    path: 'viewModel>sum_amount',
                                                    formatter: '.numberFormatter.toNumberString'
                                                }"
                                                vAlign="Right"/> 
                                </t:template>
                                </t:Column>  
                                <t:Column id="mainRemark" width="10rem" hAlign="Left">
                                <Label text="비고" textAlign="Center" width="100%"/>
                                <t:template>
                                    <Text text="{viewModel>remark}"/>          
                                </t:template>
                                </t:Column> 
                                
                                <t:Column id="mainLoiPublishStatusCode" width="10rem" hAlign="Center">
                                <Label text="단가계약그룹번호" textAlign="Center" width="100%" tooltip="LOI발행상태"/>
                                <t:template>
                                    <Text text="{viewModel>net_price_contract_document_no}"/>
                                </t:template>
                                </t:Column> 
                                
                            </t:columns>
                            </t:Table>

                                            
                        </VBox>
                        </form:SimpleForm>                    
					</uxap:ObjectPageSubSection>
				</uxap:subSections>
			</uxap:ObjectPageSection>


            <!-- 원가내역 시작 -->
			<!-- <uxap:ObjectPageSection titleUppercase="false" title="원가내역">
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
						<uxap:blocks>

                            <HBox>
        
                            </HBox>

						</uxap:blocks>
					</uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection> -->
            <!-- 원가내역 끝 -->

            <!-- 준공정보 시작 -->
			<uxap:ObjectPageSection titleUppercase="false" title="준공정보">
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
						<uxap:blocks>
                        <form:SimpleForm id="pageSearchForm" maxContainerCols="2" editable="true" layout="ResponsiveGridLayout" adjustLabelSpan="false" labelSpanL="4" labelSpanM="4" emptySpanL="0" emptySpanM="0" columnsL="2" columnsM="2">
                    <form:content>
                            <VBox alignContent="Center">
                                    <Label text="준공여부" textAlign="left" design="Bold" class="sapMLabelNoText" />

                                    <SegmentedButton 
                                        id="search_completionflag"
                                        enabled="{=!${midObjectViewModel>/isShowMode}}"
                                        selectedKey="{viewModel>/ucmaster/completion_flag}" 
                                        selectionChange=".onSegmentChange"
                                        
                                        width="100%">
                                        <items>
                                            <SegmentedButtonItem text="Yes" width="6em" key="true"/>
                                            <SegmentedButtonItem text="No" width="6em" key="false"/>
                                        </items>
                                    </SegmentedButton>
                                    <layoutData>
                                        <layout:GridData span="XL12 L12 M12 S12" />
                                    </layoutData> 
                                </VBox>   

                            
                                <!-- <form:SimpleForm id="completionForm1Show" editable="{viewModel>/ucmaster/completion_flag}">  -->
                                    <VBox alignContent="Center" alignItems="Stretch" visible="{viewModel>/ucmaster/completion_flag}"> 
                                        <Label  text="* 준공일자" 
                                                    design="Bold" 
                                                    class="sapUiSmallMarginBottom"/>
                                        <HBox>
                                            <!-- <DatePicker displayFormat="yyyy-MM-dd" valueFormat="yyyy-MM-dd" value="{viewModel>/ucmaster/completion_date}" required="true" placeholder="Date" width="100%"
                                                visible="{=!${midObjectViewModel>/isShowMode}}"
                                                editable="{viewModel>/ucmaster/completion_flag}"/> -->
                    
                                            <!-- <DatePicker placeholder="Date" id="completionDatePicker" value="{path: 'viewModel>/ucmaster/completion_date',type: 'sap.ui.model.odata.type.DateTime', formatOptions: { UTC: true, format: 'yMd' }}" valueFormat="yyyy-MM-dd" displayFormat="yyyy-MM-dd"
                                                visible="{=!${midObjectViewModel>/isShowMode}}"
                                                editable="{viewModel>/ucmaster/completion_flag}"/> -->

                                            <!-- <DatePicker
                                                id="changeDate"
                                                value="{
                                                    path:'viewModel>/ucmaster/completion_date',
                                                    type:'sap.ui.model.odata.type.DateTime',
                                                    formatOptions: {
                                                        pattern: 'yyyy-MM-dd'
                                                    }
                                                }"
                                                visible="{=!${midObjectViewModel>/isShowMode}}"
                                                editable="{viewModel>/ucmaster/completion_flag}"/>  -->


                                            <DatePicker displayFormat="yyyy-MM-dd" valueFormat="yyyy-MM-dd" value="{viewModel>/ucmaster/completion_date}" required="true" placeholder="Date" width="100%"
                                                visible="{=!${midObjectViewModel>/isShowMode}}"
                                                editable="{viewModel>/ucmaster/completion_flag}"/> 
                    


                                            <!-- <DatePicker id="completionDate" placeholder="Date" 
                                             visible="{=!${midObjectViewModel>/isShowMode}}"
                                                editable="{viewModel>/ucmaster/completion_flag}"/> -->

                                            
                                            <!-- <DatePicker
                                                value="{
                                                    path:'viewModel>/ucmaster/completion_date',
                                                    type:'sap.ui.model.odata.type.DateTime',
                                                    formatOptions: {
                                                        pattern: 'yyyy-MM-dd'
                                                    }
                                                }"
                                                visible="{=!${midObjectViewModel>/isShowMode}}"
                                                editable="{viewModel>/ucmaster/completion_flag}"/> -->
                                            <!-- <DatePicker placeholder="Disable Date" value="{path: 'viewModel>/ucmaster/completion_date',type: 'sap.ui.model.odata.type.DateTime', formatOptions: { UTC: true, format: 'yMd' }}"
                                                visible="{=!${midObjectViewModel>/isShowMode}}"
                                                editable="{viewModel>/ucmaster/completion_flag}"/> -->

                                            <Text text="{
                                                path: 'viewModel>/ucmaster/completion_date',
                                                type: 'sap.ui.model.type.Date',
                                                formatOptions: {
                                                    pattern: 'yyyy/MM/dd'
                                                }                                        
                                            }"  
                                            class="sapUiTinyMarginBegin" visible="{midObjectViewModel>/isShowMode}"/>     
                                        </HBox> 
                                        <layoutData>
                                            <layout:GridData span="XL6 L6 M6 S12" />
                                        </layoutData>   
                                    </VBox>
                                    <VBox alignContent="Center" alignItems="Stretch" visible="{viewModel>/ucmaster/completion_flag}"> 
                                        <Label  text="* 시설담당자" 
                                                    design="Bold" 
                                                    class="sapUiSmallMarginBottom"/>
                                        <HBox>

                                        <!-- <lib-m:CodePicker id="searchRequestorS"
                                            placeholder="Employee name"
                                            keyField="employee_number"
                                            textField="user_local_name"
                                            suggestionItems="{
                                                path: 'viewModel>/ucmaster/facility_person_name',
                                                filters: [
                                                    {path: 'tenant_id', operator: 'EQ', value1: 'L2100'}
                                                ],
                                                serviceUrl: 'srv-api/odata/v2/cm.util.HrService/',
                                                entityName: 'Employee'
                                            }"
                                            visible="{=!${midObjectViewModel>/isShowMode}}"
                                            editable="{viewModel>/ucmaster/completion_flag}"
                                            >
                                            <lib-m:CodePickerValueHelp contentWidth="500px" title="Choose a Employee"
                                                keyFieldHeaderText="Employee ID" textFieldHeaderText="Employee" 
                                                />
                                        </lib-m:CodePicker>      -->
                                        <HBox>
                                            <!-- <SearchField id="facility_person_name"
                                            search=".onDetailInputWithManValuePress" 
                                            change="resetDetailCode"
                                            visible="{=!${midObjectViewModel>/isShowMode}}"
                                                editable="{viewModel>/ucmaster/completion_flag}"
                                            />
                                        <Input id="facility_person_empno" placeholder="Input data" visible ="false"></Input> -->

                                            <Input id="saveFacilityPersonName" value="{viewModel>/ucmaster/facility_person_name}" required="true" placeholder="시설담당자" showValueHelp="true" valueHelpRequest=".openPlantPopup" width="100%" />
                                            <Input id="saveFacilityPersonCode" value="{viewModel>/ucmaster/facility_person_empno}" visible="false" />
                                        </HBox>
                                        <Text text="{viewModel>/ucmaster/facility_person_name}" 
                                            visible="{midObjectViewModel>/isShowMode}"/> 
                                              
                                        </HBox>  
                                        <layoutData>
                                            <layout:GridData span="XL6 L6 M6 S12" />
                                        </layoutData>          
                                    </VBox>
                                <!-- </form:SimpleForm>    -->

                                
                                    <UploadCollection
                                        id="UploadCollection2"
                                        maximumFilenameLength="55"
                                        maximumFileSize="10"
                                        multiple="true"
                                        sameFilenameAllowed="true"
                                        instantUpload="false"
                                        noDataDescription="Drop files or use the &quot;Add&quot; button to keep files ready for upload"
                                        change="onChange"
                                        fileDeleted="onFileDeleted"
                                        filenameLengthExceed="onFilenameLengthExceed"
                                        fileSizeExceed="onFileSizeExceed"
                                        typeMissmatch="onTypeMissmatch"
                                        uploadComplete="onUploadComplete"
                                        beforeUploadStarts="onBeforeUploadStarts" 
                                        editable="{viewModel>/ucmaster/completion_flag}"
                                        visible="{viewModel>/ucmaster/completion_flag}">
                                        <layoutData>
                                            <layout:GridData span="XL12 L12 M12 S12" />
                                        </layoutData> 
                                </UploadCollection>
                                </form:content>
                            </form:SimpleForm>   

    
						</uxap:blocks>
					</uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>
            <!-- 준공정보 끝 -->

            <!-- 결재라인 시작 -->
			<!-- <uxap:ObjectPageSection titleUppercase="false" title="결재라인">
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
						<uxap:blocks>
                            <HBox>
        
                            </HBox>
						</uxap:blocks>
					</uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection> -->
            <!-- 결재라인 끝 -->

		</uxap:sections>
		
		<uxap:footer>
			<OverflowToolbar>
                <Button
                    icon="sap-icon://alert"
                    type="Emphasized"
                    text="{= ${message>/}.length }"
                    visible="{= ${message>/}.length > 0 }"
                    ariaHasPopup="Dialog"
                    press=".onMessagePopoverPress" />
				<ToolbarSpacer />
                <Button id="pageEditButton" type="Transparent" text="Edit" press=".onPageEditButtonPress" />
                <Button id="pageSaveButton" type="Emphasized" text="Draft" press=".onPageSaveButtonPress('D')" />
                <Button id="pageCancelButton" type="Transparent" text="Cancel" press=".onPageCancelEditButtonPress"/>
                <!-- <Button id="pageDeleteButton" type="Transparent" text="Delete" press=".onPageDeleteButtonPress" visible="{= ${editMode>/newcheck} === 'new' ? false : true}"/>                 -->
                <Button id="pageRequestButton" type="Emphasized" text="Request" press=".onPageSaveButtonPress('R')" />
			</OverflowToolbar>
		</uxap:footer>
	</uxap:ObjectPageLayout>
</mvc:View>