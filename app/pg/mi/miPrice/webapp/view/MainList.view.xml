<mvc:View controllerName="pg.mi.miPrice.controller.MainList" 
    xmlns:mvc="sap.ui.core.mvc" 
    xmlns="sap.m" 
    xmlns:f="sap.f" 
    xmlns:form="sap.ui.layout.form" 
    xmlns:t="sap.ui.table"
    xmlns:layout="sap.ui.layout" 
    xmlns:core="sap.ui.core" 
    xmlns:lib-m="ext.lib.m"
    xmlns:smartFilterBar="sap.ui.comp.smartfilterbar"
    xmlns:smartTable="sap.ui.comp.smarttable"
    xmlns:smartVariantManagement="sap.ui.comp.smartvariants"
    xmlns:u="sap.ui.unified"
    height="100%">

    <f:DynamicPage id="page"
        headerExpanded="{oUi>/headerExpanded}" 
        showFooter="{= ${message>/}.length > 0 }"
        toggleHeaderOnTitleClick="true">
        <!-- DynamicPage Title -->
        <f:title>
            <f:DynamicPageTitle>
                <f:heading>
                    <Title text="{I18N>/MIPRICE_TITLE}" />
                </f:heading>
                <f:snappedContent></f:snappedContent>
                <f:expandedContent></f:expandedContent>
                <f:actions>
                    <Button id="pageSearchButton" text="{I18N>/SEARCH}" visible="false" type="Emphasized" press=".onPageSearchButtonPress" />
                </f:actions>
                <f:navigationActions>
                    <Button icon="sap-icon://unfavorite" type="Transparent" />
                </f:navigationActions>
            </f:DynamicPageTitle>
        </f:title>
        <!-- DynamicPage Header -->
        <f:header>
            <f:DynamicPageHeader pinnable="true">
                <f:content>
                    <!-- <smartVariantManagement:SmartVariantManagement        
                        id="pageVariantId"
                        standardItemText="{I18N>/STANDARD}"
                        persistencyKey="PageVariantPKey" />  -->

                        <!-- smartVariant="pageVariantId"
                        persistencyKey="SmartFilterPKey"
                        considerSelectionVariants="false"  -->
                    <!-- Smart Filter -->
                    <smartFilterBar:SmartFilterBar id="smartFilterBar" 
                        entitySet="MIMaterialPriceManagementView " 
                        enableBasicSearch="false" 
                        >
                        <smartFilterBar:controlConfiguration>
                            <!-- 시황자재코드 -->
                            <smartFilterBar:ControlConfiguration  key="mi_material_code" groupId="_BASIC" index="1" label="{I18N>/MI_MATERIAL_CODE}"
                                visibleInAdvancedArea="true">
                                <smartFilterBar:customControl>
                                    <MultiComboBox id="combobox_mi_material_code" items="{path: '/MIMatCodeView', templateShareable:true}" placeholder="선택하세요.">
                                        <core:Item key="{mi_material_code}" text="{mi_material_name}"/>
                                    </MultiComboBox>
                                </smartFilterBar:customControl>
                                
                            </smartFilterBar:ControlConfiguration>

                            <!-- 시황자재명 -->
                            <smartFilterBar:ControlConfiguration key="mi_material_name" groupId="_BASIC" index="2" label="{I18N>/MI_MATERIAL_NAME}"  
                            visibleInAdvancedArea="true" >
                                <smartFilterBar:customControl>
                                    <Input id="input_mi_material_name" placeholder="입력 해주세요."/>
                                </smartFilterBar:customControl>
                            </smartFilterBar:ControlConfiguration>

                            <!-- Category명 -->
                            <smartFilterBar:ControlConfiguration key="category_code" groupId="_BASIC" index="3" label="{I18N>/CATEGORY_NAME}" 
                            visibleInAdvancedArea="true">
                                <smartFilterBar:customControl>
                                    <ComboBox id="combobox_category_code" items="{path: '/MICategoryView', templateShareable:true}" placeholder="선택하세요.">
                                        <core:Item key="{category_code}" text="{category_text}"/>
                                    </ComboBox>
                                </smartFilterBar:customControl>
                            </smartFilterBar:ControlConfiguration>
                             <!-- 거래소 -->
                            <smartFilterBar:ControlConfiguration key="exchange" groupId="_BASIC" index="3" label="거래소" 
                            visibleInAdvancedArea="true">
                                <smartFilterBar:customControl>
                                     <Input id="input_exchange" placeholder="입력 해주세요."/>
                                </smartFilterBar:customControl>
                            </smartFilterBar:ControlConfiguration>
                            <!-- 시황일자 -->
                            <smartFilterBar:ControlConfiguration key="mi_date" groupId="_BASIC" index="3" label="{I18N>/MI_DATE}" 
                            visibleInAdvancedArea="true">
                                <smartFilterBar:customControl>
                                     <DatePicker id="datepicker_mi_date" placeholder="Date" displayFormat="yyyy/MM/dd'"/>
                                </smartFilterBar:customControl>
                            </smartFilterBar:ControlConfiguration>

                            <smartFilterBar:ControlConfiguration key="Validated" filterType="single"/>   
                        </smartFilterBar:controlConfiguration>
                        <smartFilterBar:layoutData>
                            <FlexItemData shrinkFactor="0"/>
                        </smartFilterBar:layoutData>
                    </smartFilterBar:SmartFilterBar>
                </f:content>

            </f:DynamicPageHeader>
        </f:header>
        <f:content>
        
            <smartTable:SmartTable
                width="100%"
                height="100%"
                
                
                id="smartTable_MainTable_ResponsiveTable"
                header="{I18N>/MIPRICE_TITLE} List"
                entitySet="MIMaterialPriceManagementView" 
                tableBindingPath="list>/MIMaterialPriceManagementView"
                smartFilterId="smartFilterBar" 
                tableType="ResponsiveTable" 
                useExportToExcel="true"
                beforeRebindTable=".onBeforeRebindTable"
                beforeExport=".onBeforeExport" 
                useVariantManagement="false" 
                useTablePersonalisation="false" 
                showRowCount="true" 
                editable="true" 
                persistencyKey="SmartTableAnalytical_Explored" 
                enableAutoBinding="false" 
                demandPopin="true" 
                class="sapUiResponsiveContentPadding"
                initiallyVisibleFields="mi_material_code,mi_material_name,category_code,category_name,currency_unit,quantity_unit,exchange_unit,exchange,termsdelv,sourcing_group_code,delivery_mm,mi_date,amount"
                >


                <smartTable:customToolbar>
                    <OverflowToolbar design="Transparent">
                        <ToolbarSpacer/>
                        <Button id="mainTableAddButton" text="{I18N>/ROW_ADD}" type="Transparent" press=".onMainTableAddButtonPress" />
                        <Button id="mainTableDeleteButton" text="{I18N>/ROW_DELETE}" type="Transparent" press=".onMainTableDeleteButtonPress" />
                        <Button id="mainTableSaveButton" text="{I18N>/SAVE}" type="Emphasized" press=".onMainTableSaveButtonPress" />
                                         
                        <!-- <Button text="Delete" id="buttonMainTableDelete" type="Transparent" enabled="false" press=".onMainTableDelete"/>
                        <Button text="Save" id="buttonMainTableCopy" type="Emphasized"   press=".onMainTableCopy"/> -->
                       
                        <!-- <Button icon="sap-icon://upload" type="Transparent" press=".onMainTableDelete"/> -->
                        <u:FileUploader id="rFileUploader" uploadComplete="handleUploadComplete" change=".onImportChange" 
                                        buttonOnly="true" iconOnly="true" icon="sap-icon://upload" tooltip="Upload"/>
                        <Button icon="sap-icon://download" iconOnly="true" type="Transparent" enabled="false" tooltip="Template Download"/>           

                        <!-- <u:FileUploader					
                                        id="fileUploader" buttonOnly="true" iconOnly="true"					
                                        fileType="xlsx,XLSX" icon="sap-icon://upload"					
                                        name="myFileUpload"					
                                        uploadUrl="upload/"					
                                        tooltip="Upload your file to the local server"					
                                        change="onUpload"					
                                        uploadComplete="handleUploadComplete"/> -->
                    </OverflowToolbar>
                </smartTable:customToolbar>

                <Table id="mainTable" 
                        mode="MultiSelect"
                        fixedLayout="false"
                        popinLayout="GridLarge"
                        sticky="HeaderToolbar,ColumnHeaders">
                    <columns>  
                        <Column hAlign="Center" demandPopin="true" popinDisplay="Inline" width="30px">
                            <Text text=""></Text>                                                                             
                        </Column>
                        <Column hAlign="Center"  demandPopin="true"  popinDisplay="Inline" width="8%" >
                            <customData>
                                <core:CustomData key="p13nData"
                                    value='\{"columnKey": "mi_material_code", "leadingProperty": "mi_material_code", "sortProperty": "mi_material_code", "filterProperty": "mi_material_code", "columnIndex": 1}'/>
                            </customData>
                            <Text text="{I18N>/MI_MATERIAL_CODE}"></Text>
                        </Column>
                        <Column hAlign="Center" demandPopin="true" popinDisplay="Inline" width="10%" >
                            <customData>
                                <core:CustomData key="p13nData"
                                    value='\{"columnKey": "mi_material_name", "leadingProperty": "mi_material_name", "sortProperty": "mi_material_name", "filterProperty": "mi_material_name", "columnIndex": 2}'/>
                            </customData>
                            <Text text="{I18N>/MI_MATERIAL_NAME}"></Text>
                        </Column>
                        <Column hAlign="Center" demandPopin="true" popinDisplay="Inline" width="8%" >
                            <customData>
                                <core:CustomData key="p13nData"
                                    value='\{"columnKey": "category_code", "leadingProperty": "category_code", "sortProperty": "category_code", "filterProperty": "category_code", "columnIndex": 3}'/>
                            </customData>
                            <Text text="{I18N>/CATEGORY_CODE}"></Text>
                        </Column>
                       
                        <Column hAlign="Center" demandPopin="true" popinDisplay="Inline" width="10%" >
                            <customData>
                                <core:CustomData key="p13nData"
                                    value='\{"columnKey": "category_name", "leadingProperty": "category_name", "sortProperty": "category_name", "filterProperty": "category_name", "columnIndex": 4}'/>
                            </customData>
                            <Text text="{I18N>/CATEGORY_NAME}"></Text>
                        </Column>
                        <Column hAlign="Center" demandPopin="true" popinDisplay="Inline" width="6%" >
                            <customData>
                                <core:CustomData key="p13nData"
                                    value='\{"columnKey": "currency_unit", "leadingProperty": "currency_unit", "sortProperty": "currency_unit", "columnIndex": 5}'/>
                            </customData>
                            <Text text="화폐단위"></Text>                                                                             
                        </Column>
                        <Column hAlign="Center" demandPopin="true" popinDisplay="Inline" width="6%">
                            <customData>
                                <core:CustomData key="p13nData"
                                    value='\{"columnKey": "quantity_unit", "leadingProperty": "quantity_unit", "sortProperty": "quantity_unit", "filterProperty": "quantity_unit", "columnIndex": 6}'/>
                            </customData>
                            <Text text="수량단위"></Text>                                                                             
                        </Column>
                        <Column hAlign="Center" demandPopin="true" popinDisplay="Inline" width="8%">
                            <customData>
                                <core:CustomData key="p13nData"
                                    value='\{"columnKey": "exchange_unit", "leadingProperty": "exchange_unit", "sortProperty": "exchange_unit", "columnIndex": 7}'/>
                            </customData>
                            <Text text="거래소단위"></Text>                                                                             
                        </Column>
                        <Column hAlign="Center" demandPopin="true" popinDisplay="Inline" width="7%">
                            <customData>
                                <core:CustomData key="p13nData"
                                    value='\{"columnKey": "exchange", "leadingProperty": "exchange", "sortProperty": "exchange", "filterProperty": "exchange", "columnIndex": 8}'/>
                            </customData>
                            <Text text="거래소"></Text>                                                                             
                        </Column>
                        <Column hAlign="Center" demandPopin="true" popinDisplay="Inline" width="10%">
                            <customData>
                                <core:CustomData key="p13nData"
                                    value='\{"columnKey": "termsdelv", "leadingProperty": "termsdelv", "sortProperty": "termsdelv", "filterProperty": "termsdelv", "columnIndex": 9}'/>
                            </customData>
                            <Text text="{I18N>/TERMS_OF_DELIVERY}"></Text>                                                                             
                        </Column>
                        <Column hAlign="Center" demandPopin="true" popinDisplay="Inline" width="7%">
                            <customData>
                                <core:CustomData key="p13nData"
                                    value='\{"columnKey": "sourcing_group_code", "leadingProperty": "sourcing_group_code", "sortProperty": "sourcing_group_code", "filterProperty": "sourcing_group_code", "columnIndex": 10}'/>
                            </customData>
                            <Text text="{I18N>/SOURCING_GROUP_CODE}"></Text>                                                                             
                        </Column>
                        <Column hAlign="Center" demandPopin="true" popinDisplay="Inline" width="7%">
                            <customData>
                                <core:CustomData key="p13nData"
                                    value='\{"columnKey": "delivery_mm", "leadingProperty": "delivery_mm", "sortProperty": "delivery_mm", "filterProperty": "delivery_mm", "columnIndex": 11}'/>
                            </customData>
                            <Text text="인도월"></Text>                                                                             
                        </Column>
                        <Column hAlign="Center" demandPopin="true" popinDisplay="Inline" width="8%">
                            <customData>
                                <core:CustomData key="p13nData"
                                    value='\{"columnKey": "mi_date", "leadingProperty": "mi_date", "sortProperty": "mi_date", "filterProperty": "mi_date", "columnIndex": 12}'/>
                            </customData>
                            <Text text="{I18N>/MI_DATE}"></Text>                                                                             
                        </Column>

                        <Column hAlign="Center" demandPopin="true" popinDisplay="Inline" width="6%">
                            <customData>
                                <core:CustomData key="p13nData"
                                    value='\{"columnKey": "amount", "leadingProperty": "amount", "sortProperty": "amount", "filterProperty": "amount", "columnIndex": 13}'/>
                            </customData>
                            <Text text="{I18N>/AMOUNT}"></Text>                                                                             
                        </Column>

                    </columns>
                        <items >
                            <ColumnListItem hAlign="Middle" press=".onMainTableItemPress">
                                <ObjectStatus icon="{
                                    path: 'list>_row_state_',
                                    formatter: '.formatter.toModelStateColumnIcon'
                                }" />
                                <Input value="{list>mi_material_code}" editable="{= ${list>_row_state_} === 'C' }"  required="true"
                                    showSuggestion="true" suggestionItems="{/MIMatCodeView}" 
                                    suggestionItemSelected="onSuggestionItemSelected" submit="onSubmit" >
                                    <suggestionItems>
                                        <core:Item text="{mi_material_code}" />
                                    </suggestionItems>
                                </Input>
                                <Text text="{list>mi_material_name}" ></Text>
                                <Text text="{list>category_code}"></Text>
                                <Text text="{list>category_name}"></Text>

                                <ComboBox items="{path: '/CurrencyUnitView', templateShareable:true, filters: [{path: 'tenant_id', operator: 'EQ', value1: 'L2100'}]}" 
                                    placeholder="선택하세요."  selectedKey="{list>currency_unit}"
                                    width="100%" editable="{= ${list>_row_state_} === 'C' }" required="true">
                                    <items>
                                        <core:Item key="{currency_code}" text="{currency_code}" />
                                    </items>
                                </ComboBox>
                                <ComboBox items="{path: '/UnitOfMeasureView', templateShareable:true, filters: [{path: 'tenant_id', operator: 'EQ', value1: 'L2100'}]}" 
                                    placeholder="선택하세요." selectedKey="{list>quantity_unit}"
                                    width="100%" editable="{= ${list>_row_state_} === 'C' }" required="true">
                                    <core:Item key="{uom_code}" text="{uom_code}"/>
                                </ComboBox>
                                <!-- <Text text="{quantity_unit}"></Text>   -->
                                <Input value="{list>exchange_unit}" editable="{= ${list>_row_state_} === 'C' }" ></Input>  
                                <ComboBox items="{path: '/MIExchangeView', templateShareable:true, filters: [{path: 'tenant_id', operator: 'EQ', value1: 'L2100'}]}" 
                                    placeholder="선택하세요." selectedKey="{list>exchange}"
                                    width="100%" editable="{= ${list>_row_state_} === 'C' }" required="true">
                                    <core:Item key="{exchage}" text="{exchage}"/>
                                </ComboBox>
                                <!-- <Text text="{exchange}"></Text>   -->
                                <ComboBox items="{path: '/MITermsdelvView', templateShareable:true, filters: [{path: 'tenant_id', operator: 'EQ', value1: 'L2100'}]}" 
                                    placeholder="선택하세요." selectedKey="{list>termsdelv}" 
                                    width="100%" editable="{= ${list>_row_state_} === 'C' }" required="true">
                                    <core:Item key="{termsdelv}" text="{termsdelv}"/>
                                </ComboBox>
                                <!-- <Text text="{termsdelv}"></Text>   -->
                                <Input value="{list>sourcing_group_code}" editable="{= ${list>_row_state_} === 'C' }"></Input>  
                                <Input value="{list>delivery_mm}" editable="{= ${list>_row_state_} === 'C' }"></Input>  
                                <DatePicker  valueFormat="yyyy/MM/dd" displayFormat="yyyy/MM/dd'" value="{path: 'list>mi_date', type: 'sap.ui.model.type.Date', formatOptions: { pattern: 'yyyy/MM/dd'} }" 
                                    editable="{= ${list>_row_state_} === 'C' }" required="true"/>
                                <!-- <Input value="{mi_date}"></Input>   -->
                                <Input value="{list>amount}" editable="{= ${list>_row_state_} === 'C' }" type="Number" textAlign="Right"></Input>  
                            </ColumnListItem>
                        </items>
                    </Table>

            

            </smartTable:SmartTable>
        </f:content>
        <!-- DynamicPage Footer -->
		<f:footer>
			<OverflowToolbar>
                <Button
                    icon="sap-icon://alert"
                    type="Reject"
                    text="{= ${message>/}.length }"
                    visible="{= ${message>/}.length > 0 }"
                    ariaHasPopup="Dialog"
                    press=".onMessagePopoverPress" />
				<ToolbarSpacer />
			</OverflowToolbar>
		</f:footer>
    </f:DynamicPage>
</mvc:View>