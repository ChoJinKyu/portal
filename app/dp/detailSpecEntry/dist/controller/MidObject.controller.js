sap.ui.define(["ext/lib/controller/BaseController","sap/ui/core/routing/History","sap/ui/model/json/JSONModel","ext/lib/model/TransactionManager","ext/lib/model/ManagedModel","ext/lib/model/ManagedListModel","ext/lib/formatter/DateFormatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/m/MessageBox","sap/m/MessageToast","ext/lib/util/Validator","dp/util/controller/SupplierSelection"],function(e,t,o,i,s,a,n,d,l,r,c,u,h,g){"use strict";var m;return e.extend("dp.detailSpecEntry.controller.MidObject",{dateFormatter:n,validator:new h,supplierSelection:new g,onInit:function(){var e=new o({busy:true,delay:0});this.getRouter().getRoute("midPage").attachPatternMatched(this._onRoutedThisPage,this);this.setModel(e,"midObjectView");this.setModel(new s,"master");this.setModel(new s,"mstSpecView");this.setModel(new a,"schedule");this.setModel(new s,"spec");m=new i;m.addDataModel(this.getModel("master"));m.addDataModel(this.getModel("schedule"));m.addDataModel(this.getModel("spec"))},onPageEnterFullScreenButtonPress:function(){var e=this.getModel("fcl").getProperty("/actionButtonsInfo/midColumn/fullScreen");this.getRouter().navTo("midPage",{layout:e,tenantId:this._sTenantId,moldId:this._sMoldId})},onPageExitFullScreenButtonPress:function(){var e=this.getModel("fcl").getProperty("/actionButtonsInfo/midColumn/exitFullScreen");this.getRouter().navTo("midPage",{layout:e,tenantId:this._sTenantId,moldId:this._sMoldId})},onPageNavBackButtonPress:function(){var e=this.getModel("fcl").getProperty("/actionButtonsInfo/midColumn/closeColumn");this.getRouter().navTo("mainPage",{layout:e})},onPageEditButtonPress:function(){this._toEditMode();this.clearValueState()},clearValueState:function(){this.validator.clearValueState(this.byId("scheduleTable1E"));this.validator.clearValueState(this.byId("frmMold"));this.validator.clearValueState(this.byId("frmPress"))},onPageDeleteButtonPress:function(){var e=this.getView(),t=this;c.confirm("Are you sure to delete?",{title:"Comfirmation",initialFocus:sap.m.MessageBox.Action.CANCEL,onClose:function(e){if(e===c.Action.OK){t.getView().getBindingContext().delete("$direct").then(function(){t.onNavBack()},function(e){c.error(e.message)})}}})},onPageSaveButtonPress:function(){var e=this.getView(),t=this;if(this.validator.validate(this.byId("scheduleTable1E"))!==true){u.show(this.getModel("I18N").getText("/ECM0201"));return}var o="";if(this.itemType=="P"||this.itemType=="E"){o="frmPress"}else{o="frmMold"}if(this.validator.validate(this.byId(o))!==true){u.show(this.getModel("I18N").getText("/ECM0201"));return}c.confirm("Are you sure ?",{title:"Comfirmation",initialFocus:sap.m.MessageBox.Action.CANCEL,onClose:function(o){if(o===c.Action.OK){e.setBusy(true);t.getModel("spec").setProperty("/mold_spec_status_code","D");m.submit({success:function(o){t._toShowMode();e.setBusy(false);u.show("Success to save.")}})}}})},onPageCancelEditButtonPress:function(){this._toShowMode()},onSuppValueHelpRequested:function(e){var t=this.getModel("master").getProperty("/company_code");var o=this.getModel("master").getProperty("/org_code");this.supplierSelection.showSupplierSelection(this,e,t,o)},_onRoutedThisPage:function(e){var t=e.getParameter("arguments"),o=this.getView();this._sTenantId=t.tenantId;this._sMoldId=t.moldId;if(t.tenantId=="new"&&t.moldId=="code"){var i=this.getModel("master");i.setData({tenant_id:"L2100"});this._toEditMode()}else{var s=this;this._bindView("/MoldMasters('"+this._sMoldId+"')","master",[],function(e){s._toShowMode()});this._bindView("/MoldMasterSpec('"+this._sMoldId+"')","mstSpecView",[],function(e){});var a=[new d("mold_id",l.EQ,this._sMoldId)];this._bindView("/MoldSchedule","schedule",a,function(e){});this._bindView("/MoldSpec('"+this._sMoldId+"')","spec",[],function(e){})}m.setServiceModel(this.getModel())},_bindView:function(e,t,o,i){var s=this.getView(),a=this.getModel(t);s.setBusy(true);a.setTransactionModel(this.getModel());a.read(e,{filters:o,success:function(e){s.setBusy(false);i(e)}})},_toEditMode:function(){this._showFormFragment("MidObject_Edit");this.byId("page").setSelectedSection("pageSectionMain");this.byId("page").setProperty("showFooter",true);this.byId("pageEditButton").setEnabled(false);this.byId("pageNavBackButton").setEnabled(false)},_toShowMode:function(){this._showFormFragment("MidObject_Show");this.byId("page").setSelectedSection("pageSectionMain");this.byId("page").setProperty("showFooter",false);this.byId("pageEditButton").setEnabled(true);this.byId("pageNavBackButton").setEnabled(true)},_oFragments:{},_showFormFragment:function(e){var t=this.byId("pageSubSection1");this._loadFragment(e,function(e){t.removeAllBlocks();t.addBlock(e)});var o=e.split("_")[1];var i=this.byId("pageSubSection2");this._loadFragment("MidObjectDevelopmentPlan_"+o,function(e){i.removeAllBlocks();i.addBlock(e)});var s=this.byId("pageSubSection3");var a=this.byId("pageSubSection4");s.removeAllBlocks();a.removeAllBlocks();var n=this.getModel("master");var d=n.oData.mold_item_type_code;if(d=="P"||d=="E"){this._loadFragment("MidObjectDetailSpecPress_"+o,function(e){a.addBlock(e)})}else{this._loadFragment("MidObjectDetailSpecMold_"+o,function(e){s.addBlock(e)})}},_loadFragment:function(e,t){if(!this._oFragments[e]){r.load({id:this.getView().getId(),name:"dp.detailSpecEntry.view."+e,controller:this}).then(function(o){this._oFragments[e]=o;if(t)t(o)}.bind(this))}else{if(t)t(this._oFragments[e])}}})});