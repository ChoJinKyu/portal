<mvc:View controllerName="dp.tc.projectMgt.controller.ProjectMgtList"
  xmlns:mvc="sap.ui.core.mvc"
  xmlns="sap.m"
  xmlns:f="sap.f"
  xmlns:core="sap.ui.core"
  xmlns:form="sap.ui.layout.form"
  xmlns:t="sap.ui.table"
  xmlns:layout="sap.ui.layout"
  xmlns:tnt="sap.tnt"
  class="sapUiSizeCompact"
  displayBlock="true"
  height="100%">
    <f:DynamicPage 
        headerExpanded="true"
        showFooter="true"
        toggleHeaderOnTitleClick="true">
        <!--DynamicPage Title -->
        <f:title>
            <f:DynamicPageTitle>
                <f:heading>
                    <Title text="프로젝트 관리" />
                </f:heading>

                <f:expandedContent>
                    <form:SimpleForm 
                            maxContainerCols="4"
                            editable="true" 
                            layout="ResponsiveGridLayout"
                            labelSpanL="3"
                            labelSpanM="3"
                            labelSpanS="3"
                            emptySpanL="0"
                            emptySpanM="0"
                            adjustLabelSpan="false">
                        <form:content>

                            <Label text="회사" required="true">
                                <layoutData>
                                    <layout:GridData span="XL1 L1 M1 S1" />
                                </layoutData>
                            </Label>
                            <ComboBox width="100%" change="onChangeCompnay" selectedKey="{filterModel>/company_code/value}" 
                                items="{
                                    path: 'org>/Org_Company',
                                    filters: [
                                        {path: 'tenant_id', operator: 'EQ', value1: 'L2100'}
                                    ],
                                    sorter: { path: 'company_code'}
                            }">
                                <items>
                                    <core:Item key="{org>company_code}" text="[{org>company_code}] {org>company_name}" />
                                </items>
                                <layoutData>
                                    <layout:GridData span="XL2 L2 M2 S2" />
                                </layoutData>
                            </ComboBox>

                            <Label text="사업부" required="true">
                                <layoutData>
                                    <layout:GridData span="XL1 L1 M1 S1" />
                                </layoutData>
                            </Label>
                            <ComboBox
                                id="cbxExpandDivision"
                                width="100%"
                                selectedKey="{filterModel>/bizdivision_code/value}"
                                items="{
                                    path: '/Division',
                                    filters: [
                                        {path: 'tenant_id', operator: 'EQ', value1: '999'}
                                    ],
                                    sorter: { path: 'bizdivision_code'}
                                }">
                                <items>
                                    <core:Item key="{bizdivision_code}" text="{bizdivision_name}" />
                                </items>
                                <layoutData>
                                    <layout:GridData span="XL2 L2 M2 S2" />
                                </layoutData>
                            </ComboBox>

                            <Label text="프로젝트코드">
                                <layoutData>
                                    <layout:GridData span="XL1 L1 M1 S1" />
                                </layoutData>
                            </Label>
                            <Input value="{filterModel>/project_code/value}" >
                                <layoutData>
                                    <layout:GridData span="XL2 L2 M2 S2" />
                                </layoutData>
                            </Input>

                            <Label text="대표모델코드">
                                <layoutData>
                                    <layout:GridData span="XL1 L1 M1 S1" />
                                </layoutData>
                            </Label>
                            <SearchField value="{filterModel>/model_code/value}" >
                                <layoutData>
                                    <layout:GridData span="XL2 L2 M2 S2" />
                                </layoutData>
                            </SearchField>

                        </form:content>
                    </form:SimpleForm>
                </f:expandedContent>

                <f:snappedContent>
                    <form:SimpleForm 
                            maxContainerCols="4"
                            editable="true" 
                            layout="ResponsiveGridLayout"
                            labelSpanL="3"
                            labelSpanM="3"
                            labelSpanS="3"
                            emptySpanL="0"
                            emptySpanM="0"
                            adjustLabelSpan="false">
                        <form:content>
                            <!--Search line 2-->
                            <Label text="회사" required="true">
                                <layoutData>
                                    <layout:GridData span="XL1 L1 M1 S1" />
                                </layoutData>
                            </Label>
                            <ComboBox width="100%" change="onChangeCompnay" selectedKey="{filterModel>/company_code/value}" 
                                items="{
                                    path: 'org>/Org_Company',
                                    filters: [
                                        {path: 'tenant_id', operator: 'EQ', value1: 'L2100'}
                                    ],
                                    sorter: { path: 'company_code'}
                            }">
                                <items>
                                    <core:Item key="{org>company_code}" text="[{org>company_code}] {org>company_name}" />
                                </items>
                                <layoutData>
                                    <layout:GridData span="XL2 L2 M2 S2" />
                                </layoutData>
                            </ComboBox>
                            
                            <Label text="사업부" required="true">
                                <layoutData>
                                    <layout:GridData span="XL1 L1 M1 S1" />
                                </layoutData>
                            </Label>
                            <ComboBox
                                id="cbxSnapDivision"
                                width="100%"
                                selectedKey="{filterModel>/bizdivision_code/value}"
                                items="{
                                    path: '/Division',
                                    filters: [
                                        {path: 'tenant_id', operator: 'EQ', value1: '999'}
                                    ],
                                    sorter: { path: 'bizdivision_code'}
                                }">
                                <items>
                                    <core:Item key="{bizdivision_code}" text="{bizdivision_name}" />
                                </items>
                                <layoutData>
                                    <layout:GridData span="XL2 L2 M2 S2" />
                                </layoutData>
                            </ComboBox>

                            <Label text="프로젝트코드">
                                <layoutData>
                                    <layout:GridData span="XL1 L1 M1 S1" />
                                </layoutData>
                            </Label>
                            <Input value="{filterModel>/project_code/value}" >
                                <layoutData>
                                    <layout:GridData span="XL2 L2 M2 S2" />
                                </layoutData>
                            </Input>

                            <Label text="대표모델코드">
                                <layoutData>
                                    <layout:GridData span="XL1 L1 M1 S1" />
                                </layoutData>
                            </Label>
                            <SearchField value="{filterModel>/model_code/value}" >
                                <layoutData>
                                    <layout:GridData span="XL2 L2 M2 S2" />
                                </layoutData>
                            </SearchField>

                        </form:content>
                    </form:SimpleForm>
                </f:snappedContent>

                <f:actions>
                    <Button text="조회" type="Emphasized" press=".onSearch"/> 
                    <!-- <Button text="Search2" type="Emphasized" press=".onSearch2"/> -->
                </f:actions>

            </f:DynamicPageTitle>
        </f:title>
        <!--DynamicPage Header -->
        <f:header>
            <f:DynamicPageHeader pinnable="true">
            <form:SimpleForm 
                maxContainerCols="4"
                editable="true" 
                layout="ResponsiveGridLayout"
                labelSpanL="3"
                labelSpanM="3"
                labelSpanS="3"
                emptySpanL="0"
                emptySpanM="0"
                adjustLabelSpan="false">
                    <form:content>
                        <!--Search line 2-->
                        <Label text="제품군">
                            <layoutData>
                                <layout:GridData span="XL1 L1 M1 S1" />
                            </layoutData>
                        </Label>
                        <ComboBox
                            width="100%"
                            selectedKey="{filterModel>/product_group_code/value}"
                            items="{
                                path: 'util>/Code',
                                filters: [
                                    {path: 'group_code', operator: 'EQ', value1: 'DC_TC_PRODUCT_GROUP_CODE'}
                                ],
                                sorter: { path: 'sort_no'}
                            }">
                            <items>
                            <core:Item key="{util>code}" text="{util>code_name}" />
                            </items>
                            <layoutData>
                                <layout:GridData span="XL2 L2 M2 S2" />
                            </layoutData>
                        </ComboBox>
                        <Label text="상태">
                            <layoutData>
                                <layout:GridData span="XL1 L1 M1 S1" />
                            </layoutData>
                        </Label>
                        <ComboBox
                            width="100%"
                            selectedKey="{filterModel>/project_status_code/value}"
                            items="{
                                path: 'util>/Code',
                                filters: [
                                    {path: 'group_code', operator: 'EQ', value1: 'DP_TC_PROJECT_STATUS_CODE'}
                                ],
                                sorter: { path: 'sort_no'}
                            }">
                            <items>
                                <core:Item key="{util>code}" text="{util>code_name}" />
                            </items>
                            <layoutData>
                                <layout:GridData span="XL2 L2 M2 S2" />
                            </layoutData>
                        </ComboBox>
                        <Label text="양산일자">
                            <layoutData>
                                <layout:GridData span="XL1 L1 M1 S1" />
                            </layoutData>
                        </Label>
                        <DateRangeSelection 
                            dateValue="{filterModel>/massprod_start_date/start}" 
                            secondDateValue="{filterModel>/massprod_start_date/end}" >
                            <layoutData>
                                <layout:GridData span="XL2 L2 M2 S2" />
                            </layoutData>
                        </DateRangeSelection>
                        <Label text="등급">
                            <layoutData>
                                <layout:GridData span="XL1 L1 M1 S1" />
                            </layoutData>
                        </Label>
                        <ComboBox
                            width="100%"
                            selectedKey="{filterModel>/project_grade_code/value}"
                            items="{
                                path: 'util>/Code',
                                filters: [
                                    {path: 'group_code', operator: 'EQ', value1: 'DP_TC_PROJECT_GRADE_CODE'}
                                ],
                                sorter: { path: 'sort_no'}
                            }">
                            <items>
                                <core:Item key="{util>code}" text="{util>code_name}" />
                            </items>
                            <layoutData>
                                <layout:GridData span="XL2 L2 M2 S2" />
                            </layoutData>
                        </ComboBox>
                        <Label text="이벤트">
                            <layoutData>
                                <layout:GridData span="XL1 L1 M1 S1" />
                            </layoutData>
                        </Label>
                        <ComboBox
                            width="100%"
                            selectedKey="{filterModel>/project_develope_event_code/value}"
                            items="{
                                path: 'util>/Code',
                                filters: [
                                    {path: 'group_code', operator: 'EQ', value1: 'DP_TC_DEVELOP_EVENT_CODE'}
                                ],
                                sorter: { path: 'sort_no'}
                            }">
                            <items>
                            <core:Item key="{util>code}" text="{util>code_name}" />
                            </items>
                            <layoutData>
                                <layout:GridData span="XL2 L2 M2 S2" />
                            </layoutData>
                        </ComboBox>
                        <Label text="재료비총괄">
                            <layoutData>
                                <layout:GridData span="XL1 L1 M1 S1" />
                            </layoutData>
                        </Label>
                        <SearchField value="{filterModel>/buyer_name/value}" >
                            <layoutData>
                                <layout:GridData span="XL2 L2 M2 S2" />
                            </layoutData>
                        </SearchField>
                    </form:content>
                </form:SimpleForm>
            </f:DynamicPageHeader>
        </f:header>
        <f:content>
            <!--Part No List 시작-->
            <t:Table id="mainTable"
                selectionMode="MultiToggle"
                cellClick=".onCellClickPress"
                rowSelectionChange="onSelectionChange"
                rowActionCount="1"
                rows="{listModel>/results}"
                width="100%"
                class="sapFDynamicPageAlignContent" 
                visibleRowCountMode="Auto">
                <t:extension>
                    <OverflowToolbar class="sapFDynamicPageAlignContent">
                        <!-- <Title text="{I18n>/PART_NO_LIST}" level="H2"/> -->
                        <Title text="프로젝트 관리 목록 ({= ${listModel>/results}.length})" level="H2"/>
                        <ToolbarSpacer />
                        <Button text="견적 재료비" type="Emphasized" press=".onEstimateCreatePress" />
                        <Button text="목표 재료비" type="Emphasized" press=".onGoalCreatePress" />
                        <Button text="예상 재료비" type="Emphasized" press=".onProgressMgtPress" />
                        <ToolbarSeparator/>
                        <Button text="모델 추가" type="Transparent" press=".onAddModelPress" />
                        <Button text="산출 제외" type="Transparent" press=".onExcludeCalPress" />
                        <ToolbarSeparator/>
                        <Button icon="sap-icon://excel-attachment" press=".onExcelExportPress"/>
                    </OverflowToolbar>
                </t:extension>
                <t:columns>
                    <t:Column hAlign="Left" width="8rem">
                        <!-- <Label text="{I18n>/DIV}" textAlign="Center" /> -->
                        <Label text="회사" textAlign="Center" width="100%"/>
                        <t:template>
                            <Text text="{listModel>company_code}" />
                        </t:template>
                    </t:Column>
                    <t:Column hAlign="Begin" width="10rem">
                        <!-- <Label text="{I18n>/DIV}" textAlign="Center" /> -->
                        <Label text="사업부" />
                        <t:template>
                            <Text text="{listModel>bizdivision_text}" />
                        </t:template>
                    </t:Column>
                    <t:Column hAlign="Left" width="10rem">
                        <!-- <Label text="{I18n>/PART_NO}" /> -->
                        <Label text="제품군" textAlign="Center" width="100%" />
                        <t:template>
                            <Text text="{listModel>product_group_text}" />
                        </t:template>
                    </t:Column>
                    <t:Column hAlign="Left" width="12rem">
                        <!-- <Label text="{I18n>/DESCRIPTION}" textAlign="Center" /> -->
                        <Label text="고객사" textAlign="Center" width="100%" />
                        <t:template>
                            <Text text="{listModel>customer_local_name}" />
                        </t:template>
                    </t:Column>
                    <t:Column hAlign="Center" width="5rem">
                        <!-- <Label text="{I18n>/SPECIFICATION}" /> -->
                        <Label text="등급" />
                        <t:template>
                            <Text text="{listModel>project_grade_text}" />
                        </t:template>
                    </t:Column>
                    <t:Column hAlign="Center"  width="12rem">
                        <!-- <Label text="{I18n>/BASIS}" textAlign="Center" width="100%"/> -->
                        <Label text="프로젝트코드" />
                        <t:template>
                            <!--<Text text="{listModel>project_code}" />-->
                            <Text text="{listModel>project_code}" />
                        </t:template>
                    </t:Column>
                    <t:Column hAlign="Left"  width="15rem">
                        <!-- <Label text="{I18n>/BASIS}" textAlign="Center" width="100%"/> -->
                        <Label text="프로젝트명" textAlign="Center" width="100%" />
                        <t:template>
                            <!--<Text text="{listModel>project_name}" />-->
                            <Text text="{listModel>project_name}" />
                        </t:template>
                    </t:Column>
                    <t:Column hAlign="Center"  width="12rem">
                        <!-- <Label text="{I18n>/BASIS}" textAlign="Center" width="100%"/> -->
                        <Label text="견적프로젝트코드" />
                        <t:template>
                            <!--<Text text="{listModel>project_code}" />-->
                            <Text text="{listModel>quotation_project_code}" />
                        </t:template>
                    </t:Column>
                    <t:Column hAlign="Center"  width="15rem">
                        <!-- <Label text="{I18n>/BASIS}" textAlign="Center" width="100%"/> -->
                        <Label text="대표모델코드" textAlign="Center" width="100%" />
                        <t:template>
                            <Text text="{listModel>model_code}" />
                        </t:template>
                    </t:Column>
                    <t:Column hAlign="Center"  width="7rem">
                        <!-- <Label text="{I18n>/BASIS}" textAlign="Center" width="100%"/> -->
                        <Label text="양산일자" />
                        <t:template>
                            <Text text="{
                                path: 'listModel>massprod_start_date',
                                formatter: '.dateFormatter.toUTCDateString'
                            }" />
                        </t:template>
                    </t:Column>
                    <t:Column hAlign="Center"  width="6rem">
                        <!-- <Label text="{I18n>/BASIS}" textAlign="Center" width="100%"/> -->
                        <Label text="자재명세서" />
                        <t:template>
                            <Text text="{listModel>bom_type_text}" />
                        </t:template>
                    </t:Column>
                    <t:Column hAlign="Center"  width="6rem">
                        <!-- <Label text="{I18n>/BASIS}" textAlign="Center" width="100%"/> -->
                        <Label text="상태" />
                        <t:template>
                            <Text text="{listModel>project_status_text}" />
                        </t:template>
                    </t:Column>
                    <t:Column hAlign="Center"  width="6rem">
                        <!-- <Label text="{I18n>/BASIS}" textAlign="Center" width="100%"/> -->
                        <Label text="이벤트" />
                        <t:template>
                            <Text text="{listModel>project_develope_event_code}" />
                        </t:template>
                    </t:Column>
                    <t:Column hAlign="Center"  width="7rem">
                        <!-- <Label text="{I18n>/BASIS}" textAlign="Center" width="100%"/> -->
                        <Label text="프로젝트리더" />
                        <t:template>
                            <Text text="{listModel>project_leader_name}" />
                        </t:template>
                    </t:Column>
                    <t:Column hAlign="Center"  width="6rem">
                        <!-- <Label text="{I18n>/BASIS}" textAlign="Center" width="100%"/> -->
                        <Label text="재료비총괄" />
                        <t:template>
                            <Text text="{listModel>buyer_name}" />
                        </t:template>
                    </t:Column>

                    <t:Column headerSpan="5" hAlign="Center" width="7rem">
                        <t:multiLabels>
                            <!-- <Label text="{I18N>/FAMILY_PART_NO}" textAlign="Center" width="100%"/>
                            <Label text="{I18N>/DIV}" textAlign="Center" width="100%"/> -->
                            <Label text="재료비관리상태" />
                            <Label text="최종등록일자" />
                        </t:multiLabels>
                        <t:template>
                            <Text text="{
                                path: 'listModel>last_register_date',
                                formatter: '.dateFormatter.toUTCDateString'
                            }" />
                        </t:template>
                    </t:Column>
                    <t:Column hAlign="Center" width="5rem">
                        <t:multiLabels>
                            <!-- <Label text="{I18N>/FAMILY_PART_NO}" textAlign="Center" width="100%"/>
                            <Label text="{I18N>/DIV}" textAlign="Center" width="100%"/> -->
                            <Label text="재료비관리상태" />
                            <Label text="산출제외" />
                        </t:multiLabels>
                        <t:template>
                            <tnt:InfoLabel
                                text="{listModel>mcst_excl_flag}"
                                renderMode = "Narrow"
                                displayOnly="true"
                                colorScheme= "{= ${listModel>mcst_excl_flag} === true ? 7 : 3 }"
                                visible = "{= !${listModel>mcst_excl_flag} ? false : true }" 
                            />
                        </t:template>
                    </t:Column>
                    <t:Column hAlign="Left" width="8rem">
                        <t:multiLabels>
                            <!-- <Label text="{I18N>/FAMILY_PART_NO}" textAlign="Center" width="100%"/>
                            <Label text="{I18N>/DIV}" textAlign="Center" width="100%"/> -->
                            <Label text="재료비관리상태" textAlign="Center" width="100%" />
                            <Label text="견적" textAlign="Center" width="100%" />
                        </t:multiLabels>
                        <t:template>
                            <tnt:InfoLabel
                                text="{listModel>estimate_status_name}"
                                renderMode = "Narrow"
                                displayOnly="true"
                                colorScheme= "{
                                    path: 'listModel>estimate_status_code',
                                    formatter: '.formatStatusColor'
                                }"
                                visible = "{= !${listModel>estimate_status_code} ? false : true }" 
                            />
                        </t:template>
                    </t:Column>
                    <t:Column hAlign="Left" width="8rem">
                        <t:multiLabels>
                            <!-- <Label text="{I18N>/FAMILY_PART_NO}" textAlign="Center" width="100%"/>
                            <Label text="{I18N>/DIV}" textAlign="Center" width="100%"/> -->
                            <Label text="재료비관리상태" textAlign="Center" width="100%" />
                            <Label text="목표" textAlign="Center" width="100%" />
                        </t:multiLabels>
                        <t:template>
                            <tnt:InfoLabel
                                text="{listModel>target_status_name}"
                                renderMode = "Narrow"
                                displayOnly="true"
                                colorScheme= "{
                                    path: 'listModel>target_status_code',
                                    formatter: '.formatStatusColor'
                                }"
                                visible = "{= !${listModel>target_status_code} ? false : true }" 
                            />
                        </t:template>
                    </t:Column>
                    <t:Column hAlign="Left" width="8rem">
                        <t:multiLabels>
                            <!-- <Label text="{I18N>/FAMILY_PART_NO}" textAlign="Center" width="100%"/>
                            <Label text="{I18N>/DIV}" textAlign="Center" width="100%"/> -->
                            <Label text="재료비관리상태" textAlign="Center" width="100%" />
                            <Label text="예상" textAlign="Center" width="100%" />
                        </t:multiLabels>
                        <t:template>
                            <tnt:InfoLabel
                                text="{listModel>forecast_status_name}"
                                renderMode = "Narrow"
                                displayOnly="true"
                                colorScheme= "{
                                    path: 'listModel>forecast_status_code',
                                    formatter: '.formatStatusColor'
                                }"
                                visible = "{= !${listModel>forecast_status_code} ? false : true }" 
                            />
                        </t:template>
                    </t:Column>
                </t:columns>
                <t:rowActionTemplate>
                    <t:RowAction>
                        <t:items>
                            <t:RowActionItem type="Navigation" press=".onRowActionPress"></t:RowActionItem>
                        </t:items>
                    </t:RowAction>
                </t:rowActionTemplate>
            </t:Table>
            <!--Part No List 끝-->
        </f:content>
    </f:DynamicPage>
</mvc:View>