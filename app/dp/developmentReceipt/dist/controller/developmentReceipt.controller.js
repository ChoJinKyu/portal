sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","../model/formatter","ext/lib/model/ManagedListModel","sap/m/TablePersoController","./developmentReceiptPersoService","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","sap/m/MessageToast","sap/m/ColumnListItem","sap/m/ObjectIdentifier","sap/m/Text","sap/m/Input","sap/m/ComboBox","sap/ui/core/Item","sap/m/Token","sap/ui/core/Element"],function(e,t,i,o,s,a,n,l,r,d,c,u,h,p,g,f,m,b,_){"use strict";return e.extend("dp.developmentReceipt.controller.developmentReceipt",{formatter:o,onInit:function(){var e,i=this.getResourceBundle();e=new t({developmentReceiptTableTitle:i.getText("developmentReceiptTableTitle"),tableNoDataText:i.getText("tableNoDataText")});this.setModel(e,"developmentReceiptView");this.addHistoryEntry({title:i.getText("developmentReceiptViewTitle"),icon:"sap-icon://table-view",intent:"#Template-display"},true);this._doInitSearch();this.setModel(new s,"list")},onAfterRendering:function(){this.byId("pageSearchButton").firePress();return},onMoldMstTableUpdateFinished:function(e){var t,i=e.getSource(),o=e.getParameter("total");if(o&&i.getBinding("items").isLengthFinal()){t=this.getResourceBundle().getText("developmentReceiptTableTitleCount",[o])}else{t=this.getResourceBundle().getText("developmentReceiptTableTitle")}this.getModel("developmentReceiptView").setProperty("/developmentReceiptTableTitle",t)},onMoldMstTablePersoButtonPressed:function(e){this._oTPC.openDialog()},onMoldMstTablePersoRefresh:function(){n.resetPersData();this._oTPC.refresh()},onMoldMstTableItemPress:function(e){this._showMainObject(e.getSource())},onPageSearchButtonPress:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh();c.show("refreshButtonPressed")}else{var t=this._getSearchStates();this._applySearch(t)}},onMoldMstTableCancelButtonPress:function(){this._toEditMode()},onMoldMstTableBindButtonPress:function(){var e=this.byId("moldMstTable"),t=e.getBinding("items");var i=t.create({tenant_id:"L2100",chain_code:"CM",language_code:"",message_code:"",message_type_code:"",message_contents:"",local_create_dtm:"2020-10-13T00:00:00Z",local_update_dtm:"2020-10-13T00:00:00Z"});i.created().then(function(t){e.refresh();c.show("Success to create.")}).catch(function(e){d.error("Error while creating.")})},onMoldMstTableDeleteButtonPress:function(){var e=this.byId("moldMstTable"),t=this.getModel("list"),i=e.getSelectedItems(),o=[];i.forEach(function(e){o.push(t.getData().indexOf(e.getBindingContext("list").getObject()))});o=o.sort(function(e,t){return t-e});o.forEach(function(e){t.markRemoved(e)});e.removeSelections(true)},onMoldMstTableReceiptButtonPress:function(){var e=this.getModel("list"),t=this.getView();d.confirm("Receipt 하시 겠습니까?",{title:"Comfirmation",initialFocus:sap.m.MessageBox.Action.CANCEL,onClose:function(i){if(i===d.Action.OK){t.setBusy(true);e.submitChanges({success:function(e){t.setBusy(false);c.show("Success to Receipt.")}})}}})},onPageSaveButtonPress:function(){this.onMoldMstTableReceiptButtonPress.apply(this,arguments)},onPageCancelEditButtonPress:function(){this.onMoldMstTableDeleteButtonPress.apply(this,arguments)},onRefreshPress:function(){var e=this.byId("moldMstTable");e.getBinding("items").refresh()},_showMainObject:function(e){var t=this;e.getBindingContext().requestCanonicalPath().then(function(i){t.getRouter().navTo("mainObject",{tenantId:e.getBindingContext().getProperty("tenant_id"),messageCode:e.getBindingContext().getProperty("message_code"),languageCode:e.getBindingContext().getProperty("language_code")})})},_applySearch:function(e){var t=this.getView(),i=this.getModel("list");t.setBusy(true);i.setTransactionModel(this.getModel());i.read("/MoldMasters",{filters:e,success:function(e){t.setBusy(false)}})},_getSearchStates:function(){var e=this.byId("page").getHeaderExpanded()?"E":"S",t=this.getView().byId("searchStatus"+e).getSelectedItem(),i=_.registry.get(t).getText(),o=this.getView().byId("searchReceiptDate"+e).getDateValue(),s=this.getView().byId("searchReceiptDate"+e).getSecondDateValue(),a=this.getView().byId("searchItemType").getSelectedKey(),n=this.getView().byId("searchProductionType").getSelectedKey(),d=this.getView().byId("searchEDType").getSelectedKey(),u=this.getView().byId("searchDescription").getValue(),h=this.getView().byId("searchModel").getValue(),p=this.getView().byId("searchPartNo").getValue(),g=this.getView().byId("searchFamilyPartNo").getValue();var f=[];if(i!=="All"){f.push(new l("mold_receipt_flag",r.EQ,i=="Received"?true:false));if(i=="Received"){if(o===null){c.show("Receipt Date를 입력해 주세요")}else{var m=o.getFullYear()+""+(o.getMonth()+1)+""+o.getDate(),b=s.getFullYear()+""+(s.getMonth()+1)+""+s.getDate();f.push(new l({filters:[new l("receiving_report_date",r.LE,o),new l("receiving_report_date",r.GE,s)],and:false}))}}}if(a&&a.length>0){f.push(new l("mold_item_type_code",r.EQ,a))}if(n&&n.length>0){f.push(new l("mold_production_type_code",r.EQ,n))}if(d&&d.length>0){f.push(new l("export_domestic_type_code",r.EQ,d))}if(h&&h.length>0){f.push(this.createFilter("model",r.Contains,h))}if(p&&p.length>0){f.push(new l("part_number",r.Contains,p.toUpperCase()))}if(u&&u.length>0){f.push(new l("tolower(spec_name)",r.Contains,"'"+u.toLowerCase()+"'"))}if(g&&g.length>0){f.push(new l({filters:[new l("family_part_number_1",r.Contains,g.toUpperCase()),new l("family_part_number_2",r.Contains,g.toUpperCase()),new l("family_part_number_3",r.Contains,g.toUpperCase()),new l("family_part_number_4",r.Contains,g.toUpperCase()),new l("family_part_number_5",r.Contains,g.toUpperCase())],and:false}))}return f},createFilter:function(e,t,i){return new l("tolower("+e+")",t,"'"+i.toLowerCase()+"'")},_toEditMode:function(){var e=false;this.byId("pageSearchFormS").setEditable(e);this.byId("pageSearchButton").setEnabled(e);this.byId("moldMstTableBindButton").setEnabled(!e);this.byId("moldMstTableCancelButton").setEnabled(e);this.byId("moldMstTableDeleteButton").setEnabled(!e);this.byId("moldMstTableReceiptButton").setEnabled(!e);this._rebindTable(this.oEditableTemplate,"Edit")},_toShowMode:function(){var e=true;this._rebindTable(this.oReadOnlyTemplate,"Navigation");this.byId("pageSearchFormS").setEditable(e);this.byId("pageSearchButton").setEnabled(e);this.byId("moldMstTableBindButton").setEnabled(!e);this.byId("moldMstTableCancelButton").setEnabled(e);this.byId("moldMstTableDeleteButton").setEnabled(!e);this.byId("moldMstTableReceiptButton").setEnabled(!e)},_doInitSearch:function(){var e=this.byId("page").getHeaderExpanded()?"E":"S";this._oMultiInput=this.getView().byId("searchAffiliate"+e);this._oMultiInput.setTokens(this._getDefaultTokens());this.oColModel=new t(sap.ui.require.toUrl("dp/developmentReceipt/localService/mockdata")+"/columnsModel.json");this.oAffiliateModel=new t(sap.ui.require.toUrl("dp/developmentReceipt/localService/mockdata")+"/affiliate.json");this.setModel("affiliateModel",this.oAffiliateModel);var i=new Date;this.getView().byId("searchReceiptDate"+e).setDateValue(new Date(i.getFullYear(),i.getMonth(),i.getDate()-90));this.getView().byId("searchReceiptDate"+e).setSecondDateValue(new Date(i.getFullYear(),i.getMonth(),i.getDate()));this.getView().byId("searchReceiptDateE").setDateValue(new Date(i.getFullYear(),i.getMonth(),i.getDate()-90));this.getView().byId("searchReceiptDateE").setSecondDateValue(new Date(i.getFullYear(),i.getMonth(),i.getDate()))},_getDefaultTokens:function(){var e=new b({key:"EKHQ",text:"[LGEKR] LG Electronics Inc."});return[e]},onValueHelpRequested:function(){console.group("onValueHelpRequested");var e=this.oColModel.getData().cols;this._oValueHelpDialog=sap.ui.xmlfragment("dp.developmentReceipt.view.ValueHelpDialogAffiliate",this);this.getView().addDependent(this._oValueHelpDialog);this._oValueHelpDialog.getTableAsync().then(function(t){t.setModel(this.oAffiliateModel);t.setModel(this.oColModel,"columns");if(t.bindRows){t.bindAggregation("rows","/AffiliateCollection")}if(t.bindItems){t.bindAggregation("items","/AffiliateCollection",function(){return new u({cells:e.map(function(e){return new Label({text:"{"+e.template+"}"})})})})}this._oValueHelpDialog.update()}.bind(this));this._oValueHelpDialog.setTokens(this._oMultiInput.getTokens());this._oValueHelpDialog.open();console.groupEnd()},onValueHelpOkPress:function(e){var t=this.byId("page").getHeaderExpanded()?"E":"S",i=e.getParameter("tokens");this.searchAffiliate=this.getView().byId("searchAffiliate"+t);this.searchAffiliate.setTokens(i);this._oValueHelpDialog.close()},onValueHelpCancelPress:function(){this._oValueHelpDialog.close()},onValueHelpAfterClose:function(){this._oValueHelpDialog.destroy()},_doInitTablePerso:function(){this._oTPC=new a({table:this.byId("moldMstTable"),componentName:"developmentReceipt",persoService:n,hasGrouping:true}).activate()}})});