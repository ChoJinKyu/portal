sap.ui.define(["sap/base/Log","sap/m/MessageBox","sap/m/MessageToast","sap/ui/core/format/DateFormat","dp/developmentReceipt/controller/BaseController","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType","sap/ui/model/Sorter","sap/ui/model/json/JSONModel","sap/ui/table/RowSettings","sap/ui/thirdparty/jquery","sap/m/Token","sap/m/TablePersoController","dp/developmentReceipt/controller/Formatter","dp/developmentReceipt/controller/DemoPersoService"],function(e,t,i,o,s,n,l,a,r,u,p,h,c,d,f,g){"use strict";return s.extend("dp.developmentReceipt.controller.developmentReceipt",{onInit:function(){this._searchControlInit();var e=new u({hasGrouping:false});this.getView().setModel(e,"Grouping");this._oTPC=new d({table:this.byId("moldMstTable"),componentName:"demoApp",persoService:g}).activate();var t=this.getView();this.oSF=t.byId("searchModel")},getPage:function(){return this.byId("developmentReceiptPage")},_searchControlInit:function(){this._oMultiInput=this.getView().byId("multiInputAffiliateE");this._oMultiInput.setTokens(this._getDefaultTokens());this._oMultiInput1=this.getView().byId("multiInputAffiliateS");this._oMultiInput1.setTokens(this._getDefaultTokens());this.oColModel=new u(sap.ui.require.toUrl("dp/developmentReceipt/localService/mockdata")+"/columnsModel.json");this.oAffiliateModel=new u(sap.ui.require.toUrl("dp/developmentReceipt/localService/mockdata")+"/affiliate.json");this.setModel("affiliateModel",this.oAffiliateModel)},_getDefaultTokens:function(){var e=new c({key:"EKHQ",text:"LG Electronics Inc"});return[e]},onValueHelpRequested:function(){console.group("onValueHelpRequested");var e=this.oColModel.getData().cols;this._oValueHelpDialog=sap.ui.xmlfragment("dp.developmentReceipt.view.ValueHelpDialogAffiliate",this);this.getView().addDependent(this._oValueHelpDialog);this._oValueHelpDialog.getTableAsync().then(function(t){t.setModel(this.oAffiliateModel);t.setModel(this.oColModel,"columns");if(t.bindRows){t.bindAggregation("rows","/AffiliateCollection")}if(t.bindItems){t.bindAggregation("items","/AffiliateCollection",function(){return new ColumnListItem({cells:e.map(function(e){return new Label({text:"{"+e.template+"}"})})})})}this._oValueHelpDialog.update()}.bind(this));this._oValueHelpDialog.setTokens(this._oMultiInput.getTokens());this._oValueHelpDialog.open();console.groupEnd()},onValueHelpOkPress:function(e){var t=e.getParameter("tokens");this.multiInputAffiliate=this.getView().byId("multiInputAffiliateE");this.multiInputAffiliate.setTokens(t);this._oValueHelpDialog.close()},onValueHelpCancelPress:function(){this._oValueHelpDialog.close()},onValueHelpAfterClose:function(){this._oValueHelpDialog.destroy()},onModelSearch:function(e){var t=e.getParameter("suggestionItem");if(t){i.show("Search for: "+t.getText())}else{i.show("Search is fired!")}},onModelSuggest:function(e){var t=e.getParameter("suggestValue"),i=[];if(t){i=[new n([new n("tenent_id",function(e){return(e||"").toUpperCase().indexOf(t.toUpperCase())>-1}),new n("model",function(e){return(e||"").toUpperCase().indexOf(t.toUpperCase())>-1})],false)]}this.oSF.getBinding("suggestionItems").filter(i);this.oSF.suggest()},onSearch:function(){var e=[];var t="";var o=this.getView().byId("searchDescription").getValue();var s=this.getView().byId("searchFamilyPartNo").getValue();if(this.byId("searchEDType").getSelectedItem()){t=this.byId("searchEDType").getSelectedItem().getKey()}i.show(t);if(!this.isValNull(t)){e.push(new n("export_domestic_type_code",l.Contains,t))}if(!this.isValNull(o)){e.push(new n("spec_name",l.Contains,o))}if(!this.isValNull(s)){e.push(new n("family_part_number_1",l.Contains,s))}var a=this.byId("moldMstTable").getBinding("items");this.getView().setBusy(true);a.filter(e);this.getView().setBusy(false)},handleAttachmentPress:function(){i.show("Over budget!")},onPersoButtonPressed:function(e){this._oTPC.openDialog()},onTablePersoRefresh:function(){g.resetPersData();this._oTPC.refresh()},onTableGrouping:function(e){this._oTPC.setHasGrouping(e.getSource().getSelected())},onBindReceipt:function(){i.show("Over budget!")},onCancelBind:function(){i.show("Over budget!")},onDelete:function(){var e=this.byId("moldMstTable").getSelectedContexts();if(e.length>0){for(var o=0;o<e.length;o++){var s=this.getView();s.setBusy(true);e[o].delete("$auto").then(function(){s.setBusy(false);i.show("삭제 되었습니다.");this.onSearch()}.bind(this),function(e){s.setBusy(false);t.error(e.message)})}}else{t.error("선택된 행이 없습니다.")}},onReceipt:function(){var e=this.byId("moldMstTable").getBinding("items");if(!e.hasPendingChanges()){t.error("수정한 내용이 없습니다.");return}var o=this.getView();var s=function(){o.setBusy(false);i.show("Receipt 되었습니다.");this.onRefresh()}.bind(this);var n=function(e){o.setBusy(false);t.error(e.message)}.bind(this);t.confirm("Receipt 하시 겠습니까?",{title:"Comfirmation",initialFocus:sap.m.MessageBox.Action.CANCEL,onClose:function(e){if(e===t.Action.OK){o.setBusy(true);o.getModel().submitBatch("moldMstUpdateGroup").then(s,n)}else if(e===t.Action.CANCEL){}}})},onRefresh:function(){var e=this.byId("moldMstTable").getBinding("items");this.getView().setBusy(true);e.refresh();this.getView().setBusy(false)},onFamilyFlagChange:function(e){var t=e.getSource(),o=t.getSelectedKey(),s=t.getValue();if(o=="Y"){i.show("Y")}else{i.show("N")}}})});