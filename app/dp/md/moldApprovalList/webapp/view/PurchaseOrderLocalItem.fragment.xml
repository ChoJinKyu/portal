<core:FragmentDefinition 
    xmlns="sap.m" 
    xmlns:uxap="sap.uxap" 
    xmlns:form="sap.ui.layout.form" 
    xmlns:core="sap.ui.core" 
    xmlns:layout="sap.ui.layout" 
    xmlns:tnt="sap.tnt" 
    xmlns:co="sap.suite.ui.commons" 
    xmlns:si="sap.suite.ui.commons.statusindicator" 
    xmlns:u="sap.ui.unified" 
    xmlns:table="sap.ui.table">
	<VBox class="sapUiSmallMargin">
		<form:SimpleForm editable="true" layout="ResponsiveGridLayout" adjustLabelSpan="false" labelSpanL="4" labelSpanM="4" emptySpanL="0" emptySpanM="0" columnsL="2" columnsM="2">
			<form:content>
                <HBox>
                    <VBox class="sapUiSmallMargin">
                        <Label text="{I18N>/COMPANY}"/>
                        <ObjectStatus text="[{company>/company_code}] {company>/company_name}" state="Error"/>
                    </VBox>
                    <VBox class="sapUiSmallMargin">
                        <Label text="{I18N>/PLANT}"/>
                        <ObjectStatus text="[{plant>/plant_code}] {plant>/org_name}" state="Error"/>
                    </VBox>
                </HBox>
            </form:content>
        </form:SimpleForm>
        <form:SimpleForm editable="true" layout="ResponsiveGridLayout" adjustLabelSpan="false" labelSpanL="4" labelSpanM="4" emptySpanL="0" emptySpanM="0" columnsL="2" columnsM="2">
            <form:content>
				<!-- Purchase Order Item Table -->
				<table:Table id="poItemTable"
                    selectionMode="{=${mode>/editFlag}?'MultiToggle':'None'}"
                    visibleRowCountMode="Auto"
                    rows="{purOrderItem>/PurchaseOrderItems}"
                    cellClick=".onCellClick"
                    >
                    <table:extension>
                        <OverflowToolbar>
                            <Title text="Total PO Amount : {path: 'amount>/purchasing_amount', formatter: '.numberFormatter.toNumberString'} [{amount>/currency_code}]" level="H2"/>
                            
                            <ToolbarSpacer/>
                            <Button id="btnPoItemAdd"    type="Transparent" text="{I18N>/ROW_ADD}" press=".onPoItemAddRow" visible="{mode>/editFlag}">
                                <customData>
                                    <core:CustomData key="multi" value="true" />
                                </customData>
                            </Button>
                            <Button id="btnPoItemDelete" type="Transparent" text="{I18N>/ROW_DELETE}"  press=".onPoItemDelRow" visible="{mode>/editFlag}"/>
                        </OverflowToolbar>
                    </table:extension>                             
                    <table:columns>
                        <table:Column id="moldModelColumn" width="12em" hAlign="Center">
                            <Label text="Model"/>
                            <table:template>
                                <Text id="model" text="{purOrderItem>model}"/>
                            </table:template>
                        </table:Column>
                        <table:Column id="moldPartNoColumn" width="12em" hAlign="Center">
                            <Label text="Mold No"/>
                            <table:template>
                                <Text id="mold_number" text="{purOrderItem>mold_number}"/>
                            </table:template>
                        </table:Column>
                        <table:Column id="moldSeqColumn" width="3em" hAlign="Center">
                            <Label text="Seq"/>
                            <table:template>
                                <Text id="mold_sequence" text="{purOrderItem>mold_sequence}" textAlign="Center"/>
                            </table:template>
                        </table:Column>
                        <table:Column id="moldDescriptionColumn" width="12em" hAlign="Center">
                            <Label text="Description"/>
                            <table:template>
                                <Text id="spec_name" text="{purOrderItem>spec_name}"/>
                            </table:template>
                        </table:Column>
                        <table:Column id="moldItemTypeColumn" width="8em" hAlign="Center">
                            <VBox>
                            <Label text="Mold Item"/>
                            <Label text="Type"/>
                            </VBox>
                            <table:template>
                                <ComboBox   selectedKey="{purOrderItem>mold_item_type_code}"
                                    items="{
                                                path : 'util>/Code',
                                                filters : [
                                                    {path : 'tenant_id', operator : 'EQ', value1 : 'L2600'},
                                                    {path : 'group_code', operator : 'EQ', value1 : 'DP_MD_ITEM_TYPE'}
                                                ]
                                            }"
                                    editable="false"  >
                                    <core:Item key="{util>code}" text="{util>code_name}" />
                                </ComboBox>
                            </table:template>
                        </table:Column>
                        <table:Column id="bookCrrencyColumn" width="6em" hAlign="Center">
                            <VBox>
                            <Label text="Book"/>
                            <Label text="Currency"/>
                            </VBox>
                            <table:template>
                                <Text id="bookCurrency" text="{purOrderItem>book_currency_code}" textAlign="Center"/>
                            </table:template>
                        </table:Column>
                        <table:Column id="budetAmountColumn" width="7em" hAlign="Center">
                            <VBox>
                            <Label text="Budget"/>
                            <Label text="Amount"/>
                            </VBox>
                            <table:template>
                                <Text id="budetAmount" text="{path: 'purOrderItem>provisional_budget_amount', formatter: '.numberFormatter.toNumberString'}" textAlign="Right" />
                            </table:template>
                        </table:Column>
                        <table:Column id="crrencyColumn" width="6em" hAlign="Center">
                            <Label text="Currency"/>           
                            <table:template>
                                <Text id="currency" text="{purOrderItem>currency_code}" textAlign="Center"/>
                            </table:template>
                        </table:Column>
                        <table:Column id="poAmountColumn" width="7em" hAlign="Center">
                            <VBox>
                            <Label text="PO"/>
                            <Label text="Amount"/>
                            </VBox>
                            <table:template>
                                <Text id="poAmount" text="{path: 'purOrderItem>purchasing_amount', formatter: '.numberFormatter.toNumberString'}" textAlign="Right" />
                            </table:template>
                        </table:Column>
                        <table:Column id="orderSupplierColumn" width="10em" hAlign="Center">
                            <VBox>
                            <Label text="Order"/>
                            <Label text="Supplier"/>
                            </VBox>
                            <table:template>
                                <Text id="orderSupplier" text="{purOrderItem>supplier_code}" textAlign="Center"/>
                            </table:template>
                        </table:Column>
                        <table:Column id="targetAmountColumn" width="7em" hAlign="Center">
                            <VBox>
                            <Label text="Target"/>
                            <Label text="Amount"/>
                            </VBox>
                            <table:template>
                                <Text id="targetAmount" text="{path: 'purOrderItem>target_amount', formatter: '.numberFormatter.toNumberString'}" textAlign="Right" />
                            </table:template>
                        </table:Column>
                        <table:Column id="moldProductionTypeColumn" width="12em" hAlign="Center">
                            <VBox>
                            <Label text="Production"/>
                            <Label text="Type"/>
                            </VBox>
                            <table:template>
                                <ComboBox   selectedKey="{purOrderItem>mold_production_type_code}"
                                    items="{
                                                path : 'util>/Code',
                                                filters : [
                                                    {path : 'tenant_id', operator : 'EQ', value1 : 'L2600'},
                                                    {path : 'group_code', operator : 'EQ', value1 : 'DP_MD_PROD_TYPE'}
                                                ]
                                            }"
                                    editable="false"  >
                                    <core:Item key="{util>code}" text="{util>code_name}" />
                                </ComboBox>
                            </table:template>
                        </table:Column>
                        <table:Column id="moldFamilyPartNoColumn" width="12em" hAlign="Center">
                            <VBox>
                            <Label text="Family"/>
                            <Label text="Part No"/>
                            </VBox>
                            <table:template>
                                <Text id="family_part_number_1" text="{purOrderItem>family_part_number_1}" />
                            </table:template>
                        </table:Column>
                        <table:Column width="12em" hAlign="Center" visible="false">
                            <Label text="Partial Payment"/>
                            <table:template>
                                <Text id="split_pay_type_code" text="{purOrderItem>split_pay_type_code}" />
                            </table:template>
                        </table:Column>
                        <table:Column width="12em" hAlign="Center" visible="false">
                            <Label text="Account Code"/>
                            <table:template>
                                <Text id="account_code" text="{purOrderItem>account_code}" />
                            </table:template>
                        </table:Column>
                    </table:columns>
                </table:Table>
			</form:content>
		</form:SimpleForm>
        <form:SimpleForm editable="true" layout="ResponsiveGridLayout" adjustLabelSpan="false" labelSpanL="4" labelSpanM="4" emptySpanL="0" emptySpanM="0" columnsL="2" columnsM="2">
			<form:content>
                <!-- Payment Table -->
                <Table id="paymentTable"
                        sticky="HeaderToolbar,ColumnHeaders" 
                        class="sapFDynamicPageAlignContent" 
                        inset="false"
                        mode="MultiSelect" 
                        width="auto"
                        items="{payment>/Payments}" 
                        >
                    <headerToolbar>
                        <OverflowToolbar>
                            <ToolbarSpacer/>
                            <Button id="btnPaymentAdd"    type="Transparent" text="{I18N>/ROW_ADD}" press=".onPaymentAddRow" visible="{mode>/editFlag}">
                                <customData>
                                    <core:CustomData key="multi" value="true" />
                                </customData>
                            </Button>
                            <Button id="btnPaymentDelete" type="Transparent" text="{I18N>/ROW_DELETE}"  press=".onPaymentDelRow" visible="{mode>/editFlag}"/>
                        </OverflowToolbar>
                    </headerToolbar>
                    <columns>
                        <Column minScreenWidth="Tablet" hAlign="Center"  width="3.5em" >
                            <Text text="{I18N>/SEQUENCE}" />
                        </Column>
                        <Column minScreenWidth="Tablet" hAlign="Center" width="10em" >
                            <Text text="{I18N>/TYPE}" />
                        </Column>
                        <Column minScreenWidth="Tablet" hAlign="Center" width="12em" >
                            <Text text="비율" />
                        </Column>
                        <Column minScreenWidth="Tablet" hAlign="Center" width="12em" >
                            <Text text="금액" />
                        </Column>
                    </columns>
                    <items>
                        <ColumnListItem type="Active" press=".onItemApprovalPress">
                            <cells>
                                <Text text="{payment>pay_sequence}" />
                                <Select width="100%"
                                    selectedKey="{payment>split_pay_type_code}" 
                                    items="{ path : 'util>/Code',
                                                filters : [
                                                    {path : 'tenant_id', operator : 'EQ', value1 : 'L2600'},
                                                    {path : 'group_code', operator : 'EQ', value1 : 'DP_MD_SPLIT_PAY_TYPE'}
                                                ],
                                                sorter: { path: 'sort_no'} 
                                            }"
                                    editable="{= ${payment>pay_sequence} === 1 || ${payment>pay_sequence} === '1' ? true : false}"
                                    change="splitPayTypeChange" >  
                                    <core:Item key="{util>code}" text="{util>code_name}" />
                                </Select>
                                <Input value="{payment>pay_rate}" editable="{= ${payment>split_pay_type_code} === 'R' ? true : false}" />
                                <Input value="{payment>pay_price}" editable="{= ${payment>split_pay_type_code} === 'A' ? true : false}" />
                            </cells>
                        </ColumnListItem>
                    </items>
                </Table>
            </form:content>
		</form:SimpleForm>
	</VBox>
</core:FragmentDefinition>
