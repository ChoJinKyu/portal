<mvc:View controllerName="sp.se.evaluationItemMngt.controller.Detail" 
	xmlns:mvc="sap.ui.core.mvc" 
	xmlns="sap.m" 
	xmlns:uxap="sap.uxap" 
	xmlns:layout="sap.ui.layout" 
    xmlns:form="sap.ui.layout.form"
	xmlns:core="sap.ui.core"
    xmlns:suiteCom="sap.suite.ui.commons"
	height="100%">

	<uxap:ObjectPageLayout id="page"
		toggleHeaderOnTitleClick="true"
		alwaysShowContentHeader = "true"
		preserveHeaderStateOnScroll="false"
		headerContentPinnable="true"
		isChildPage="true"
		upperCaseAnchorBar="false"
		showTitleInHeaderContent="false"
		showEditHeaderButton="true" 
		showFooter="true">
        
		<uxap:headerTitle>
            <!-- 상세 -->
			<uxap:ObjectPageHeader objectTitle="{I18N>/DETAIL}">
                <uxap:actions>
                    <OverflowToolbarButton type="Transparent" icon="{viewModel>/App/btnScreen}" text="screen" tooltip="screen change" press="onPressLayoutChange" />
                    <OverflowToolbarButton type="Transparent" icon="sap-icon://decline" text="back" tooltip="back to the list" press="onPressPageNavBack" />
                </uxap:actions> 
			</uxap:ObjectPageHeader>
		</uxap:headerTitle>

		<uxap:headerContent>
		</uxap:headerContent>

		<uxap:sections>
            <!-- 일반정보 -->
			<uxap:ObjectPageSection titleUppercase="false" title="{I18N>/EVAL_ITEM}" visible="{=${viewModel>/Args/new} === 'Y'}">
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
                        <form:SimpleForm 
                            layout="ResponsiveGridLayout"
                        >
                            <VBox>
                                <!-- 평가항목 명 -->
                                <Label text="{I18N>/EVAL_ITEM_NM}" required="true"/>
                                <Input 
                                    required="true"
                                    fieldGroupIds="newRequired"
                                    value="{
                                        path : 'viewModel>/Detail/NewHeader/evaluation_article_name',
                                        type : 'sap.ui.model.odata.type.String',
                                        constraints : {
                                            maxLength : 240
                                        }
                                    }"
                                />
                                <layoutData>
                                    <layout:GridData span="L12 M12 S12" />
                                </layoutData>
                            </VBox>
                            <VBox>
                                <!-- Node 유형 -->
                                <Label text="{I18N>/NODE_TYPE}" required="true"/>
                                <ComboBox 
                                    id="comboNodeType"
                                    required="true"
                                    fieldGroupIds="newRequired"
                                    width="100%" 
                                    showSecondaryValues="true"
                                    selectedKey="{viewModel>/Detail/NewHeader/evaluation_article_lvl_attr_cd}"
                                />
                                <layoutData>
                                    <layout:GridData span="L12 M12 S12" />
                                </layoutData>
                            </VBox>
                        </form:SimpleForm>
					</uxap:ObjectPageSubSection>
				</uxap:subSections>
			</uxap:ObjectPageSection>

            <uxap:ObjectPageSection titleUppercase="false" title="{I18N>/GENERAL_INFO}" visible="{=${viewModel>/Args/new} !== 'Y'}">
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
                        <form:SimpleForm 
                            layout="ResponsiveGridLayout"
                        >
                            <VBox>
                                <!-- 평가 항목 그룹 -->
                                <Label text="{I18N>/EVAL_ITEM_GRP}"/>
                                <Text text="{viewModel>/Detail/Header/higher_level_path_name}"/>
                                <layoutData>
                                    <layout:GridData span="L6 M6 S12" />
                                </layoutData>
                            </VBox>
                            <VBox>
                                <!-- 평가운영단위 -->
                                <Label text="{I18N>/EVAL_OP_UNT}"/>
                                <Text text="{viewModel>/Detail/Header/evaluation_operation_unit_name}"/>
                                <layoutData>
                                    <layout:GridData span="L6 M6 S12" />
                                </layoutData>
                            </VBox>
                            <VBox>
                                <!-- 평가 항목 -->
                                <Label text="{I18N>/EVAL_ITEM}"/>
                                <Text text="{viewModel>/Detail/Header/evaluation_article_name}"/>
                                <layoutData>
                                    <layout:GridData span="L6 M6 S12" linebreak="true"/>
                                </layoutData>
                            </VBox>
                            <VBox visible="{=${viewModel>/Args/leaf} === 'Y'}">
                                <!-- 평가수행방식 -->
                                <Label text="{I18N>/EVAL_EXEC_MODE}"/>
                                <SegmentedButton 
                                    id="btnEvaluExeMode"
                                    selectedKey="{viewModel>/Detail/Header/evaluation_execute_mode_code}"
                                    enabled="{viewModel>/App/EditMode}"
                                    selectionChange="onSelectChangExecMode"
                                />
                                <layoutData>
                                    <layout:GridData span="L3 M3 S6" />
                                </layoutData>
                            </VBox>
                            <VBox visible="{=${viewModel>/Args/leaf} === 'Y'}">
                                <!-- 평가항목구분 -->
                                <Label text="{I18N>/EVAL_ITEM_TYPE}"/>
                                <SegmentedButton 
                                    id="btnEvaluArtType"
                                    selectedKey="{viewModel>/Detail/Header/evaluation_article_type_code}"
                                    enabled="{viewModel>/App/EditMode}"
                                />
                                <layoutData>
                                    <layout:GridData span="L3 M3 S6" />
                                </layoutData>
                            </VBox>
                            <VBox visible="{=${viewModel>/Args/leaf} === 'Y'}">
                                <!-- 배점유형 -->
                                <Label text="{I18N>/DISTRB_SCOR_TYPE}"/>
                                <ComboBox 
                                    id="comboEvaluDisScrType"
                                    width="100%"
                                    selectedKey="{viewModel>/Detail/Header/evaluation_distrb_scr_type_cd}"
                                    editable="{viewModel>/App/EditMode}"
                                />
                                <layoutData>
                                    <layout:GridData span="L6 M6 S12" />
                                </layoutData>
                            </VBox>
                            <VBox visible="{=${viewModel>/Args/leaf} === 'Y'}">
                                <!-- Scale 유형 -->
                                <Label text="{I18N>/SCLE_TYPE}"/>
                                <ComboBox  
                                    id="comboEvaluResultInputType"
                                    width="100%"
                                    selectedKey="{viewModel>/Detail/Header/evaluation_result_input_type_cd}"
                                    editable="{viewModel>/App/EditMode}"
                                />
                                <layoutData>
                                    <layout:GridData span="L6 M6 S12" />
                                </layoutData>
                            </VBox>
                            <VBox visible="{=${viewModel>/Args/leaf} === 'Y'}">
                                <!-- 단위 -->
                                <Label text="{I18N>/UNIT}"/>
                                <ComboBox 
                                    id="comboQttItemUom"
                                    width="100%"
                                    selectedKey="{viewModel>/Detail/Header/qttive_item_uom_code}"
                                    editable="{=
                                        ${viewModel>/App/EditMode} &amp;&amp;
                                        ${viewModel>/Detail/Header/evaluation_execute_mode_code} === 'QTTVE_EVAL'
                                    }"
                                />
                                <layoutData>
                                    <layout:GridData span="L6 M6 S12" />
                                </layoutData>
                            </VBox>
                            <VBox visible="{=${viewModel>/Args/leaf} === 'Y'}">
                                <!-- 정렬 -->
                                <Label text="{I18N>/SORT}" required="true"/>
                                <Input 
                                    required="true"
                                    fieldGroupIds="detailRequired"
                                    value="{
                                        path : 'viewModel>/Detail/Header/sort_sequence',
                                        type : 'sap.ui.model.odata.type.Decimal',
                                        constraints : {
                                            scale : 0
                                        }
                                    }"
                                    editable="{viewModel>/App/EditMode}"
                                />
                                <layoutData>
                                    <layout:GridData span="L6 M6 S12" />
                                </layoutData>
                            </VBox>
                            <VBox visible="{=${viewModel>/Args/leaf} === 'Y'}">
                                <!-- 정량항목산식 -->
                                <suiteCom:CalculationBuilder
                                    id="calculationBuilder"
                                    allowStringLiterals="true"
                                    layoutType="VisualOnly"
                                    allowComparisonOperators="true"
                                    allowLogicalOperators="true"
                                    expression="{viewModel>/Detail/Header/qttive_eval_article_calc_formula}"
                                    title="{I18N>/QTTIVE_ITEM_CALC}"
                                    readOnly="{=
                                        !${viewModel>/App/EditMode} ||
                                        ${viewModel>/Detail/Header/evaluation_execute_mode_code} !== 'QTTVE_EVAL'
                                    }"
                                > 
                                </suiteCom:CalculationBuilder>
                                <layoutData>
                                    <layout:GridData span="L12 M12 S12" linebreak="true"/>
                                </layoutData>
                            </VBox>
                            <VBox visible="{=${viewModel>/Args/leaf} === 'Y'}">
                                <!-- 평가항목설명 -->
                                <Label text="{I18N>/EVAL_ITEM_DESC}"/>
                                <TextArea 
                                    value="{
                                        path : 'viewModel>/Detail/Header/evaluation_article_desc',
                                        type : 'sap.ui.model.odata.type.String',
                                        constraints : {
                                            maxLength : 3000
                                        }
                                    }"
                                    width="100%"
                                    rows="5"
                                    editable="{viewModel>/App/EditMode}"
                                />
                                <layoutData>
                                    <layout:GridData span="L12 M12 S12" />
                                </layoutData>
                            </VBox>
                            
                        </form:SimpleForm>
					</uxap:ObjectPageSubSection>
				</uxap:subSections>
			</uxap:ObjectPageSection>

            
            <uxap:ObjectPageSection 
                titleUppercase="false" 
                title="{I18N>/SCLE}" 
                visible="{=
                    ${viewModel>/Args/new} !== 'Y' &amp;&amp;
                    ${viewModel>/Args/leaf} === 'Y' &amp;&amp;
                    !(
                        ${viewModel>/Detail/Header/evaluation_result_input_type_cd} === 'NSCLE' || 
                        !${viewModel>/Detail/Header/evaluation_result_input_type_cd}
                    )
                }"
            >
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
                        <Table
                            id="tblEvalItemScle"
                            items="{viewModel>/Detail/Item}"
                            mode="{=
                                ${viewModel>/App/EditMode} ? 'SingleSelectLeft' : 'None'
                            }"
                        >
                            <!-- selectionChange="onSelectTableItem" -->
                            <headerToolbar>
                                <Toolbar>
                                    <ToolbarSpacer />
                                    <Button 
                                        text="{I18N>/ADDITION}" 
                                        press="onPressItemAdd"
                                        enabled="{viewModel>/App/EditMode}"
                                    />
                                    <Button 
                                        text="{I18N>/DELETE}" 
                                        press="onPressItemDelete"
                                        enabled="{viewModel>/App/EditMode}"
                                    />
                                    <Button 
                                        text="{I18N>/CANCEL}" 
                                        press="onPressItemCancle"
                                        enabled="{viewModel>/App/EditMode}"
                                    />
                                </Toolbar>
                            </headerToolbar>
                            <columns>
                                <Column width="3em">
                                    <core:Icon src="sap-icon://edit"/>
                                    <!-- sap-icon://delete -->
                                </Column>
                                <Column
                                    visible="{=
                                        ${viewModel>/Detail/Header/evaluation_result_input_type_cd} !== 'NSCLE'
                                    }"
                                >
                                    <!-- Scale -->
                                    <Label text="{I18N>/SCLE}" />
                                </Column>
                                <Column
                                    visible="{=
                                        ${viewModel>/Detail/Header/evaluation_result_input_type_cd} === 'RANGE'
                                    }"
                                >
                                    <!-- Min(이상) -->
                                    <Label text="{I18N>/MIN_OVER}" />
                                </Column>
                                <Column
                                    visible="{=
                                        ${viewModel>/Detail/Header/evaluation_result_input_type_cd} === 'RANGE'
                                    }"
                                >
                                    <!-- Max(미만) -->
                                    <Label text="{I18N>/MAX_UNDER}" />
                                </Column>
                                <Column
                                    visible="{=
                                        ${viewModel>/Detail/Header/evaluation_result_input_type_cd} !== 'NSCLE'
                                    }"
                                >
                                    <!-- 배점 -->
                                    <Label text="{I18N>/DISTRB_SCOR}" />
                                </Column>
                                <Column
                                    visible="{=
                                        ${viewModel>/Detail/Header/evaluation_result_input_type_cd} !== 'NSCLE'
                                    }"
                                >
                                    <!-- 정렬 -->
                                    <Label text="{I18N>/SORT}" required="true"/>
                                </Column>
                            </columns>
                            <items>
                                <ColumnListItem>
                                    <cells>
                                        <!-- 
                                            sap-icon://edit
                                            sap-icon://delete
                                         -->
                                        <core:Icon 
                                            src="{=
                                                ${viewModel>crudFlg} === 'D' ? 
                                                    'sap-icon://delete' : 
                                                    (${viewModel>crudFlg} === 'C' ? 'sap-icon://add' : 'sap-icon://edit')
                                            }"
                                            visible="{=
                                                !!${viewModel>crudFlg}
                                            }"
                                        />
                                        <!-- <Button icon="sap-icon://edit" /> -->
                                        <Input 
                                            value="{
                                                path : 'viewModel>option_article_name',
                                                type : 'sap.ui.model.odata.type.String',
                                                constraints : {
                                                    maxLength : 240
                                                }
                                            }" 
                                            fieldGroupIds="detailRequired"
                                            editable="{=
                                                ${viewModel>/App/EditMode}
                                            }"
                                            change="onChangeEdit"
                                        />
                                        <Input 
                                            value="{
                                                path : 'viewModel>option_article_start_value',
                                                type : 'sap.ui.model.odata.type.String',
                                                constraints : {
                                                    maxLength : 100
                                                }
                                            }" 
                                            fieldGroupIds="detailRequired"
                                            editable="{=
                                                ${viewModel>/App/EditMode}
                                            }"
                                            change="onChangeEdit"
                                        />
                                        <Input 
                                            value="{
                                                path : 'viewModel>option_article_end_value',
                                                type : 'sap.ui.model.odata.type.String',
                                                constraints : {
                                                    maxLength : 100
                                                }
                                            }"
                                            fieldGroupIds="detailRequired"
                                            editable="{=
                                                ${viewModel>/App/EditMode}
                                            }"
                                            change="onChangeEdit"
                                        />
                                        <Input 
                                            value="{
                                                path : 'viewModel>evaluation_score',
                                                type : 'sap.ui.model.odata.type.Decimal',
                                                constraints : {
                                                    scale : 0
                                                }
                                            }" 
                                            fieldGroupIds="detailRequired"
                                            editable="{=
                                                ${viewModel>/App/EditMode}
                                            }"
                                            change="onChangeEdit"
                                        />
                                        <Input 
                                            required="true"
                                            fieldGroupIds="detailRequired"
                                            value="{
                                                path : 'viewModel>sort_sequence',
                                                type : 'sap.ui.model.odata.type.Decimal',
                                                constraints : {
                                                    scale : 0
                                                }
                                            }" 
                                            editable="{=
                                                ${viewModel>/App/EditMode}
                                            }"
                                            change="onChangeEdit"
                                        />
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
					</uxap:ObjectPageSubSection>
				</uxap:subSections>
			</uxap:ObjectPageSection>

		</uxap:sections>

		<uxap:footer>
			<OverflowToolbar>
                <ToolbarSpacer />
                <Button 
                    text="{I18N>/UPDATE}" 
                    enabled="{=
                        !${viewModel>/App/EditMode} &amp;&amp;
                        ${viewModel>/Args/leaf} === 'Y'
                    }"
                    type="Transparent" 
                    press="onPressModeChange($event, 'UPDATE')" 
                />
				<Button 
                    text="{I18N>/CANCEL}" 
                    enabled="{viewModel>/App/EditMode}"
                    type="Transparent" 
                    press="onPressModeChange($event, 'CANCEL')" 
                />
				<Button 
                    text="{I18N>/DELETE}" 
                    enabled="{=
                        !${viewModel>/App/EditMode} &amp;&amp;
                        ${viewModel>/Args/new} !== 'Y' &amp;&amp;
                        ${viewModel>/Detail/Header/hierarchy_tree_size} === '1'
                    }"
                    type="Transparent" 
                    press="onPressDelete" 
                />
                <Button 
                    text="{I18N>/SAVE}" 
                    enabled="{=
                        ${viewModel>/App/EditMode} ||
                        ${viewModel>/Args/new} === 'Y'
                    }"
                    type="Emphasized" 
                    press="onPressSave" 
                />
			</OverflowToolbar>
		</uxap:footer>
        
	</uxap:ObjectPageLayout>
</mvc:View>