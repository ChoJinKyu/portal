<mvc:View controllerName="sp.vi.basePriceMgt.controller.InternalPriceDetail" 
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:uxap="sap.uxap"
    xmlns="sap.m"
    xmlns:f="sap.f"
    xmlns:form="sap.ui.layout.form"
    xmlns:layout="sap.ui.layout"
    xmlns:core="sap.ui.core"
    xmlns:lib-m="ext.lib.m"
    xmlns:lib-cm="ext.lib.control.m"
    xmlns:t="sap.ui.table"
    xmlns:tnt="sap.tnt"     
    xmlns:co="sap.suite.ui.commons"
    xmlns:rte="sap.ui.richtexteditor"
    xmlns:u="sap.ui.unified"
    height="100%">
 
    <uxap:ObjectPageLayout
        id= "ObjectPageLayout"
        showTitleInHeaderContent="true"
		showEditHeaderButton="true"
        upperCaseAnchorBar="false"
        headerContentPinnable="false"
        showAnchorBarPopover="false"
        showFooter="true">

		<uxap:headerTitle>
			<uxap:ObjectPageDynamicHeaderTitle>
				<uxap:expandedHeading>
                    <HBox alignItems="End">
                        <OverflowToolbarButton type="Transparent" icon="sap-icon://nav-back" press=".onBack" />
                        <Title text="{I18N>/NEW_BASE_PRICE}({I18N>/INTERNAL_TRADING})" wrapping="true"/>
                    </HBox>
				</uxap:expandedHeading>
                <uxap:navigationActions>
                </uxap:navigationActions>
                <uxap:snappedHeading>
					<HBox alignItems="End">
                        <OverflowToolbarButton type="Transparent" icon="sap-icon://nav-back" press=".onBack" />
                        <Title text="{I18N>/NEW_BASE_PRICE}({I18N>/INTERNAL_TRADING})" wrapping="true"/>
                    </HBox>
				</uxap:snappedHeading>
			</uxap:ObjectPageDynamicHeaderTitle>
		</uxap:headerTitle>

		<uxap:headerContent>
			<FlexBox wrap="Wrap">
                <!-- base Info 시작 -->
                <layout:VerticalLayout class="sapUiLargeMarginBeginEnd">
                    <ObjectStatus title="{I18N>/APPROVAL_NO}" text="{detailModel>/approval_number}"/>
                    <ObjectStatus title="{I18N>/REQUESTOR}" text="{detailModel>/requestor_local_nm}"/> 
                    <ObjectStatus title="{I18N>/REQUEST_DATE}" text="{path:'detailModel>/local_update_dtm', formatter: '.dateFormatter.toDateString'}"/>                        
                    <ObjectStatus title="{I18N>/BUSINESS_UNIT}" text="{= ${detailModel>/results/0/bizunit_name} === null ? ${detailModel>/results/0/bizunit_name} : ${detailModel>/bizunit_name}  }"/>
                </layout:VerticalLayout>
                <!-- base Info 끝 -->

                <!-- Status 시작 -->
				<layout:VerticalLayout class="sapUiLargeMarginBeginEnd">
					<Label text="{I18N>/STATUS} :"/>
                    <ObjectStatus class="sapMObjectStatusLarge" text="{path:'rootModel>/selectedData/approve_status_code', formatter: '.onSetStatusText'}" state="Error" />
				</layout:VerticalLayout>
                <!-- Status 끝 -->

                <!-- Process 시작 -->
                <layout:VerticalLayout class="sapUiLargeMarginBeginEnd">
					<Label text="Process : "/>
                    <HBox>
                        <co:MicroProcessFlow>
                            <co:content>   
                                <co:MicroProcessFlowItem state="{= ${rootModel>/selectedData/approve_status_code} === 'DR' ? 'Error' : 'None'}" stepWidth="5rem" icon="sap-icon://circle-task" />
                                <co:MicroProcessFlowItem state="{= ${rootModel>/selectedData/approve_status_code} === 'AR' ? 'Error' : 'None'}" stepWidth="5rem" icon="sap-icon://circle-task" />
                                <co:MicroProcessFlowItem state="{= ${rootModel>/selectedData/approve_status_code} === 'IA' ? 'Error' : 'None'}" stepWidth="5rem" icon="sap-icon://circle-task" />
                                <co:MicroProcessFlowItem state="{= ${rootModel>/selectedData/approve_status_code} === 'AP' ? 'Error' : 'None'}" stepWidth="5rem" icon="sap-icon://circle-task" />
                            </co:content>
                        </co:MicroProcessFlow>
                    </HBox>
                    <HBox>
                        <Text text="{I18N>/TEMP_SAVE}" width="6rem" />
                        <Text text="{I18N>/APPROVAL_REQUEST}" width="6rem" />
                        <Text text="{I18N>/APPROVAL_PROGRESS}" width="5rem" />
                        <Text text="{I18N>/APPROVED}" width="6rem" textAlign="Center" />                        
                    </HBox>
				</layout:VerticalLayout>
                <!-- Process 끝 -->
			</FlexBox>
		</uxap:headerContent>

        <uxap:sections>
            <!-- General Information 시작 -->
			<uxap:ObjectPageSection titleUppercase="false" title="{I18N>/GENERAL_INFO}">
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
						<uxap:blocks>
                            <VBox>
                                <HBox alignItems="Center">
                                    <Label text="{I18N>/TITLE}" class="sapUiTinyMarginEnd" textAlign="Left" labelFor="input" required="true"/>
                                    <VBox>
                                        <Input width="20rem" placeholder="" editable="{detailViewModel>/viewMode}" visible="{= ${detailViewModel>/viewMode}}"
                                            value="{detailModel>/approval_title}" />
                                        <Text text="{detailModel>/approval_title}" visible="{= !${detailViewModel>/viewMode}}" />
                                    </VBox>
                                </HBox>
                                <VBox>
                                    <Label text="{I18N>/DESCRIPTION}" required="true"/>
                                    <!-- Text Editor 시작 -->
                                    <rte:RichTextEditor 
                                        width="100%" 
                                        height="200px" 
                                        value="{detailModel>/approval_contents}" 
                                        customToolbar="true" showGroupFont="true" showGroupLink="true" showGroupInsert="true"
                                        visible="{= ${detailViewModel>/viewMode}}" />
                                    <!-- Text Editor 끝 -->
                                    <FormattedText height="200px" htmlText="{= ${detailModel>/approval_contents} ? ${detailModel>/approval_contents} : '' }" visible="{= !${detailViewModel>/viewMode}}"/>
                                </VBox>
                            </VBox>
						</uxap:blocks>
					</uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>
            <!-- General Information 끝 -->

            <!-- Base Price List 시작 -->
			<uxap:ObjectPageSection titleUppercase="false" title="{I18N>/BASE_PRICE_LIST}">
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
						<uxap:blocks>
                            <VBox>
                            <t:Table id="BasePriceDetailTable" selectionMode="MultiToggle" rowSelectionChange=".onRowSelectionChange" 
                                 fixedColumnCount="3" visibleRowCount="5" rows="{detailModel>/results}" >
                                    <t:extension>
                                        <OverflowToolbar class="sapFDynamicPageAlignContent">
                                            <Title text="{I18N>/BASE_PRICE_LIST}({= ${detailModel>/details}.length || 0}) " level="H2"/>
                                        <ToolbarSpacer />
                                        <Button text="{I18N>/ADDITION}({I18N>/MANAGEMENT})" type="Emphasized" press=".onRowSelectadd('MANAGEMENT')" visible="{= ${detailViewModel>/viewMode}}"/>
                                        <Button text="{I18N>/ADDITION}({I18N>/MARKET_PRICE})" type="Emphasized" press=".onRowSelectadd('MARKET_PRICE')" visible="{= ${detailViewModel>/viewMode}}"/>
                                        <Button text="{I18N>/DELETE}" type="Emphasized" press=".onListRowDelete" visible="{= ${detailViewModel>/viewMode}}"/>

                                        <u:FileUploader id="FileUploader" uploadComplete="handleUploadComplete" change=".onImportChange" style="Transparent" 
                                            buttonOnly="true" iconOnly="true" icon="sap-icon://upload" tooltip="{I18N>/UPLOAD}" enabled="false" visible="{= ${detailViewModel>/viewMode}}" />
                                        <Button icon="sap-icon://download" iconOnly="true" type="Transparent" enabled="false" tooltip="{I18N>/TEMPLATE}" visible="{= ${detailViewModel>/viewMode}}" />  

                                        </OverflowToolbar>
                                    </t:extension>
                                    <t:columns>
                                        <t:Column hAlign="Left" width="3rem">
                                            <Label text="{I18N>/STATUS}" textAlign="Center" width="100%" />
                                            <t:template>
                                                <Text text="{detailModel>status}" />
                                            </t:template>
                                        </t:Column>
                                        <t:Column hAlign="Left" width="5rem">
                                            <Label text="{I18N>/LINE_NO}" textAlign="Center" width="100%"/>
                                            <t:template>
                                                <Text text="{detailModel>item_sequence}" />
                                            </t:template>
                                        </t:Column>
                                        <t:Column hAlign="Left" width="8rem">
                                            <Label text="{I18N>/MANAGEMENT}/{I18N>/MARKET_PRICE}" textAlign="Center" width="100%"/>
                                            <t:template>
                                                <Text text="{detailModel>management_mprice_name}" />
                                            </t:template>
                                        </t:Column>
                                        <t:Column hAlign="Left" width="8rem">
                                            <Label text="{I18N>/BASE}{I18N>/YEAR}" textAlign="Center" width="100%"/>
                                            <t:template>
                                                <Text text="{detailModel>base_year}" />
                                            </t:template>
                                        </t:Column>
                                        <t:Column hAlign="Left" width="8rem">
                                            <Label text="{I18N>/SP_APPLY_START_DATA_YYYYMM}" textAlign="Center" width="100%" required="true"/>
                                            <t:template>
                                                <VBox>
                                                    <DatePicker editable="true" displayFormat="y-MM" visible="{= ${detailViewModel>/viewMode}}" change=".onChangeStartData"
                                                            value="{ path: 'detailModel>apply_start_yyyymm' }" />
                                                    <Text visible="{= !${detailViewModel>/viewMode}}" 
                                                        text="{ path: 'detailModel>apply_start_yyyymm',
                                                                formatter: '.onChangeDateFormatYYYYMM'}" />
                                                </VBox>
                                            </t:template>
                                        </t:Column>
                                        <t:Column hAlign="Left" width="8rem">
                                            <Label text="{I18N>/SP_APPLY_END_DATE_YYYYMM}" textAlign="Center" width="100%" required="true"/>
                                            <t:template>
                                                <VBox>
                                                    <DatePicker editable="{= ${detailModel>management_mprice_name} === '관리' }" displayFormat="y-MM" visible="{= ${detailViewModel>/viewMode}}"
                                                            value="{ path: 'detailModel>apply_end_yyyymm' }" change=".onChangeEndData" />
                                                    <Text visible="{= !${detailViewModel>/viewMode}}" 
                                                        text="{ path: 'detailModel>apply_end_yyyymm',
                                                                formatter: '.onChangeDateFormatYYYYMM'}" />    
                                                </VBox>
                                            </t:template>
                                        </t:Column>
                                        <t:Column hAlign="Left" width="10rem">
                                            <Label text="{I18N>/BUSINESS_DIVISION}" textAlign="Center" width="100%" required="true" />
                                            <t:template>
                                                <VBox>
                                                    <ComboBox id="listDivComboBox" width="100%" selectedKey="{detailModel>bizdivision_code}" visible="{= ${detailViewModel>/viewMode}}"
                                                        items="{
                                                                path: 'rootModel>/org_Division'
                                                            }">
                                                        <items>
                                                            <core:Item key="{rootModel>bizdivision_code}" text="{rootModel>bizdivision_code} [{rootModel>bizdivision_name}]" />
                                                        </items>
                                                    </ComboBox>
                                                    <Text text="{detailModel>bizdivision_code} [{detailModel>bizdivision_name}]" visible="{= !${detailViewModel>/viewMode}}" />
                                                </VBox>
                                            </t:template>
                                        </t:Column>
                                        <t:Column hAlign="Left" width="8rem">
                                            <Label text="{I18N>/CORPORATION}" textAlign="Center" width="100%" required="true"/>
                                            <t:template>
                                                <VBox>
                                                    <ComboBox id="CorpComboBox" width="100%"  selectedKey="{detailModel>company_code}"  visible="{= ${detailViewModel>/viewMode}}"
                                                        editable="true"
                                                        items="{ path: 'rootModel>/org_Company',
                                                                filters: [
                                                                {path: 'affiliate_code', operator: 'EQ', value1: 'C100'}
                                                                ]
                                                        }" change=".onChangeCorporation"> 
                                                        <items>
                                                            <core:Item key="{rootModel>company_code}" text="{rootModel>affiliate_code} [{rootModel>company_code}]" />
                                                        </items>
                                                    </ComboBox>
                                                    <Text text="{detailModel>affiliate_code} [{detailModel>company_code}]" visible="{= !${detailViewModel>/viewMode}}" />
                                                </VBox>
                                            </t:template>
                                        </t:Column>
                                        <t:Column hAlign="Center" width="8rem">
                                            <Label text="{I18N>/PLANT}" textAlign="Center" width="100%" required="true"/>
                                            <t:template>
                                                <VBox>
                                                    <ComboBox width="100%" editable="true" visible="{= ${detailViewModel>/viewMode}}"
                                                        selectedKey="{detailModel>plant_code}" 
                                                        items="{
                                                                path: 'detailModel>org_Plant'
                                                                }"
                                                        >
                                                        <items>
                                                            <core:Item key="{detailModel>plant_code}" text="{detailModel>plant_code}[{detailModel>plant_name}]" />
                                                        </items>
                                                    </ComboBox>
                                                    <Text text="{detailModel>plant_code}[{detailModel>plant_name}]" visible="{= !${detailViewModel>/viewMode}}" />
                                                </VBox>
                                            </t:template>
                                        </t:Column>
                                        <t:Column hAlign="Left" width="8rem">
                                            <Label text="{I18N>/SUPPLY_PLANT}" textAlign="Center" width="100%" required="true"/>
                                            <t:template>
                                                <VBox>
                                                    <ComboBox width="100%" editable="true" visible="{= ${detailViewModel>/viewMode}}"
                                                        selectedKey="{detailModel>supply_plant_code}" 
                                                        items="{
                                                                path: 'detailModel>org_Plant'
                                                                }">
                                                        <items>
                                                            <core:Item key="{detailModel>plant_code}" text="{detailModel>plant_code}[{detailModel>plant_name}]" />
                                                        </items>
                                                    </ComboBox>
                                                    <Text text="{detailModel>supply_plant_code}[{detailModel>supply_plant_name}]" visible="{= !${detailViewModel>/viewMode}}" />
                                                </VBox>
                                            </t:template>
                                        </t:Column>
                                        <t:Column hAlign="Left" width="8rem">
                                            <Label text="{I18N>/MATERIAL}{I18N>/CODE}" textAlign="Center" width="100%" required="true"/>
                                            <t:template>
                                                <VBox>
                                                    <Input value="{detailModel>material_code}" showValueHelp="true" visible="{= ${detailViewModel>/viewMode}}"
                                                        valueHelpRequest=".onMaterialMasterMultiDialogPress" />
                                                    <Text text="{detailModel>material_code}" visible="{= !${detailViewModel>/viewMode}}" />
                                                </VBox>
                                            </t:template>
                                        </t:Column>
                                        <t:Column hAlign="Left" width="8rem">
                                            <Label text="{I18N>/MATERIAL_NAME}" textAlign="Center" width="100%"/>
                                            <t:template>
                                                <VBox>    
                                                    <Input editable="FALSE" value="{detailModel>material_name}" visible="{= ${detailViewModel>/viewMode}}" />
                                                    <Text text="{detailModel>material_name}" visible="{= !${detailViewModel>/viewMode}}" />
                                                </VBox> 
                                            </t:template>
                                        </t:Column>
                                        <t:Column hAlign="Left" width="10rem">
                                            <Label text="{I18N>/VENDOR_POOL_CODE}" textAlign="Center" width="100%"/>
                                            <t:template>
                                                <VBox> 
                                                    <Input editable="FALSE" value="{detailModel>vendor_pool_code}" visible="{= ${detailViewModel>/viewMode}}" />
                                                    <Text text="{detailModel>vendor_pool_code}" visible="{= !${detailViewModel>/viewMode}}" />
                                                </VBox> 
                                            </t:template>
                                        </t:Column>
                                        <t:Column hAlign="Left" width="20rem">
                                            <Label text="{I18N>/VENDOR_POOL}" textAlign="Center" width="100%"/>
                                            <t:template>
                                                <VBox>
                                                    <Input editable="FALSE" value="{detailModel>vendor_pool_local_name}" visible="{= ${detailViewModel>/viewMode}}" />
                                                    <Text text="{detailModel>vendor_pool_local_name}" visible="{= !${detailViewModel>/viewMode}}" />
                                                </VBox>
                                            </t:template>
                                        </t:Column>
                                        <t:Column hAlign="Left" width="8rem">
                                            <Label text="{I18N>/CURRENCY}" textAlign="Center" width="100%" required="true"/>
                                            <t:template>
                                                <VBox>
                                                    <ComboBox selectedKey="{detailModel>currency_code}" visible="{= ${detailViewModel>/viewMode}}"
                                                        items="{ path: 'currModel>/org_Currency' }">
                                                    <items>
                                                        <core:Item key="{currModel>currency_code}" text="{currModel>currency_code}" />
                                                    </items>
                                                    </ComboBox>
                                                    <Text text="{detailModel>currency_code}" visible="{= !${detailViewModel>/viewMode}}" />
                                                </VBox>
                                            </t:template>
                                        </t:Column>
                                        <t:Column hAlign="Left" width="8rem">
                                            <Label text="{I18N>/QUANTITY_UNIT}" textAlign="Center" width="100%"/>
                                            <t:template>
                                                <VBox>
                                                    <Input editable="FALSE" value="{detailModel>base_uom_code}" visible="{= ${detailViewModel>/viewMode}}" />
                                                    <Text text="{detailModel>base_uom_code}" visible="{= !${detailViewModel>/viewMode}}" />
                                                </VBox>    
                                            </t:template>
                                        </t:Column>
                                        <t:Column hAlign="Left" width="8rem">
                                            <Label text="{I18N>/BASE_PRICE}" textAlign="Center" width="100%" required="true"/>
                                            <t:template>
                                                <VBox>
                                                    <Input editable="true" type="Number" change="" visible="{= ${detailViewModel>/viewMode}}"
                                                        value="{detailModel>base_price}" />
                                                    <Text visible="{= !${detailViewModel>/viewMode}}" 
                                                        text="{ path: 'detailModel>base_price',
                                                                formatter: '.onChangeNumber'}" />  
                                                </VBox>
                                                
                                            </t:template>
                                        </t:Column>
                                        <t:Column hAlign="Left" width="8rem">
                                            <Label text="{I18N>/BUYER}" textAlign="Center" width="100%" required="true"/>
                                            <t:template>
                                                <VBox>
                                                    <MultiInput editable="true" visible="{= ${detailViewModel>/viewMode}}"
                                                        valueHelpRequest="onEmployeeDialogPress" value="{detailModel>buyer_empno}"/>
                                                    <Text text="{detailModel>buyer_empno}" visible="{= !${detailViewModel>/viewMode}}" />
                                                </VBox>
                                                
                                            </t:template>
                                        </t:Column>
                                    </t:columns>
                                </t:Table>
                            </VBox>
						</uxap:blocks>
					</uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>
            <!-- Base Price List 끝 -->

            <!-- Attachment 시작 -->
			<uxap:ObjectPageSection titleUppercase="false" title="{I18N>/ATTACHMENT}">
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
						<uxap:blocks>
                            <!-- File Upload 시작-->
                            <UploadCollection
                                id="UploadCollection"
                                maximumFilenameLength="55"
                                maximumFileSize="10"
                                multiple="true"
                                sameFilenameAllowed="true"
                                instantUpload="false"
                                noDataDescription="Drop files or use the &quot;Add&quot; button to keep files ready for upload"
                                change="onChange"
                                fileDeleted="onFileDeleted"
                                filenameLengthExceed="onFilenameLengthExceed"
                                fileSizeExceed="onFileSizeExceed"
                                typeMissmatch="onTypeMissmatch"
                                uploadComplete="onUploadComplete"
                                beforeUploadStarts="onBeforeUploadStarts" />
                            <!-- File Upload 끝-->
						</uxap:blocks>
					</uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>
            <!-- GAttachment 끝 -->

            <!-- Report Line 시작 -->
			<uxap:ObjectPageSection titleUppercase="false" title="{I18N>/APPROVAL_LINE}">
				<uxap:subSections>
					<uxap:ObjectPageSubSection>
						<uxap:blocks>
                            <!-- Approval & Reference 시작 -->
                            <core:Fragment fragmentName="sp.vi.basePriceMgt.view.ApprovalLines" type="XML" />
                            <!-- Approval & Reference 끝 -->
						</uxap:blocks>
					</uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>
            <!-- Report Line 끝 -->
        </uxap:sections>

        <!-- footer 시작 -->
        <uxap:footer>
			<OverflowToolbar visible="true">
                <ToolbarSpacer />
                <!-- <Button type="Emphasized" text="{I18N>/EDIT_CANCEL}" visible="{= ${detailViewModel>/viewMode}}" press=".onCancel" /> -->
                <Button type="Emphasized" text="{I18N>/DELETE}" visible="{= !${detailViewModel>/viewMode}}" press=".onDelete" />
                <Button type="Emphasized" text="{I18N>/EDIT}" visible="{= !${detailViewModel>/viewMode}}" press=".onUpdate" />
                <Button type="Emphasized" text="{I18N>/TEMP_SAVE}" visible="{= ${detailViewModel>/viewMode}}" press=".onSave" />
                <Button type="Emphasized" text="{I18N>/REQUEST}" visible="{= ${detailViewModel>/viewMode}}" press=".onDraft" />
                <Button type="Emphasized" text="{I18N>/APPROVE}" visible="{= ${rootModel>/selectedData/approve_status_code} === 'AR' ? true : false}" press=".onApprove" />
			</OverflowToolbar>
		</uxap:footer>
        <!-- footer 끝 -->
    </uxap:ObjectPageLayout>
</mvc:View>
