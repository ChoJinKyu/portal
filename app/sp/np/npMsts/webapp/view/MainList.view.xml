<mvc:View controllerName="sp.np.npMsts.controller.MainList" 
    xmlns:mvc="sap.ui.core.mvc" 
    xmlns="sap.m" 
    xmlns:f="sap.f" 
    xmlns:form="sap.ui.layout.form" 
    xmlns:layout="sap.ui.layout" 
    xmlns:core="sap.ui.core" 
    xmlns:table="sap.ui.table"
    xmlns:lib-m="ext.lib.control.m"
    xmlns:smartTable="sap.ui.comp.smarttable"
    xmlns:customData="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1"
    height="100%">
    <App id="app">
        <f:DynamicPage id="page"
            headerExpanded="{mainListView>/headerExpanded}" 
            toggleHeaderOnTitleClick="true">
            <!-- DynamicPage Title -->
            <f:title>
                <f:DynamicPageTitle>
                    <f:heading>
                        <Title text="{i18n>appTitle}" />
                    </f:heading>
                    <f:snappedContent>
                        <form:SimpleForm id="pageSearchFormS" maxContainerCols="3" editable="true" layout="ResponsiveGridLayout" adjustLabelSpan="false" labelSpanL="4" labelSpanM="4" emptySpanL="0" emptySpanM="0" columnsL="2" columnsM="2">
                            <form:content>
                                <VBox>
                                    <Label text="Company Name" labelFor="search_company_s" required="true"></Label>     
                                    <MultiComboBox id="search_company_s" width="100%" required="true" 
                                        items="{
                                                    path: 'org>/Org_Company',
                                                    filters: [
                                                        {path: 'tenant_id', operator: 'EQ', value1: 'L2100'}
                                                    ]
                                                }" selectionFinish="handleSelectionFinishComp">
                                        <items>
                                            <core:Item key="{org>company_code}" text="[{org>company_code}] {org>company_name}" />
                                        </items>
                                    </MultiComboBox>
                                    <layoutData><layout:GridData span="XL2 L2 M2 S12"/></layoutData>
                                </VBox>
                                <VBox>
                                    <Label text="Operation ORG" labelFor="search_operation_org_s" required="true"></Label>
                                    <MultiComboBox id="search_operation_org_s" width="100%" required="true"
                                            items="{
                                                path: 'purOrg>/Pur_Operation_Org',
                                                filters: [
                                                    {path: 'tenant_id', operator: 'EQ', value1: 'L2100'}
                                                ]
                                            }">
                                        <items>
                                            <core:Item key="{purOrg>code}" text="[{purOrg>code}] {purOrg>type}" />
                                        </items>
                                    </MultiComboBox>
                                    <layoutData><layout:GridData span="XL2 L2 M2 S12"/></layoutData>                                   
                                </VBox>
                                <VBox>
                                    <Label text="Status" labelFor="status" required="true"></Label>
                                    <SegmentedButton id="status_s" selectionChange="onStatusChange">
                                        <items>
                                            <SegmentedButtonItem key="all" text="All" />
                                            <SegmentedButtonItem key="effPrc" text="유효단가" />
                                            <SegmentedButtonItem key="expPrc" text="만료단가" />
                                        </items>
                                    </SegmentedButton>
                                    <layoutData>
                                        <layout:GridData span="XL2 L2 M2 S12"/>                                        
                                    </layoutData>
                                </VBox>
                            </form:content>
                        </form:SimpleForm>
                    </f:snappedContent>
                    <f:expandedContent>
                        <form:SimpleForm id="pageSearchFormE" maxContainerCols="2" editable="true" layout="ResponsiveGridLayout" adjustLabelSpan="false" labelSpanL="4" labelSpanM="4" emptySpanL="0" emptySpanM="0" columnsL="2" columnsM="2">
                            <form:content>
                                <VBox>
                                    <Label text="Company" labelFor="search_company_e" required="true"></Label>
                                    <MultiComboBox id="search_company_e" width="100%" required="true" 
                                        items="{
                                                    path: 'org>/Org_Company',
                                                    filters: [
                                                        {path: 'tenant_id', operator: 'EQ', value1: 'L2100'}
                                                    ]
                                                }" selectionFinish="handleSelectionFinishComp">
                                        <items>
                                            <core:Item key="{org>company_code}" text="[{org>company_code}] {org>company_name}" />
                                        </items>
                                    </MultiComboBox>
                                    <layoutData><layout:GridData span="XL2 L2 M2 S12"/></layoutData>
                                </VBox>
                                <VBox>
                                    <Label text="Operation ORG" labelFor="search_operation_org_e" required="true"></Label>
                                    <MultiComboBox id="search_operation_org_e" width="100%" required="true"
                                            items="{
                                                path: 'purOrg>/Pur_Operation_Org',
                                                filters: [
                                                    {path: 'tenant_id', operator: 'EQ', value1: 'L2100'}
                                                ]
                                            }">
                                        <items>
                                            <core:Item key="{purOrg>code}" text="[{purOrg>code}] {purOrg>type}" />
                                        </items>
                                    </MultiComboBox>
                                    <layoutData><layout:GridData span="XL2 L2 M2 S12"/></layoutData>
                                </VBox>
                                <VBox>
                                    <Label text="Status" labelFor="status_e" required="true"></Label>
                                    <SegmentedButton id="status_e" selectionChange="onStatusChange">
                                        <items>
                                            <SegmentedButtonItem key="all" text="All" />
                                            <SegmentedButtonItem key="effPrc" text="유효단가" />
                                            <SegmentedButtonItem key="expPrc" text="만료단가" />
                                        </items>
                                    </SegmentedButton>
                                    <layoutData><layout:GridData span="XL2 L2 M2 S12"/></layoutData>
                                </VBox>
                            </form:content>
                        </form:SimpleForm>
                    </f:expandedContent>
                    <f:actions>
                        <Button id="pageSearchButton" text="Search" type="Emphasized" press=".fnSearch" />
                    </f:actions>
                    <f:navigationActions>
                        <Button icon="sap-icon://unfavorite" type="Transparent" />
                    </f:navigationActions>
                </f:DynamicPageTitle>
            </f:title>
            <!-- DynamicPage Header -->
            <f:header>
                <f:DynamicPageHeader pinnable="true">
                    <form:SimpleForm id="pageSearchForm" maxContainerCols="2" editable="true" layout="ResponsiveGridLayout" adjustLabelSpan="false" labelSpanL="4" labelSpanM="4" emptySpanL="0" emptySpanM="0" columnsL="2" columnsM="2">
                        <form:content>
                            <VBox>
                                <Label text="Supplier" labelFor="search_supplier_code"></Label>
                                <lib-m:CodePicker id="search_supplier_code"
                                    placeholder="Enter a Supplier name"
                                    keyField="supplier_code"
                                    textField="supplier_local_name"
                                    suggestionItems="{
                                        path: '/',
                                        filters : [
                                            {path : 'tenant_id', operator : 'EQ', value1 : 'L2100'},
                                            {path : 'language_cd', operator : 'EQ', value1 : 'KO'}
                                        ],
                                        serviceUrl: 'srv-api/odata/v2/pg.vendorPoolMappingService/',
                                        entityName: 'VpSupplierMstView'
                                    }" value="" change=".cvtSupplier">
                                    <lib-m:CodePickerValueHelp contentWidth="500px" title="Choose a supplier"
                                        keyFieldHeaderText="Supplier ID" textFieldHeaderText="Supplier" />
                                </lib-m:CodePicker>
                                <layoutData><layout:GridData span="XL2 L2 M2 S12"/></layoutData>
                            </VBox>
                            <VBox>
                                <Label text="Matrial" labelFor="search_material_code"></Label>
                                <Input id="search_material_code" type="Text" value="" placeholder="" showValueHelp="true" valueHelpOnly="false" valueHelpRequest=".vhMatrialCode"/>
                                <layoutData><layout:GridData span="XL1 L1 M1 S12"/></layoutData>
                            </VBox>
                            <VBox>
                                <Label text="Document Type" labelFor="search_document"></Label>
                                <ComboBox id="search_document" width="100%"
                                    items="{
                                        path: 'util>/Code',
                                        filters: [
                                            {path: 'group_code', operator: 'EQ', value1: 'SP_DOCUMENT_TYPE'}
                                        ]
                                    }">
                                    <items>
                                        <core:Item key="{util>code}" text="{util>code_name}" />
                                    </items>
                                    <layoutData>
                                        <layout:GridData span="XL2 L2 M3 S12" />
                                    </layoutData>
                                </ComboBox>
                                <layoutData><layout:GridData span="XL1 L1 M1 S12"/></layoutData>
                            </VBox>
                            <VBox>
                                <Label text="Net Price Type" labelFor="search_net_price_type"></Label>
                                <ComboBox id="search_net_price_type" width="100%"
                                    items="{
                                        path: 'util>/Code',
                                        filters: [
                                            {path: 'group_code', operator: 'EQ', value1: 'SP_NET_PRICE_TYPE'}
                                        ]
                                    }">
                                    <items>
                                        <core:Item key="{util>code}" text="{util>code_name}" />
                                    </items>
                                    <layoutData>
                                        <layout:GridData span="XL2 L2 M3 S12" />
                                    </layoutData>
                                </ComboBox>
                                <layoutData><layout:GridData span="XL1 L1 M1 S12"/></layoutData>
                            </VBox>
                            <VBox>
                                <Label text="Effective Start Date" labelFor="search_effective_start_date"></Label>
                                <DateRangeSelection id="search_effective_start_date" width="100%" change="handleChange"/>
                                <layoutData><layout:GridData span="XL2 L2 M2 S12"/></layoutData>
                            </VBox>
                            <VBox>
                                <Label text="Effective End Date" labelFor="search_effective_end_date"></Label>
                                <DatePicker id="search_effective_end_date" displayFormat="yyyy.MM.dd" valueFormat="yyyy.MM.dd" editable="true" navigate="onclickDate" value="9999-12-31"/>
                                <layoutData><layout:GridData span="XL1 L1 M1 S12"/></layoutData>
                            </VBox>
                        </form:content>
                    </form:SimpleForm>
                </f:DynamicPageHeader>
            </f:header>
            <f:content>
                <smartTable:SmartTable 
                    width="100%"
                    height="100%"
                    smartVariant="pageVariantId"
                    id="sTable1"
                    entitySet="SpNetpriceView"
                    tableBindingPath="{MIMaterialCodeBOMManagementHeaderView}"
                    initiallyVisibleFields=""
                    smartFilterId="smartFilterBar"
                    tableType="ResponsiveTable"
                    useExportToExcel="true"
                    beforeRebindTable=".onBeforeRebindTable"
                    beforeExport=".onBeforeExport"
                    useVariantManagement="false"
                    useTablePersonalisation="true"
                    showTablePersonalisation="true"
                    header="Inquery Net Price List"
                    showRowCount="true"
                    editTogglable="false"
                    persistencyKey="SmartTablePKey"                    
                    class="sapUiResponsiveContentPadding"
                    demandPopin="true"
                    enableAutoBinding="true"
                    customData:useSmartField="true"
                    showFullScreenButton="false">
                    
                    <smartTable:customToolbar>
                        <OverflowToolbar design="Transparent">
                            <ToolbarSpacer/>
                            <OverflowToolbarButton icon="sap-icon://sort" tooltip="Sort" text="Sort" press="onSort"/>
                            <OverflowToolbarButton icon="sap-icon://filter" tooltip="Filter" text="Filter" press="onFilter"/>
                        </OverflowToolbar>
                    </smartTable:customToolbar >
                    <Table id="mainTable" 
                            mode="MultiSelect" 
                            growingScrollToLoad="true"
                            growing="true"
                            sticky="ColumnHeaders,HeaderToolbar"
                            growingThreshold="50"
                            inset="false"   
                            >
                        <columns>  
                            <Column minScreenWidth ="" demandPopin="false" importance="High" mergeDuplicates="true" popinDisplay="WithoutHeader">
                                <customData>
                                <core:CustomData key="p13nData"
                                value='\{"columnKey": "org_code",  "leadingProperty": "org_code", "sortProperty": "org_code", "filterProperty": "org_code", "columnIndex": 1}'/>
                                </customData>
                                <Text text="Oeration Org Code"></Text>
                            </Column>
                            <Column minScreenWidth ="" demandPopin="false" importance="High" mergeDuplicates="true" popinDisplay="WithoutHeader">
                                <customData>
                                <core:CustomData key="p13nData"
                                value='\{"columnKey": "org_name",  "leadingProperty": "org_name", "sortProperty": "org_name", "filterProperty": "org_name", "columnIndex": 2}'/>
                                </customData>
                                <Text text="Operation Org Name"></Text>
                            </Column>
                            <Column minScreenWidth ="" demandPopin="false" importance="High"  popinDisplay="WithoutHeader">
                                <customData>
                                <core:CustomData key="p13nData"
                                value='\{"columnKey": "net_price_document_type_name",  "leadingProperty": "net_price_document_type_name", "sortProperty": "net_price_document_type_name", "filterProperty": "net_price_document_type_name", "columnIndex": 3}'/>
                                </customData>
                                <Text text="Doc Type"></Text>
                            </Column>
                            <Column minScreenWidth ="" demandPopin="false" importance="High"  popinDisplay="WithoutHeader">
                                <customData>
                                <core:CustomData key="p13nData"
                                value='\{"columnKey": "net_price_source_name",  "leadingProperty": "net_price_source_name", "sortProperty": "net_price_source_name", "filterProperty": "net_price_source_name", "columnIndex": 4}'/>
                                </customData>
                                <Text text="Source"></Text>
                            </Column>
                            <Column minScreenWidth ="" demandPopin="false" importance="High"  popinDisplay="WithoutHeader">
                                <customData>
                                <core:CustomData key="p13nData"
                                value='\{"columnKey": "supplier_code",  "leadingProperty": "supplier_code", "sortProperty": "supplier_code", "filterProperty": "supplier_code", "columnIndex": 5}'/>
                                </customData>
                                <Text text="Supplier Code"></Text>
                            </Column>
                        </columns>
                        <items>
                            <ColumnListItem type="Navigation" press=".onMainTableItemPress">
                                <Text text="{org_code}"></Text>
                                <Text text="{org_name}"></Text>
                                <Text text="{net_price_document_type_name}"></Text>
                                <Text text="{net_price_source_name}"></Text>
                                <Text text="{supplier_code}"></Text>
                            </ColumnListItem>
                        </items>
                    </Table>     
                </smartTable:SmartTable>
            </f:content>
            <!-- DynamicPage Footer -->
            <f:footer>
                <OverflowToolbar>
                    <ToolbarSpacer />
                    <Button type="Accept" text="Accept"/>
                    <Button type="Reject" text="Reject"/>
                </OverflowToolbar>
            </f:footer>
        </f:DynamicPage>
    </App>
</mvc:View>
