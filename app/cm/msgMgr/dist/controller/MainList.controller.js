sap.ui.define(["ext/lib/controller/BaseController","ext/lib/util/Multilingual","ext/lib/model/TransactionManager","ext/lib/model/ManagedListModel","ext/lib/formatter/Formatter","ext/lib/util/Validator","sap/m/TablePersoController","./MainListPersoService","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter","sap/m/MessageBox","sap/m/MessageToast","sap/m/ColumnListItem","sap/m/ObjectIdentifier","sap/m/Text","sap/m/Input","sap/m/ComboBox","sap/ui/core/Item"],function(e,t,a,s,i,n,o,r,l,d,c,g,h,u,m,b,f,M,p){"use strict";return e.extend("cm.msgMgr.controller.MainList",{formatter:i,validator:new n,onInit:function(){var e=new t;this.setModel(e.getModel(),"I18N");this.setModel(new s,"list");e.attachEvent("ready",function(e){var t=e.getParameter("model");this.addHistoryEntry({title:t.getText("/MESSAGE_MANAGEMENT"),icon:"sap-icon://table-view",intent:"#Template-display"},true)}.bind(this));this.enableMessagePopover()},onRenderedFirst:function(){this.byId("pageSearchButton").firePress()},onPageStateChange:function(e){debugger},onMainTableUpdateFinished:function(e){},onMainTablePersoButtonPressed:function(e){},onMainTablePersoRefresh:function(){r.resetPersData();this._oTPC.refresh()},onPageSearchButtonPress:function(e){var t=function(){var e=this._getSearchStates();this._applySearch(e)}.bind(this);if(this.getModel("list").isChanged()===true){g.confirm(this.getModel("I18N").getText("/NCM0003"),{title:this.getModel("I18N").getText("/SEARCH"),initialFocus:sap.m.MessageBox.Action.CANCEL,onClose:function(e){if(e===g.Action.OK){t()}}.bind(this)})}else{t()}},onMainTableAddButtonPress:function(){var e=this.byId("mainTable"),t=this.getModel("list");t.addRecord({tenant_id:"L2100",chain_code:"CM",language_code:"",message_code:"",message_type_code:"LBL",message_contents:"",local_create_dtm:new Date,local_update_dtm:new Date},"/Message",0);this.validator.clearValueState(this.byId("mainTable"))},onMainTableDeleteButtonPress:function(){var e=this.byId("mainTable"),t=this.getModel("list");e.getSelectedIndices().reverse().forEach(function(e){t.markRemoved(e)})},onMainTableSaveButtonPress:function(){var e=this.getModel("list"),t=this.getView(),a=this.byId("mainTable");if(this.validator.validate(this.byId("mainTable"))!==true)return;g.confirm(this.getModel("I18N").getText("/NCM0004"),{title:this.getModel("I18N").getText("/SAVE"),initialFocus:sap.m.MessageBox.Action.CANCEL,onClose:function(a){if(a===g.Action.OK){t.setBusy(true);e.submitChanges({success:function(e){t.setBusy(false);h.show(this.getModel("I18N").getText("/NCM0005"));this.byId("pageSearchButton").firePress()}.bind(this)})}}.bind(this)})},_applySearch:function(e){var t=this.getView(),a=this.getModel("list");t.setBusy(true);a.setTransactionModel(this.getModel());a.read("/Message",{filters:e,sorters:[new c("chain_code"),new c("message_code"),new c("language_code",true)],success:function(e){this.validator.clearValueState(this.byId("mainTable"));t.setBusy(false)}.bind(this)})},_getSearchStates:function(){var e=this.byId("page").getHeaderExpanded()?"E":"S",t=this.getView().byId("searchChain"+e).getSelectedKey(),a=this.getView().byId("searchLanguage"+e).getSelectedKey(),s=this.getView().byId("searchKeyword"+e).getValue();var i=[];if(t&&t.length>0){i.push(new l("chain_code",d.EQ,t))}if(a&&a.length>0){i.push(new l("language_code",d.EQ,a))}if(s&&s.length>0){i.push(new l({filters:[new l("tolower(message_code)",d.Contains,"'"+s.toLowerCase().replace("'","''")+"'"),new l("tolower(message_contents)",d.Contains,"'"+s.toLowerCase().replace("'","''")+"'")],and:false}))}return i},_doInitTablePerso:function(){this._oTPC=new o({table:this.byId("mainTable"),componentName:"cm.msgMgr",persoService:r,hasGrouping:true}).activate()}})});