sap.ui.define(["ext/lib/controller/BaseController","sap/ui/core/routing/History","sap/ui/model/json/JSONModel","ext/lib/model/ManagedListModel","ext/lib/formatter/DateFormatter","sap/m/TablePersoController","./MainListPersoService","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","sap/m/MessageToast","sap/m/ColumnListItem","sap/m/ObjectIdentifier","sap/m/Text","sap/m/Input","sap/m/ComboBox","sap/ui/core/Item","3rd/lib/lodash/lodash"],function(e,t,n,o,i,a,s,r,l,d,c,u,h,g,m,p,T){"use strict";return e.extend("cm.controlOptionMgr.controller.MainList",{dateFormatter:i,onInit:function(){var e,t=this.getResourceBundle();e=new n({headerExpanded:true,mainListTableTitle:t.getText("mainListTableTitle"),tableNoDataText:t.getText("tableNoDataText")});this.setModel(e,"mainListView");this.addHistoryEntry({title:t.getText("mainListViewTitle"),icon:"sap-icon://table-view",intent:"#Template-display"},true);this.setModel(new o,"list");this.getRouter().getRoute("mainPage").attachPatternMatched(this._onRoutedThisPage,this);this._doInitTablePerso()},onRenderedFirst:function(){},onMainTableUpdateFinished:function(e){var t,n=e.getSource(),o=e.getParameter("total");if(o&&n.getBinding("items").isLengthFinal()){t=this.getResourceBundle().getText("mainListTableTitleCount",[o])}else{t=this.getResourceBundle().getText("mainListTableTitle")}this.getModel("mainListView").setProperty("/mainListTableTitle",t)},onMainTablePersoButtonPressed:function(e){this._oTPC.openDialog()},onMainTablePersoRefresh:function(){s.resetPersData();this._oTPC.refresh()},onMainTableAddButtonPress:function(){var e=this.getOwnerComponent().getHelper().getNextUIState(1);this.getRouter().navTo("midPage",{layout:e.layout,tenantId:"new",controlOptionCode:"code","?query":{}})},onPageSearchButtonPress:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh()}else{var t=this._getSearchStates();this._applySearch(t)}},onMainTableItemPress:function(e){var t=this.getOwnerComponent().getHelper().getNextUIState(1),n=e.getSource().getBindingContext("list").getPath(),o=this.getModel("list").getProperty(n);this.getRouter().navTo("midPage",{layout:t.layout,tenantId:o.tenant_id,controlOptionCode:o.control_option_code});if(t.layout==="TwoColumnsMidExpanded"){this.getView().getModel("mainListView").setProperty("/headerExpandFlag",false)}var i=e.getSource();i.setNavigated(true);var a=i.getParent();this.iIndex=a.indexOfItem(i)},_onRoutedThisPage:function(){this.getModel("mainListView").setProperty("/headerExpanded",true)},_applySearch:function(e){var t=this.getView(),n=this.getModel("list");t.setBusy(true);n.setTransactionModel(this.getModel());n.read("/ControlOptionMasters",{filters:e,success:function(e){t.setBusy(false)}});t.setBusy(true);(new o).setTransactionModel(this.getModel("tree")).tree("/Categories_haa",[new r("name",l.Contains,"e")]).then(function(e){console.log(">>>> success",e)}).catch(function(e){console.log(">>>> fail",e)}).finally(function(){console.log(">>>> finally");t.setBusy(false)})},_getSearchStates:function(){var e,t,n=[];if(!!this.byId("searchChainCombo").getSelectedKey())n.push(new r("chain_code",l.EQ,this.byId("searchChainCombo").getSelectedKey()));if(!!this.byId("searchTenantCombo").getSelectedKey())n.push(new r("tenant_id",l.EQ,this.byId("searchTenantCombo").getSelectedKey()));if(!!(e=this.byId("searchKeyword").getValue())){n.push(new r({filters:[new r("control_option_code",l.Contains,e),new r("control_option_name",l.Contains,e)],and:false}))}return n},_doInitTablePerso:function(){this._oTPC=new a({table:this.byId("mainTable"),componentName:"controlOptionMgr",persoService:s,hasGrouping:true}).activate()}})});