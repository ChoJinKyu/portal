package lg.sppCap.handlers.tmp;

import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;
import java.util.HashMap;
import java.util.Map;

import com.sap.cds.services.handler.EventHandler;
import com.sap.cds.services.handler.annotations.On;
import com.sap.cds.services.handler.annotations.ServiceName;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;
import org.springframework.transaction.annotation.Transactional;

import cds.gen.tmp.tmpmgrservice.*;
import lg.sppCap.solutionized.bizrule.BizRuleExecutor;

@Component
@ServiceName("tmp.TmpMgrService")
public class TmpMgr implements EventHandler {

    @Autowired
    BizRuleExecutor bizRuleExecutor;

    @Transactional(rollbackFor = SQLException.class)
    @On(event = SampleLogicTransitionContext.CDS_NAME)
    public void onSampleLogicTransition(SampleLogicTransitionContext context) {
        System.out.println("주 업무 로직 수행");
        SampleType sampleType = SampleType.create();
        String result = "<div id='__component0---approvalList--pageSearchFormS--Layout' data-sap-ui='__component0---approvalList--pageSearchFormS--Layout' class='sapUiFormResGrid sapUiFormBackgrTranslucent'><div id='__container2--Grid' data-sap-ui='__container2--Grid' class='sapUiRespGrid sapUiRespGridHSpace0 sapUiRespGridVSpace0 sapUiFormResGridCont sapUiRespGridOverflowHidden sapUiRespGridMedia-Std-LargeDesktop'><div class='sapUiRespGridSpanXL3 sapUiRespGridSpanL3 sapUiRespGridSpanM6 sapUiRespGridSpanS12'><div id='__vbox0' data-sap-ui='__vbox0' class='sapMFlexBox sapMVBox sapMFlexBoxJustifyStart sapMFlexBoxAlignItemsStretch sapMFlexBoxWrapNoWrap sapMFlexBoxAlignContentStretch sapMFlexBoxBGTransparent' " 
        + " style='width: 100%;'><div id='__data44' class='sapMFlexItemAlignAuto sapMFlexBoxBGTransparent sapMFlexItem' style='order: 0; flex-grow: 0; flex-shrink: 1; flex-basis: auto; min-height: auto; min-width: auto;'><label id='__label0' data-sap-ui='__label0' for='__component0---approvalList--searchCompanyS-inner' aria-label='회사명' class='sapMLabel sapUiSelectable sapMLabelRequired sapMLabelMaxWidth' style='text-align: left;'><span id='__label0-text' class='sapMLabelTextWrapper'><bdi id='__label0-bdi'>회사명</bdi></span><span class='sapMLabelColonAndRequired'></span></label></div><div id='__data45' class='sapMFlexItemAlignAuto sapMFlexBoxBGTransparent sapMFlexItem' style='order: 0; flex-grow: 0; flex-shrink: 1; flex-basis: auto; min-height: auto; min-width: auto;'>"
        + "<div id='__component0---approvalList--searchCompanyS' data-sap-ui='__component0---approvalList--searchCompanyS' class='sapMInputBase sapMInputBaseHeightMargin sapMComboBoxBase sapMMultiComboBox sapMInputBaseState sapMInputBaseHasEndIcons' style='max-width: 100%; width: 100%;'><div id='__component0---approvalList--searchCompanyS-content' class='sapMInputBaseContentWrapper sapMInputBaseContentWrapperState sapMInputBaseContentWrapperError' style='width: 100%;'><div id='__tokenizer0' data-sap-ui='__tokenizer0' role='listbox' aria-labelledby='__text34' class='sapMTokenizer sapMTokenizerEmpty sapMTokenizerIndicatorDisabled' style='max-width: 291px; overflow: hidden;'><span id='__text7' data-sap-ui='__text7' aria-hidden='true' class='sapUiInvisibleText'>No tokens</span>"
        + "<div id='__tokenizer0-scrollContainer' class='sapMTokenizerScrollContainer'></div><span class='sapMTokenizerIndicator sapUiHidden'></span></div><input id='__component0---approvalList--searchCompanyS-inner' value=' aria-required='true' aria-labelledby='__label0' aria-describedby='__text7' aria-roledescription='다중 값 콤보 박스' role='combobox' aria-haspopup='listbox' aria-autocomplete='both' aria-expanded='false' autocomplete='off' autocorrect='off' autocapitalize='off' type='text' class='sapMInputBaseInner' aria-invalid='true' aria-errormessage='__component0---approvalList--searchCompanyS-message-sr' style='width: calc(100% - 32px);'><div tabindex='-1' class='sapMInputBaseIconContainer'><span id='__component0---approvalList--searchCompanyS-arrow' data-sap-ui='__component0---approvalList--searchCompanyS-arrow'"
        + " aria-labelledby='__label0 __component0---approvalList--searchCompanyS-arrow-label' role='button' data-sap-ui-icon-content='' class='sapUiIcon sapUiIconMirrorInRTL sapUiIconPointer sapMInputBaseIcon' style='font-family: /'SAP\2dicons/';'><span id='__component0---approvalList--searchCompanyS-arrow-label' data-sap-ui='__component0---approvalList--searchCompanyS-arrow-label' aria-hidden='true' class='sapUiInvisibleText'>선택 옵션</span></span></div></div><div id='__component0---approvalList--searchCompanyS-message-sr' aria-live='assertive' aria-atomic='true' class='sapUiPseudoInvisibleText'>값 상태 오류 엔트리가 유효하지 않습니다.</div></div></div></div></div><div class='sapUiRespGridSpanXL3 sapUiRespGridSpanL3 sapUiRespGridSpanM6 sapUiRespGridSpanS12'><div id='__vbox1' data-sap-ui='__vbox1' class='sapMFlexBox sapMVBox sapMFlexBoxJustifyStart sapMFlexBoxAlignItemsStretch sapMFlexBoxWrapNoWrap sapMFlexBoxAlignContentStretch sapMFlexBoxBGTransparent' style='width: 100%;'><div id='__data46' class='sapMFlexItemAlignAuto sapMFlexBoxBGTransparent sapMFlexItem' style='order: 0; flex-grow: 0; flex-shrink: 1; flex-basis: auto; min-height: auto; min-width: auto;'><label id='__label1' data-sap-ui='__label1' for='__component0---approvalList--searchPlantS-inner' aria-label='플랜트' class='sapMLabel sapUiSelectable sapMLabelRequired sapMLabelMaxWidth' style='text-align: left;'><span id='__label1-text' class='sapMLabelTextWrapper'><bdi id='__label1-bdi'>플랜트</bdi></span><span class='sapMLabelColonAndRequired'></span></label></div><div id='__data47' class='sapMFlexItemAlignAuto sapMFlexBoxBGTransparent sapMFlexItem' style='order: 0; flex-grow: 0; flex-shrink: 1; flex-basis: auto; min-height: auto; min-width: auto;'><div id='__component0---approvalList--searchPlantS' data-sap-ui='__component0---approvalList--searchPlantS' class='sapMInputBase sapMInputBaseHeightMargin sapMComboBoxBase sapMMultiComboBox sapMInputBaseState sapMInputBaseHasEndIcons' style='max-width: 100%; width: 100%;'><div id='__component0---approvalList--searchPlantS-content' class='sapMInputBaseContentWrapper sapMInputBaseContentWrapperState sapMInputBaseContentWrapperError' style='width: 100%;'><div id='__tokenizer1' data-sap-ui='__tokenizer1' role='listbox' aria-labelledby='__text34' class='sapMTokenizer sapMTokenizerEmpty sapMTokenizerIndicatorDisabled' style='max-width: 291px; overflow: hidden;'><span id='__text8' data-sap-ui='__text8' aria-hidden='true' class='sapUiInvisibleText'>No tokens</span><div id='__tokenizer1-scrollContainer' class='sapMTokenizerScrollContainer'></div><span class='sapMTokenizerIndicator sapUiHidden'></span></div><input id='__component0---approvalList--searchPlantS-inner' value=' aria-required='true' aria-labelledby='__label1' aria-describedby='__text8' aria-roledescription='다중 값 콤보 박스' role='combobox' aria-haspopup='listbox' aria-autocomplete='both' aria-expanded='false' autocomplete='off' autocorrect='off' autocapitalize='off' type='text' class='sapMInputBaseInner' aria-invalid='true' aria-errormessage='__component0---approvalList--searchPlantS-message-sr' style='width: calc(100% - 32px);'><div tabindex='-1' class='sapMInputBaseIconContainer'><span id='__component0---approvalList--searchPlantS-arrow' data-sap-ui='__component0---approvalList--searchPlantS-arrow' aria-labelledby='__label1 __component0---approvalList--searchPlantS-arrow-label' role='button' data-sap-ui-icon-content='' class='sapUiIcon sapUiIconMirrorInRTL sapUiIconPointer sapMInputBaseIcon' style='font-family: /'SAP\2dicons/';'><span id='__component0---approvalList--searchPlantS-arrow-label' data-sap-ui='__component0---approvalList--searchPlantS-arrow-label' aria-hidden='true' class='sapUiInvisibleText'>선택 옵션</span></span></div></div><div id='__component0---approvalList--searchPlantS-message-sr' aria-live='assertive' aria-atomic='true' class='sapUiPseudoInvisibleText'>값 상태 오류 엔트리가 유효하지 않습니다.</div></div></div></div></div><div class='sapUiRespGridSpanXL3 sapUiRespGridSpanL3 sapUiRespGridSpanM6 sapUiRespGridSpanS12'><div id='__vbox2' data-sap-ui='__vbox2' class='sapMFlexBox sapMVBox sapMFlexBoxJustifyStart sapMFlexBoxAlignItemsStretch sapMFlexBoxWrapNoWrap sapMFlexBoxAlignContentStretch sapMFlexBoxBGTransparent' style='width: 100%;'><div id='__data48' class='sapMFlexItemAlignAuto sapMFlexBoxBGTransparent sapMFlexItem' style='order: 0; flex-grow: 0; flex-shrink: 1; flex-basis: auto; min-height: auto; min-width: auto;'><label id='__label2' data-sap-ui='__label2' for='__component0---approvalList--searchRequestDateS-inner' aria-label='요청일자' class='sapMLabel sapUiSelectable sapMLabelRequired sapMLabelMaxWidth' style='text-align: left;'><span id='__label2-text' class='sapMLabelTextWrapper'><bdi id='__label2-bdi'>요청일자</bdi></span><span class='sapMLabelColonAndRequired'></span></label></div><div id='__data49' class='sapMFlexItemAlignAuto sapMFlexBoxBGTransparent sapMFlexItem' style='order: 0; flex-grow: 0; flex-shrink: 1; flex-basis: auto; min-height: auto; min-width: auto;'><div id='__component0---approvalList--searchRequestDateS' data-sap-ui='__component0---approvalList--searchRequestDateS' class='sapMInputBase sapMInputBaseHeightMargin sapMInputBaseHasEndIcons' style='width: 100%;'><div id='__component0---approvalList--searchRequestDateS-content' class='sapMInputBaseContentWrapper' style='width: 100%;'><input id='__component0---approvalList--searchRequestDateS-inner' placeholder='y. M. d. - y. M. d.' value='2020. 10. 15. - 2021. 1. 13.' aria-required='true' aria-labelledby='__label2' role='combobox' aria-roledescription='일자 범위 입력' aria-autocomplete='none' aria-haspopup='grid' aria-expanded='false' type='text' class='sapMInputBaseInner'><div tabindex='-1' class='sapMInputBaseIconContainer'><span id='__component0---approvalList--searchRequestDateS-icon' data-sap-ui='__component0---approvalList--searchRequestDateS-icon' role='presentation' aria-hidden='true' data-sap-ui-icon-content='' title='선택 도구 열기' class='sapUiIcon sapUiIconMirrorInRTL sapUiIconPointer sapMInputBaseIcon' style='font-family: /'SAP\2dicons/';'></span></div></div></div></div></div></div><div class='sapUiRespGridSpanXL3 sapUiRespGridSpanL3 sapUiRespGridSpanM6 sapUiRespGridSpanS12'><div id='__vbox3' data-sap-ui='__vbox3' class='sapMFlexBox sapMVBox sapMFlexBoxJustifyStart sapMFlexBoxAlignItemsStretch sapMFlexBoxWrapNoWrap sapMFlexBoxAlignContentStretch sapMFlexBoxBGTransparent' style='width: 100%;'><div id='__data50' class='sapMFlexItemAlignAuto sapMFlexBoxBGTransparent sapMFlexItem' style='order: 0; flex-grow: 0; flex-shrink: 1; flex-basis: auto; min-height: auto; min-width: auto;'><label id='__label3' data-sap-ui='__label3' for='__component0---approvalList--searchApprovalCategoryS-inner' aria-label='품의유형코드' class='sapMLabel sapUiSelectable sapMLabelMaxWidth' style='text-align: left;'><span id='__label3-text' class='sapMLabelTextWrapper'><bdi id='__label3-bdi'>품의유형코드</bdi></span><span class='sapMLabelColonAndRequired'></span></label></div><div id='__data51' class='sapMFlexItemAlignAuto sapMFlexBoxBGTransparent sapMFlexItem' style='order: 0; flex-grow: 0; flex-shrink: 1; flex-basis: auto; min-height: auto; min-width: auto;'><div id='__component0---approvalList--searchApprovalCategoryS' data-sap-ui='__component0---approvalList--searchApprovalCategoryS' class='sapMInputBase sapMInputBaseHeightMargin sapMComboBoxBase sapMMultiComboBox sapMInputBaseHasEndIcons' style='max-width: 100%; width: 100%;'><div id='__component0---approvalList--searchApprovalCategoryS-content' class='sapMInputBaseContentWrapper' style='width: 100%;'><div id='__tokenizer2' data-sap-ui='__tokenizer2' role='listbox' aria-labelledby='__text34' class='sapMTokenizer sapMTokenizerEmpty sapMTokenizerIndicatorDisabled' style='max-width: 291px; overflow: hidden;'><span id='__text9' data-sap-ui='__text9' aria-hidden='true' class='sapUiInvisibleText'>No tokens</span><div id='__tokenizer2-scrollContainer' class='sapMTokenizerScrollContainer'></div><span class='sapMTokenizerIndicator sapUiHidden'></span></div><input id='__component0---approvalList--searchApprovalCategoryS-inner' value=' aria-labelledby='__label3' aria-describedby='__text9' aria-roledescription='다중 값 콤보 박스' role='combobox' aria-haspopup='listbox' aria-autocomplete='both' aria-expanded='false' autocomplete='off' autocorrect='off' autocapitalize='off' type='text' class='sapMInputBaseInner' style='width: calc(100% - 32px);'><div tabindex='-1' class='sapMInputBaseIconContainer'><span id='__component0---approvalList--searchApprovalCategoryS-arrow' data-sap-ui='__component0---approvalList--searchApprovalCategoryS-arrow' aria-labelledby='__label3 __component0---approvalList--searchApprovalCategoryS-arrow-label' role='button' data-sap-ui-icon-content='' class='sapUiIcon sapUiIconMirrorInRTL sapUiIconPointer sapMInputBaseIcon' style='font-family: /'SAP\2dicons/';'><span id='__component0---approvalList--searchApprovalCategoryS-arrow-label' data-sap-ui='__component0---approvalList--searchApprovalCategoryS-arrow-label' aria-hidden='true' class='sapUiInvisibleText'>선택 옵션</span></span></div></div></div></div></div></div></div></div>";
        sampleType.setResult(result);
        String test = (String)context.get("test");
        System.out.println("test : " + test);
        System.out.println("주 업무 로직 수행");

        //비지니스 코드 구현시 업무규칙 호출이 필요한 시점
        //tenantId는 하드코드가 아니라 세션등에서 가져와야 함
        String tenantId = "TEN001";
        String bizRuleId = "BIZRULE_ECHO_EXAMPLE";
        String altFlag = "DEFAULT";
        
        //업무규칙에 넘길 파라메터르 구성한다.
        Map<String, Object> inData = new HashMap<String, Object>();
        inData.put("Name", "Hong Gil Dong");
        inData.put("Phone", "010-1234-5678");
        inData.put("Gender", "Male");
        inData.put("Email", "gdhong@lgcns.com");
        
        //BizRuleExecutor를 통해 업무규칙을 호출한다.
        //Map<String, Object> outData = bizRuleExecutor.excuteBizRule(tenantId, bizRuleId, altFlag, inData);

        context.setResult(sampleType);
        context.setCompleted();
    }
}