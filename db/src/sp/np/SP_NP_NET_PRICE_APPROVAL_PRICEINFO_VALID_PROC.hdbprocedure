PROCEDURE SP_NP_NET_PRICE_APPROVAL_PRICEINFO_VALID_PROC (
     IN     I_TENANT_ID                     NVARCHAR(20)
    ,IN     I_LANGUAGE_CODE                 NVARCHAR(2)
	,IN     I_DETAILS				        SP_NP_NET_PRICE_APPROVAL_PRICEINFO_TYPE
    ,OUT    O_RETURN_CODE                   NVARCHAR(5)
    ,OUT    O_RETURN_MSG                    NVARCHAR(4000)
    )
LANGUAGE SQLSCRIPT
SQL SECURITY INVOKER 
AS
BEGIN

    DECLARE i INTEGER;
    DECLARE lv_row_count INTEGER;
    DECLARE v_currentcy_code NVARCHAR(3);
    /*
    DECLARE v_details SP_NP_NET_PRICE_APPROVAL_PRICEINFO_TYPE;
    */
    /* 사용자 정의 Exception */
    DECLARE V_USER_EXCEPTION CONDITION FOR SQL_ERROR_CODE 19999;

    /* 사용자 정의 Exception시, 종료 처리 : 이전 Exception Catch 부분에서 결과 메시지 등록 됨. */
    DECLARE EXIT HANDLER FOR V_USER_EXCEPTION
    BEGIN
        -- 아무것도 하지 않습니다.
    END;

    /* loop */
    BEGIN
        /* 해당 Block에서 Exception 발생시, 사용자 정의 Exception 발생 시킴. */
        DECLARE EXIT HANDLER FOR SQLEXCEPTION
        BEGIN
            O_RETURN_CODE = 'E';
            O_RETURN_MSG  = 'Validation 실행중 오류가 발생했습니다.';
            SIGNAL V_USER_EXCEPTION;
        END;

        lv_row_count = RECORD_COUNT(:I_DETAILS);
        FOR i IN 0 .. :lv_row_count-1 DO

            SELECT currency_code
            INTO v_currentcy_code
            FROM :I_DETAILS
            LIMIT 1 OFFSET :i; 
        
            IF IFNULL(v_currentcy_code,'') = '' THEN 
                O_RETURN_CODE = 'E';
                O_RETURN_MSG  = '['||i+1||']통화코드가 없습니다.';
                BREAK;
            END IF;
        END FOR;
    END;
END;