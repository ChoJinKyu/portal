FUNCTION SP_SE_GET_QTTIVE_EVAL_CALC_ITEM_NAME_FUNC (I_TENANT_ID NVARCHAR(5)
                                                   ,I_COMPANY_CODE     NVARCHAR(10)
                                                   ,I_ORG_TYPE_CODE    NVARCHAR(2)
                                                   ,I_ORG_CODE         NVARCHAR(10)
                                                   ,I_EVALUATION_OPERATION_UNIT_CODE NVARCHAR(30)
                                                   ,I_QTTIVE_EVAL_ARTICLE_CALC_FORMULA NVARCHAR(1000)
)
RETURNS O_RETURN NVARCHAR(1000)
LANGUAGE SQLSCRIPT
/**************************************************************************
Scrum          : SP/협력사평가관리
Program Name   : SP_SE_GET_QTTIVE_EVAL_CALC_ITEM_NAME_FUNC
Creator        : Lee Soon JIn
Description    : 정량항목산식
History        : 2021-01-21 initial creation
***************************************************************************/
AS

BEGIN

    DECLARE SQL_TEXT NVARCHAR(5000);
    DECLARE VARIABLE_FORMULA_TEXT NVARCHAR(1000) = I_QTTIVE_EVAL_ARTICLE_CALC_FORMULA;
    DECLARE VALUE_FORMULA_TEXT NVARCHAR(1000);
    DECLARE VARIABLES TABLE(QTTIVE_ITEM_NAME NVARCHAR(100), SORT_SEQ NVARCHAR(10));
    DECLARE I INT = 0;

    DECLARE CURSOR CUR_FORMULA FOR
    SELECT QTTIVE_ITEM_CODE, QTTIVE_ITEM_NAME
    FROM   SP_SE_QUANTITATIVE_ITEM
    WHERE  TENANT_ID = I_TENANT_ID
    AND    COMPANY_CODE = I_COMPANY_CODE
    AND    ORG_TYPE_CODE = I_ORG_TYPE_CODE
    AND    ORG_CODE = I_ORG_CODE
    AND    EVALUATION_OPERATION_UNIT_CODE = I_EVALUATION_OPERATION_UNIT_CODE
    AND    INSTR(VARIABLE_FORMULA_TEXT, QTTIVE_ITEM_CODE) > 0;

    /* SQL Error 처리 */
    BEGIN
        DECLARE EXIT HANDLER FOR SQLEXCEPTION
        BEGIN
            O_RETURN = '';  --없으면 공백으로 리턴
        END;
    END;


    VALUE_FORMULA_TEXT = VARIABLE_FORMULA_TEXT;

    FOR REC_FORMULA AS CUR_FORMULA DO
        I = 1;
        BEGIN
            VALUE_FORMULA_TEXT = REPLACE(VALUE_FORMULA_TEXT, REC_FORMULA.QTTIVE_ITEM_CODE, REC_FORMULA.QTTIVE_ITEM_NAME);
        END;
    END FOR;

    IF I = 0 THEN
        O_RETURN = '';
    ELSE
        O_RETURN = VALUE_FORMULA_TEXT;
    END IF;


END;