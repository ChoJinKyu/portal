VIEW SP_SE_EVAL_SHEET_EVAL_ITEM_TREE_VIEW AS
SELECT parent_id
      ,node_id
      ,tenant_id
      ,company_code
      ,org_type_code
      ,org_code
      ,evaluation_operation_unit_code
      ,evaluation_type_code
      ,regular_evaluation_id
      ,evaluation_article_code
      ,evaluation_article_name
      ,parent_evaluation_article_code
      ,evaluation_distrb_score_weight
      ,evaluation_execute_mode_code
      ,evaluation_article_type_code
      ,evaluation_distrb_scr_type_cd
      ,evaluation_result_input_type_cd
      ,qttive_item_uom_code
      ,qttive_eval_article_calc_formula
      ,evaluation_article_desc
      ,evaluation_article_lvl_attr_cd
      ,sort_sequence
      ,hierarchy_rank            /*현재node의 순번(sibling order by에 의한)*/
      ,hierarchy_tree_size       /*현재node포함 하위node 갯수(1이면 leaf node(마지막node))*/
      ,hierarchy_parent_rank     /*부모node의 순번*/
      ,hierarchy_level           /*현재node의 Level*/
      ,hierarchy_root_rank       /*root node의 순번*/
      ,hierarchy_is_cycle        /*순환구조여부(0:False, 1:True)*/
      ,hierarchy_is_orphan       /*전개후 연결이 끊어진 노드여부(0:False, 1:True)*/
FROM   HIERARCHY (
                  SOURCE (SELECT esei.tenant_id                      /*테넌트ID*/
                                ,esei.company_code                   /*회사코드*/
                                ,esei.org_type_code                  /*조직유형코드*/
                                ,esei.org_code                       /*조직코드*/
                                ,esei.evaluation_operation_unit_code /*평가운영단위코드*/
                                ,esei.evaluation_type_code           /*평가유형코드*/
                                ,esei.evaluation_article_code        /*평가항목코드*/
                                ,esei.evaluation_article_name         /*평가항목명*/
                                ,esei.parent_evaluation_article_code
                                ,esei.evaluation_distrb_score_weight /*평가배점가중치*/
                                ,esei.evaluation_execute_mode_code
                                ,esei.evaluation_article_type_code
                                ,esei.evaluation_distrb_scr_type_cd
                                ,esei.evaluation_result_input_type_cd
                                ,esei.qttive_item_uom_code
                                ,esei.qttive_eval_article_calc_formula
                                ,esei.evaluation_article_desc
                                ,esei.evaluation_article_lvl_attr_cd
                                ,esei.sort_sequence
                                ,esei.regular_evaluation_id
                                ,HIERARCHY_COMPOSITE_ID(esei.regular_evaluation_id, esei.tenant_id, esei.company_code, esei.org_type_code, esei.org_code, esei.evaluation_operation_unit_code, esei.parent_evaluation_article_code) AS parent_id
                                ,HIERARCHY_COMPOSITE_ID(esei.regular_evaluation_id, esei.tenant_id, esei.company_code, esei.org_type_code, esei.org_code, esei.evaluation_operation_unit_code, esei.evaluation_article_code) AS node_id
                          FROM   sp_se_eval_sheet_eval_item esei
                          )
                  START WHERE esei.parent_evaluation_article_code IS NULL
                  SIBLING ORDER BY sort_sequence, node_id) 
ORDER BY hierarchy_rank;