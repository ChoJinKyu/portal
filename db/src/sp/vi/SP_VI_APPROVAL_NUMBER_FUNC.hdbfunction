FUNCTION SP_VI_APPROVAL_NUMBER_FUNC (p_tenant_id NVARCHAR(5))
    RETURNS D_RETURN NVARCHAR(50)
    LANGUAGE SQLSCRIPT
AS
BEGIN

    SELECT 
        REPLACE(CAST(CURRENT_DATE AS NVARCHAR), '-', '') || IFNULL(LPAD(RIGHT(MAX(APPROVAL_NUMBER), 4) + 1, 4, 0), '0001')
    INTO
        D_RETURN
    FROM 
        CM_APPROVAL_MST 
    WHERE 
        TENANT_ID = :p_tenant_id AND APPROVAL_NUMBER LIKE REPLACE(CAST(CURRENT_DATE AS NVARCHAR), '-', '') || '%';

END;